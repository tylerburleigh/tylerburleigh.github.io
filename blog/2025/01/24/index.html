<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tyler Burleigh">
<meta name="description" content="A data-driven exploration of the GenAI/LLM job market for science and engineering roles in January 2025. I scrape ~1000 job postings from ai-jobs.net, perform data extraction and classification using LLMs, and ultimately analyze the data to identify patterns and insights about the GenAI/LLM job market, including salary ranges, skill requirements, and role distribution.">

<title>Analysis of the GenAI/LLM job market in January 2025 | Tyler Burleigh – Tyler Burleigh</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../..//files/favico.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dd08061cb7210c315e315379d94beb87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-1f84303a6b4423b6cbd3f2cacdf6faa2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PRHQZ8HPLB"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-PRHQZ8HPLB', { 'anonymize_ip': true});
</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #170C3A;
      }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Tyler Burleigh</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/users/tylerburleigh" rel="me"> <i class="bi bi-mastodon" role="img" aria-label="mastodon">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/tylerburleigh.bsky.social" rel="me"> <i class="bi bi-square" role="img" aria-label="bluesky">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/tylerburleigh" rel="me"> <i class="bi bi-github" role="img" aria-label="github">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tylerburleigh" rel="me"> <i class="bi bi-linkedin" role="img" aria-label="linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:tylerburleigh@gmail.com" rel="me"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Analysis of the GenAI/LLM job market in January 2025</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          A data-driven exploration of the GenAI/LLM job market for science and engineering roles in January 2025. I scrape ~1000 job postings from ai-jobs.net, perform data extraction and classification using LLMs, and ultimately analyze the data to identify patterns and insights about the GenAI/LLM job market, including salary ranges, skill requirements, and role distribution.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">prompt-engineering</div>
                <div class="quarto-category">python</div>
                <div class="quarto-category">job-market</div>
                <div class="quarto-category">GenAI</div>
                <div class="quarto-category">LLM</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.tylerburleigh.com/">Tyler Burleigh</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Friday, January 24, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#scraping-job-postings" id="toc-scraping-job-postings" class="nav-link" data-scroll-target="#scraping-job-postings">Scraping job postings</a></li>
  <li><a href="#general-purpose-llm-completion-function" id="toc-general-purpose-llm-completion-function" class="nav-link" data-scroll-target="#general-purpose-llm-completion-function">General-purpose LLM completion function</a></li>
  <li><a href="#extract-responsibilities-skills-and-qualifications" id="toc-extract-responsibilities-skills-and-qualifications" class="nav-link" data-scroll-target="#extract-responsibilities-skills-and-qualifications">Extract Responsibilities, Skills, and Qualifications</a></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification">Classification</a>
  <ul class="collapse">
  <li><a href="#classify-jobs-as-relevant-to-genaillm-work-or-not" id="toc-classify-jobs-as-relevant-to-genaillm-work-or-not" class="nav-link" data-scroll-target="#classify-jobs-as-relevant-to-genaillm-work-or-not">Classify jobs as relevant to GenAI/LLM work or not</a></li>
  <li><a href="#classify-genaillm-jobs-into-pre-defined-categories" id="toc-classify-genaillm-jobs-into-pre-defined-categories" class="nav-link" data-scroll-target="#classify-genaillm-jobs-into-pre-defined-categories">Classify GenAI/LLM jobs into pre-defined categories</a></li>
  </ul></li>
  <li><a href="#load-final-data" id="toc-load-final-data" class="nav-link" data-scroll-target="#load-final-data">Load final data</a></li>
  <li><a href="#salary-analysis" id="toc-salary-analysis" class="nav-link" data-scroll-target="#salary-analysis">Salary analysis</a></li>
  <li><a href="#job-responsibilities" id="toc-job-responsibilities" class="nav-link" data-scroll-target="#job-responsibilities">Job responsibilities</a>
  <ul class="collapse">
  <li><a href="#o1-generated-senior-ai-research-scientist" id="toc-o1-generated-senior-ai-research-scientist" class="nav-link" data-scroll-target="#o1-generated-senior-ai-research-scientist">o1-generated Senior AI Research Scientist</a>
  <ul class="collapse">
  <li><a href="#responsibilities" id="toc-responsibilities" class="nav-link" data-scroll-target="#responsibilities">Responsibilities</a></li>
  <li><a href="#skills" id="toc-skills" class="nav-link" data-scroll-target="#skills">Skills</a></li>
  </ul></li>
  <li><a href="#o1-generated-senior-ai-ml-engineer" id="toc-o1-generated-senior-ai-ml-engineer" class="nav-link" data-scroll-target="#o1-generated-senior-ai-ml-engineer">o1-generated Senior AI ML Engineer</a>
  <ul class="collapse">
  <li><a href="#responsibilities-1" id="toc-responsibilities-1" class="nav-link" data-scroll-target="#responsibilities-1">Responsibilities</a></li>
  <li><a href="#skills-1" id="toc-skills-1" class="nav-link" data-scroll-target="#skills-1">Skills</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#job-titles" id="toc-job-titles" class="nav-link" data-scroll-target="#job-titles">Job titles</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>As someone currently working in a “Prompt Engineering” role, I’ve been thinking a lot about how this title basically doesn’t exist outside of a handful of companies, how the title communicates a narrow range of skills and responsibilities,and how the work that I do day-to-day is much larger in scope than just writing prompts. I identify more as an AI Engineer or AI Research Scientist, and so I was interested to see what I could learn about other similar roles that work with GenAI and LLMs.</p>
<p>So with that motivation, I set about to collect some data and look at the job market for these sorts of roles. What responsibilities and skills are being advertised most often, what kinds of titles are being used for these roles, and what kind of compensation is being offered at different levels of seniority?</p>
<p>To accomplish this, I built a custom web scraper to collect ~1000 job postings from ai-jobs.net. My code gathers job details like the title, company, location, salary, and posting date – from a range of U.S. and Canadian cities, covering entry-level, mid-level, and senior positions. I then use a Large Language Model (LLM) to extract each job’s key responsibilities, required skills, and qualifications. Afterwards, I classify each position to see whether it involves working with Generative AI or large language models, and if so, categorize it further into four major AI roles: (1) AI Research Scientist, (2) AI/ML Engineer, (3) MLOps/AI Infrastructure Engineer, and (4) AI Solution Architect. I believe this set of roles is a good representation of different areas of focus.</p>
<p>Finally, I integrate the various metadata and classifications into a comprehensive dataset. I observe that GenAI/LLM positions command consistently high salary ranges across the four different roles, particularly at more senior levels. Senior-level roles tended to offer median salaries in the $195K–$210K range, while mid-level roles generally clustered around $165K–$180K. Entry-level salaries showed greater variation (likely due to the small sample size) but still landed in competitive ranges of roughly $155K–$205K in many postings. These roles often share common technical demands—like proficiency with large-scale model training, distributed computing, and LLM-specific knowledge—though each role emphasizes distinct priorities (research vs.&nbsp;production, for example).</p>
</section>
<section id="scraping-job-postings" class="level1">
<h1>Scraping job postings</h1>
<p>I’ll scrape job postings from ai-jobs.net.</p>
<p>The code below implements a web scraper for job postings from ai-jobs.net. It collects job postings from major cities in the US and Canada, searching across entry-level, mid-level, and senior positions. For each job, it gets the title, company, location, salary, description, and posting date. The scraper saves each job as a JSON file and keeps track of what it has already scraped to avoid duplicates. It includes error handling and logging to track any problems that occur during scraping.</p>
<div id="fac2c9f9" class="cell" data-code-fold-show="false" data-execution_count="1">
<details class="code-fold">
<summary>Click to view the Job Posting Scraper code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Optional, Set</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobData:</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Structured container for job posting data"""</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    title: <span class="bu">str</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    company: <span class="bu">str</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    location: <span class="bu">str</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    level: Optional[<span class="bu">str</span>]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    salary: Optional[<span class="bu">str</span>]</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    url: <span class="bu">str</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    description: <span class="bu">str</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    scraped_date: <span class="bu">str</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    posted_date: Optional[<span class="bu">str</span>]</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    raw_data: <span class="bu">str</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ScrapeConfig:</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Configuration settings for the scraper"""</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    EXPERIENCE_LEVELS <span class="op">=</span> [<span class="st">'EN'</span>, <span class="st">'MI'</span>, <span class="st">'SE'</span>]  <span class="co"># Entry, Mid, Senior</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    CITIES <span class="op">=</span> {</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'5391959'</span>: <span class="st">'San Francisco'</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'5128581'</span>: <span class="st">'New York City'</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'6167865'</span>: <span class="st">'Toronto'</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">'6173331'</span>: <span class="st">'Vancouver'</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">'5809844'</span>: <span class="st">'Seattle'</span>,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">'4671654'</span>: <span class="st">'Austin'</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'4930956'</span>: <span class="st">'Boston'</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'5'</span>: <span class="st">'Region'</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    CATEGORIES <span class="op">=</span> {</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">'1'</span>: <span class="st">'Research'</span>,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">'2'</span>: <span class="st">'Engineering'</span>,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">'18'</span>: <span class="st">'GenerativeAI'</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    BASE_URL <span class="op">=</span> <span class="st">"https://ai-jobs.net"</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SalaryExtractor:</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles salary extraction logic"""</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_from_schema(schema_data: Dict) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract salary from schema.org data"""</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> schema_data <span class="kw">and</span> <span class="st">'baseSalary'</span> <span class="kw">in</span> schema_data:</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>                base_salary <span class="op">=</span> schema_data.get(<span class="st">'baseSalary'</span>, {}).get(<span class="st">'value'</span>, {})</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> base_salary:</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>                    min_value <span class="op">=</span> base_salary.get(<span class="st">'minValue'</span>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                    max_value <span class="op">=</span> base_salary.get(<span class="st">'maxValue'</span>)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>                    currency <span class="op">=</span> base_salary.get(<span class="st">'currency'</span>, <span class="st">'USD'</span>)  <span class="co"># Default to USD if not specified</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> min_value <span class="kw">and</span> max_value:</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>currency<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">float</span>(min_value)<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K - </span><span class="sc">{</span><span class="bu">float</span>(max_value)<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K"</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> min_value:</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>currency<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">float</span>(min_value)<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K+"</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>            logging.debug(<span class="ss">f"Error extracting schema salary: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_from_text(description: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract salary from description text"""</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        patterns <span class="op">=</span> [</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'(?:salary range.*?)(?:CAD|\$)?([\d,]+)\s*-\s*(?:CAD|\$)?([\d,]+)'</span>,</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'(?:salary.*?)(?:CAD|\$)?([\d,]+)(?:\s*-\s*(?:CAD|\$)?([\d,]+))?'</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pattern <span class="kw">in</span> patterns:</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> match <span class="op">:=</span> re.search(pattern, description, re.IGNORECASE):</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>                    groups <span class="op">=</span> match.groups()</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Check if salary is in CAD</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>                    currency <span class="op">=</span> <span class="st">'CAD'</span> <span class="cf">if</span> <span class="st">'CAD'</span> <span class="kw">in</span> description.upper() <span class="cf">else</span> <span class="st">'USD'</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">len</span>(groups) <span class="op">==</span> <span class="dv">2</span> <span class="kw">and</span> groups[<span class="dv">1</span>]:  <span class="co"># Range format</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>                        min_sal <span class="op">=</span> <span class="bu">float</span>(groups[<span class="dv">0</span>].replace(<span class="st">','</span>, <span class="st">''</span>))</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>                        max_sal <span class="op">=</span> <span class="bu">float</span>(groups[<span class="dv">1</span>].replace(<span class="st">','</span>, <span class="st">''</span>))</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>currency<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>min_sal<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K - </span><span class="sc">{</span>max_sal<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K"</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> groups[<span class="dv">0</span>]:  <span class="co"># Single value format</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>                        base_sal <span class="op">=</span> <span class="bu">float</span>(groups[<span class="dv">0</span>].replace(<span class="st">','</span>, <span class="st">''</span>))</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>currency<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>base_sal<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K+"</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract(cls, soup: BeautifulSoup, description: <span class="bu">str</span>, schema_data: Dict) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Main salary extraction method"""</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try schema data first</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> salary <span class="op">:=</span> cls.extract_from_schema(schema_data):</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> salary</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try description text</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> salary <span class="op">:=</span> cls.extract_from_text(description):</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> salary</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try salary badge</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> salary_badge <span class="op">:=</span> soup.find(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'badge rounded-pill text-bg-success'</span>):</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>            salary_text <span class="op">=</span> salary_badge.text.strip()</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> re.search(<span class="vs">r'(USD|\$|\d)'</span>, salary_text):</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> salary_text</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobPageParser:</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles parsing of individual job pages"""</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, html: <span class="bu">str</span>):</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.soup <span class="op">=</span> BeautifulSoup(html, <span class="st">'html.parser'</span>)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.raw_html <span class="op">=</span> html</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_schema_data(<span class="va">self</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Parse schema.org JSON-LD data"""</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> script <span class="op">:=</span> <span class="va">self</span>.soup.find(<span class="st">'script'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'application/ld+json'</span>):</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>                cleaned_script <span class="op">=</span> re.sub(<span class="vs">r'[\x00-\x1F\x7F-\x9F]'</span>, <span class="st">''</span>, script.string)</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> json.loads(cleaned_script)</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>                logging.warning(<span class="ss">f"Could not parse JSON-LD data: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_job_data(<span class="va">self</span>, url: <span class="bu">str</span>) <span class="op">-&gt;</span> JobData:</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract all job data from the page"""</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>        schema_data <span class="op">=</span> <span class="va">self</span>.parse_schema_data()</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>        scraped_date <span class="op">=</span> datetime.now().isoformat()</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get company name from schema or fallback to page element</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>        company <span class="op">=</span> schema_data.get(<span class="st">'hiringOrganization'</span>, {}).get(<span class="st">'name'</span>)</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> company:</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> company_elem <span class="op">:=</span> <span class="va">self</span>.soup.find(<span class="st">'a'</span>, class_<span class="op">=</span><span class="st">'company-name'</span>):</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>                company <span class="op">=</span> company_elem.text.strip()</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get job level from meta description</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>        level <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> meta_desc <span class="op">:=</span> <span class="va">self</span>.soup.find(<span class="st">'meta'</span>, {<span class="st">'name'</span>: <span class="st">'description'</span>}):</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> level_match <span class="op">:=</span> re.search(<span class="vs">r'a ([\w-]+level)'</span>, meta_desc[<span class="st">'content'</span>]):</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>                level <span class="op">=</span> level_match.group(<span class="dv">1</span>).replace(<span class="st">'-'</span>, <span class="st">'-level / '</span>).title()</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> JobData(</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>            title<span class="op">=</span><span class="va">self</span>.soup.find(<span class="st">'h1'</span>, class_<span class="op">=</span><span class="st">'display-5'</span>).text.strip(),</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>            company<span class="op">=</span>company,</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>            location<span class="op">=</span><span class="va">self</span>.soup.find(<span class="st">'h3'</span>, class_<span class="op">=</span><span class="st">'lead'</span>).text.strip(),</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>            level<span class="op">=</span>level,</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>            salary<span class="op">=</span>SalaryExtractor.extract(</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.soup,</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.soup.find(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'job-description-text'</span>).text.strip(),</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>                schema_data</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>            url<span class="op">=</span>url,</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="va">self</span>.soup.find(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'job-description-text'</span>).text.strip(),</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>            scraped_date<span class="op">=</span>scraped_date,</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>            posted_date<span class="op">=</span><span class="va">self</span>.calculate_posted_date(scraped_date),</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>            raw_data<span class="op">=</span><span class="va">self</span>.raw_html</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calculate_posted_date(<span class="va">self</span>, scraped_date_str: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Calculate posting date from 'posted X time ago' text"""</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> match <span class="op">:=</span> re.search(<span class="vs">r'Posted (\d+) (hours?|days?|weeks?|months?) ago'</span>, <span class="va">self</span>.raw_html):</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>            number <span class="op">=</span> <span class="bu">int</span>(match.group(<span class="dv">1</span>))</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>            unit <span class="op">=</span> match.group(<span class="dv">2</span>)</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>            scraped_date <span class="op">=</span> datetime.fromisoformat(scraped_date_str)</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>            delta <span class="op">=</span> {</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>                <span class="st">'hour'</span>: timedelta(hours<span class="op">=</span>number),</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>                <span class="st">'day'</span>: timedelta(days<span class="op">=</span>number),</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>                <span class="st">'week'</span>: timedelta(weeks<span class="op">=</span>number),</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>                <span class="st">'month'</span>: timedelta(days<span class="op">=</span>number <span class="op">*</span> <span class="dv">30</span>)  <span class="co"># Approximate</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>            }.get(unit.rstrip(<span class="st">'s'</span>))</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> delta:</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> (scraped_date <span class="op">-</span> delta).isoformat()</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AIJobScraper:</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Main scraper orchestration class"""</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'json_data'</span>):</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir <span class="op">=</span> Path(output_dir)</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.session <span class="op">=</span> requests.Session()</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.config <span class="op">=</span> ScrapeConfig()</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.existing_jobs <span class="op">=</span> <span class="va">self</span>._load_existing_jobs()</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_existing_jobs(<span class="va">self</span>) <span class="op">-&gt;</span> Set[<span class="bu">str</span>]:</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load set of existing job URLs"""</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>        existing_jobs <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> f <span class="kw">in</span> <span class="va">self</span>.output_dir.glob(<span class="st">'*.json'</span>):</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.loads(f.read_text())</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>                existing_jobs.add(data[<span class="st">'url'</span>])</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>                logging.warning(<span class="ss">f"Error reading </span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> existing_jobs</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _generate_search_urls(<span class="va">self</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate all search URL combinations"""</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>        urls <span class="op">=</span> []</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> exp <span class="kw">in</span> <span class="va">self</span>.config.EXPERIENCE_LEVELS:</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> cat <span class="kw">in</span> <span class="va">self</span>.config.CATEGORIES:</span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> city <span class="kw">in</span> <span class="va">self</span>.config.CITIES:</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>                    url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config<span class="sc">.</span>BASE_URL<span class="sc">}</span><span class="ss">/?"</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>                    url <span class="op">+=</span> <span class="ss">f"cat=</span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>                    url <span class="op">+=</span> <span class="ss">f"&amp;</span><span class="sc">{</span><span class="st">'reg'</span> <span class="cf">if</span> city <span class="op">==</span> <span class="st">'5'</span> <span class="cf">else</span> <span class="st">'cit'</span><span class="sc">}</span><span class="ss">=</span><span class="sc">{</span>city<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>                    url <span class="op">+=</span> <span class="ss">f"&amp;typ=1&amp;key=&amp;exp=</span><span class="sc">{</span>exp<span class="sc">}</span><span class="ss">&amp;sal="</span></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>                    urls.append(url)</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> urls</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_job_urls(<span class="va">self</span>, search_url: <span class="bu">str</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get all job URLs from a search page"""</span></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="va">self</span>.session.get(search_url)</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>            response.raise_for_status()</span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>            soup <span class="op">=</span> BeautifulSoup(response.text, <span class="st">'html.parser'</span>)</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> job_list <span class="op">:=</span> soup.find(<span class="st">'ul'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'job-list'</span>):</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> [</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config<span class="sc">.</span>BASE_URL<span class="sc">}{</span>link[<span class="st">'href'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> link <span class="kw">in</span> job_list.find_all(<span class="st">'a'</span>, href<span class="op">=</span><span class="kw">lambda</span> h: h <span class="kw">and</span> <span class="st">'/job/'</span> <span class="kw">in</span> h)</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Error fetching job URLs: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> scrape_job_details(<span class="va">self</span>, url: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[JobData]:</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Scrape details from a job page"""</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="va">self</span>.session.get(url)</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>            response.raise_for_status()</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>            parser <span class="op">=</span> JobPageParser(response.text)</span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> parser.parse_job_data(url)</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Error scraping job </span><span class="sc">{</span>url<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_job(<span class="va">self</span>, job: JobData) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Save job data to JSON file"""</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> re.sub(<span class="vs">r'[^\w\s-]'</span>, <span class="st">''</span>, job.title)</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>            safe_company <span class="op">=</span> re.sub(<span class="vs">r'[^\w\s-]'</span>, <span class="st">''</span>, job.company <span class="kw">or</span> <span class="st">'unknown'</span>)</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>safe_company<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span><span class="bu">hash</span>(job.url)<span class="sc">}</span><span class="ss">.json"</span></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.output_dir.joinpath(filename).write_text(</span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>                json.dumps(<span class="bu">vars</span>(job), indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>            logging.info(<span class="ss">f"Saved job: </span><span class="sc">{</span>job<span class="sc">.</span>title<span class="sc">}</span><span class="ss"> at </span><span class="sc">{</span>job<span class="sc">.</span>company<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Error saving job: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> scrape_jobs(<span class="va">self</span>, test: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Main scraping method"""</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>        jobs_found <span class="op">=</span> jobs_skipped <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> search_url <span class="kw">in</span> <span class="va">self</span>._generate_search_urls():</span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>            logging.debug(<span class="ss">f"Processing search URL: </span><span class="sc">{</span>search_url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>            job_urls <span class="op">=</span> <span class="va">self</span>.get_job_urls(search_url)</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> test <span class="kw">and</span> job_urls:</span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>                job_urls <span class="op">=</span> job_urls[:<span class="dv">1</span>]</span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> url <span class="kw">in</span> job_urls:</span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> url <span class="kw">in</span> <span class="va">self</span>.existing_jobs:</span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>                    jobs_skipped <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> job_data <span class="op">:=</span> <span class="va">self</span>.scrape_job_details(url):</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.save_job(job_data)</span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.existing_jobs.add(url)</span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>                    jobs_found <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>                time.sleep(<span class="dv">1</span>)  <span class="co"># Rate limiting</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Found </span><span class="sc">{</span>jobs_found<span class="sc">}</span><span class="ss"> new jobs. Skipped </span><span class="sc">{</span>jobs_skipped<span class="sc">}</span><span class="ss"> existing jobs."</span>)</span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">'jobs_found'</span>: jobs_found, <span class="st">'jobs_skipped'</span>: jobs_skipped}</span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scrape_jobs(test: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, verbose: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Convenience function to run the scraper"""</span></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> verbose:</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>        logging.getLogger().setLevel(logging.WARNING)</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>        scraper <span class="op">=</span> AIJobScraper(output_dir<span class="op">=</span>Path.cwd() <span class="op">/</span> <span class="st">'json_data'</span>)</span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> scraper.scrape_jobs(test<span class="op">=</span>test)</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>        logging.error(<span class="ss">f"Scraper failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="b7014a82" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#logging.basicConfig(level=logging.INFO)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#scraper = AIJobScraper()</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#scrape_results = scraper.scrape_jobs(test=False)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#print(f"Found {scrape_results['jobs_found']} new jobs, skipped {scrape_results['jobs_skipped']} existing jobs")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="general-purpose-llm-completion-function" class="level1">
<h1>General-purpose LLM completion function</h1>
<p>For the classification tasks, I’ll write a general-purpose LLM completion function. This function takes a prompt and a model as parameters, and returns the completion from the OpenAI API.</p>
<div id="3211a1e2" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> AsyncOpenAI</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_completion(prompt: <span class="bu">str</span>, model: <span class="bu">str</span> <span class="op">=</span> <span class="st">"gpt-4o-2024-08-06"</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Get a completion from the OpenAI API."""</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> AsyncOpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">'OPENAI_API_KEY'</span>))  <span class="co"># Initialize with API key from env vars</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="cf">await</span> client.chat.completions.create(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>model,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span><span class="dv">0</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extract-responsibilities-skills-and-qualifications" class="level1">
<h1>Extract Responsibilities, Skills, and Qualifications</h1>
<p>The code below uses an LLM to extract key information from job postings that will be used to classify them into different role categories. It uses OpenAI’s GPT-4o model to analyze job descriptions and extract three key components: responsibilities, skills, and qualifications. The system processes multiple jobs concurrently with rate limiting, saves the extracted data as JSON files, and includes retry logic for handling API rate limits. The code uses <code>asyncio</code> for concurrent processing and includes error handling and logging. It also checks for previously processed jobs to avoid duplicate work.</p>
<p>Also included is code that implements data preprocessing steps. This code has functions to load JSON files into a pandas DataFrame, uses a list of keywords to filter out certain jobs that are not relevant to the analysis, and removes duplicate or highly similar job descriptions using TF-IDF vectorization and cosine similarity. The main function <code>process_job_listings()</code> combines these steps, taking a directory path, similarity threshold, and filter keywords as parameters. It returns a dictionary containing the processed DataFrame along with counts of the original and filtered entries.</p>
<div id="8044692d" class="cell" data-code-fold-show="false" data-execution_count="4">
<details class="code-fold">
<summary>Click to view the code for LLM extraction</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nest_asyncio</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Optional</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tenacity <span class="im">import</span> retry, stop_after_attempt, wait_exponential, retry_if_exception_type</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> AsyncOpenAI, RateLimitError</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable nested event loops for Jupyter notebooks</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>nest_asyncio.<span class="bu">apply</span>()</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up logging configuration</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>logging.INFO,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>PROMPTS <span class="op">=</span> {</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prompt"</span>: <span class="st">"""</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="st">    You will be given a Job Description.</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="st">    Your task is to extract a list of Responsibilities,</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="st">    Skills, and Qualifications. </span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="st">    - Responsibilities are the tasks and activities that the job requires the employee to perform.</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="st">    - Skills are the abilities and knowledge that the employee needs to have to perform the responsibilities.</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="st">    - Qualifications are the requirements that the employee needs to meet to be considered for the job.</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;JobDescription&gt;</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="sc">{job_description}</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/JobDescription&gt;</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="st">    Return a list of Responsibilities, Skills, and Qualifications as follows:</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Responsibilities&gt;</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="st">    [Bullet point list of responsibilities]</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Responsibilities&gt;</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Skills&gt;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="st">    [Bullet point list of skills]</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Skills&gt;</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Qualifications&gt;</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="st">    [Bullet point list of qualifications]</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Qualifications&gt;</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobProcessor:</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, output_dir<span class="op">=</span><span class="st">'json_extracted_data'</span>):</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir <span class="op">=</span> output_dir</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.semaphore <span class="op">=</span> asyncio.Semaphore(<span class="dv">3</span>)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processed <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.skipped <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse_llm_response(<span class="va">self</span>, response: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]:</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Parse LLM response into structured data."""</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> {</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">"responsibilities"</span>: [],</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>            <span class="st">"skills"</span>: [],</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>            <span class="st">"qualifications"</span>: []</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        sections <span class="op">=</span> {</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">"responsibilities"</span>: <span class="vs">r'&lt;Responsibilities&gt;\n(.*?)\n&lt;/Responsibilities&gt;'</span>,</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>            <span class="st">"skills"</span>: <span class="vs">r'&lt;Skills&gt;\n(.*?)\n&lt;/Skills&gt;'</span>,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">"qualifications"</span>: <span class="vs">r'&lt;Qualifications&gt;\n(.*?)\n&lt;/Qualifications&gt;'</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> section, pattern <span class="kw">in</span> sections.items():</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> match <span class="op">:=</span> re.search(pattern, response, re.DOTALL):</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>                result[section] <span class="op">=</span> [</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>                    item.strip(<span class="st">'- '</span>) </span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> item <span class="kw">in</span> match.group(<span class="dv">1</span>).strip().split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> item.strip(<span class="st">'- '</span>)  <span class="co"># Filter out empty items</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> extract_job_details(<span class="va">self</span>, job_id: <span class="bu">str</span>, job_description: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]:</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract structured information from job description using LLM."""</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">=</span> PROMPTS[<span class="st">"prompt"</span>].<span class="bu">format</span>(job_description<span class="op">=</span>job_description)</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="cf">await</span> get_completion(prompt)</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> <span class="va">self</span>._parse_llm_response(response)</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Save results</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>            json_path <span class="op">=</span> os.path.join(<span class="va">self</span>.output_dir, <span class="ss">f'</span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">.json'</span>)</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(json_path, <span class="st">'w'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> f:</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>                json.dump(result, f, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Error extracting job details: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"responsibilities"</span>: [], <span class="st">"skills"</span>: [], <span class="st">"qualifications"</span>: []}</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> process_single_job(<span class="va">self</span>, job_id: <span class="bu">str</span>, description: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]:</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process a single job with caching."""</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>        json_path <span class="op">=</span> os.path.join(<span class="va">self</span>.output_dir, <span class="ss">f'</span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">.json'</span>)</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> os.path.exists(json_path):</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.skipped <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>            logging.debug(<span class="ss">f"Skipping job ID </span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss"> - already processed"</span>)</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(json_path, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> f:</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> json.load(f)</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">async</span> <span class="cf">with</span> <span class="va">self</span>.semaphore:</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.processed <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>            logging.info(<span class="ss">f"Processing job ID: </span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="cf">await</span> <span class="va">self</span>.extract_job_details(job_id, description)</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> process_jobs(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]]:</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process multiple jobs concurrently."""</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>        tasks <span class="op">=</span> [</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.process_single_job(<span class="bu">str</span>(row[<span class="st">'id'</span>]), row[<span class="st">'description'</span>])</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows()</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> <span class="cf">await</span> asyncio.gather(<span class="op">*</span>tasks)</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Processing complete:"</span>)</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"- New jobs processed: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>processed<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"- Skipped jobs (already processed): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>skipped<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataPreprocessor:</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, similarity_threshold<span class="op">=</span><span class="fl">0.8</span>):</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.similarity_threshold <span class="op">=</span> similarity_threshold</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.default_filter_keywords <span class="op">=</span> [</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Dir '</span>, <span class="st">'Director'</span>, <span class="st">'Intern'</span>, <span class="st">'Data Scientist'</span>, <span class="st">'Data Science'</span>,</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Content Writer'</span>, <span class="st">'Faculty'</span>, <span class="st">'Product Owner'</span>, <span class="st">'Manager'</span>,</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Analyst'</span>, <span class="st">'Postdoctoral'</span>, <span class="st">'Postdoc'</span>, <span class="st">'Summer'</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_json_files(directory<span class="op">=</span><span class="st">'json_data'</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load JSON files into DataFrame with error handling."""</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(directory):</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Directory </span><span class="sc">{</span>directory<span class="sc">}</span><span class="ss"> does not exist"</span>)</span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> df</span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(directory) <span class="cf">if</span> f.endswith(<span class="st">'.json'</span>)]:</span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(os.path.join(directory, <span class="bu">file</span>), <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>                    data <span class="op">=</span> json.load(f)</span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>                    df <span class="op">=</span> pd.concat([df, pd.DataFrame([data])], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>                logging.error(<span class="ss">f"Error loading </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'id'</span>] <span class="op">=</span> df[<span class="st">'url'</span>].<span class="bu">apply</span>(</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>                <span class="kw">lambda</span> x: <span class="ss">f"j</span><span class="sc">{</span>hashlib<span class="sc">.</span>md5(x.encode())<span class="sc">.</span>hexdigest()[:<span class="dv">5</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> filter_by_title(<span class="va">self</span>, df: pd.DataFrame, </span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>                       filter_keywords: Optional[List[<span class="bu">str</span>]] <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Filter DataFrame by job titles."""</span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df.empty:</span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> df</span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a>        keywords <span class="op">=</span> filter_keywords <span class="kw">or</span> <span class="va">self</span>.default_filter_keywords</span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df[<span class="op">~</span>df[<span class="st">'title'</span>].<span class="bu">str</span>.contains(</span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>            <span class="st">'|'</span>.join(keywords),</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>            case<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>            na<span class="op">=</span><span class="va">False</span></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>        )]</span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> remove_similar_descriptions(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Remove similar job descriptions using TF-IDF and cosine similarity."""</span></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df.empty:</span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> df</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>        tfidf <span class="op">=</span> TfidfVectorizer(stop_words<span class="op">=</span><span class="st">'english'</span>)</span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>        tfidf_matrix <span class="op">=</span> tfidf.fit_transform(df[<span class="st">'description'</span>].fillna(<span class="st">''</span>))</span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>        cosine_sim <span class="op">=</span> cosine_similarity(tfidf_matrix, tfidf_matrix)</span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>        indices_to_remove <span class="op">=</span> {</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>            j <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df))</span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(df))</span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cosine_sim[i][j] <span class="op">&gt;</span> <span class="va">self</span>.similarity_threshold</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df.iloc[<span class="op">~</span>df.index.isin(<span class="bu">list</span>(indices_to_remove))]</span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_jobs_from_dataframe(df: pd.DataFrame) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]]:</span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Wrapper function to process jobs from a DataFrame."""</span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>    processor <span class="op">=</span> JobProcessor()</span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a>    loop <span class="op">=</span> asyncio.get_event_loop()</span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> loop.is_running():</span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loop.create_task(processor.process_jobs(df))</span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> asyncio.run(processor.process_jobs(df))</span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_job_listings(directory<span class="op">=</span><span class="st">'json_data'</span>, similarity_threshold<span class="op">=</span><span class="fl">0.8</span>, </span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a>                        filter_keywords<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Main function to process job listings."""</span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a>    preprocessor <span class="op">=</span> DataPreprocessor(similarity_threshold)</span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load and preprocess data</span></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> preprocessor.load_json_files(directory)</span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>    initial_count <span class="op">=</span> <span class="bu">len</span>(df)</span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df.empty:</span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>            <span class="st">'processed_data'</span>: df,</span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>            <span class="st">'original_count'</span>: <span class="dv">0</span>,</span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a>            <span class="st">'filtered_count'</span>: <span class="dv">0</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> preprocessor.filter_by_title(df, filter_keywords)</span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> preprocessor.remove_similar_descriptions(df)</span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>        <span class="st">'processed_data'</span>: df_filtered,</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>        <span class="st">'original_count'</span>: initial_count,</span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>        <span class="st">'filtered_count'</span>: <span class="bu">len</span>(df_filtered)</span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>    }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d74548e7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> process_job_listings()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> results[<span class="st">'processed_data'</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Original count of listings: </span><span class="sc">{</span>results[<span class="st">"original_count"</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Filtered count of listings: </span><span class="sc">{</span>results[<span class="st">"filtered_count"</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>extract_jobs_from_dataframe(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original count of listings: 999
Filtered count of listings: 680</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>&lt;Task pending name='Task-1' coro=&lt;JobProcessor.process_jobs() running at /tmp/ipykernel_1334300/2751672584.py:118&gt;&gt;</code></pre>
</div>
</div>
</section>
<section id="classification" class="level1">
<h1>Classification</h1>
<section id="classify-jobs-as-relevant-to-genaillm-work-or-not" class="level2">
<h2 class="anchored" data-anchor-id="classify-jobs-as-relevant-to-genaillm-work-or-not">Classify jobs as relevant to GenAI/LLM work or not</h2>
<div id="4dfd7c79" class="cell" data-code-fold-show="false" data-execution_count="6">
<details class="code-fold">
<summary>Click to view the code for job classification as GenAI/LLM relevant or not</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nest_asyncio</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Set</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tenacity <span class="im">import</span> retry, stop_after_attempt, wait_exponential, retry_if_exception_type</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> AsyncOpenAI</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> RateLimitError</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobClassifierGenAI:</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles classification of jobs for GenAI/LLM work"""</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    PROMPT <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="st">    You will be given a list of Responsibilities and</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="st">    Skills listed for a job. Your task is to determine</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="st">    if the job involves working with Generative AI (GenAI)</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="st">    or language models (a.k.a. Large Language Models (LLMs)).</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Job&gt;</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Responsibilities&gt;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="sc">{responsibilities}</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Responsibilities&gt;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Skills&gt;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="sc">{skills}</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Skills&gt;</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Job&gt;</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="st">    Start by thinking step-by-step about the Job and its </span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="st">    Responsibilities and Skills, and whether it involves</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="st">    working with Generative AI (GenAI) or language models</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="st">    (a.k.a. Large Language Models (LLMs)).</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="st">    Return your response in the following format:</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Analysis&gt;</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="st">    [Your analysis of the job and its Responsibilities and Skills]</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Analysis&gt;</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;FinalAnswer&gt;</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="st">    true|false</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/FinalAnswer&gt;</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, output_dir<span class="op">=</span><span class="st">'role_genai_classifications'</span>, batch_size<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir <span class="op">=</span> output_dir</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.batch_size <span class="op">=</span> batch_size</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.semaphore <span class="op">=</span> asyncio.Semaphore(batch_size)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> classify_job(<span class="va">self</span>, job: Dict) <span class="op">-&gt;</span> Dict:</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Classify a single job listing"""</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Classifying job '</span><span class="sc">{</span>job[<span class="st">'filename'</span>]<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="va">self</span>.PROMPT.<span class="bu">format</span>(</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>            responsibilities<span class="op">=</span>job[<span class="st">'responsibilities'</span>],</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>            skills<span class="op">=</span>job.get(<span class="st">'skills'</span>, <span class="st">''</span>)</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="cf">await</span> get_completion(prompt)</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">await</span> asyncio.sleep(<span class="dv">2</span>)  <span class="co"># Rate limiting</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Failed to classify job '</span><span class="sc">{</span>job[<span class="st">'filename'</span>]<span class="sc">}</span><span class="ss">': </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>                <span class="op">**</span>job,</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>                <span class="st">'analysis'</span>: <span class="ss">f'Failed to process: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>                <span class="st">'is_genai_role'</span>: <span class="va">None</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._parse_response(job, response)</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse_response(<span class="va">self</span>, job: Dict, response: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Parse LLM response into structured format"""</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>        soup <span class="op">=</span> BeautifulSoup(<span class="ss">f"&lt;root&gt;</span><span class="sc">{</span>response<span class="sc">}</span><span class="ss">&lt;/root&gt;"</span>, <span class="st">'lxml-xml'</span>)</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>        analysis <span class="op">=</span> soup.find(<span class="st">'Analysis'</span>)</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>        final_answer <span class="op">=</span> soup.find(<span class="st">'FinalAnswer'</span>)</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>        is_genai_role <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> final_answer:</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>            answer_text <span class="op">=</span> final_answer.text.strip().lower()</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>            is_genai_role <span class="op">=</span> <span class="va">True</span> <span class="cf">if</span> answer_text <span class="op">==</span> <span class="st">'true'</span> <span class="cf">else</span> <span class="va">False</span> <span class="cf">if</span> answer_text <span class="op">==</span> <span class="st">'false'</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>job,</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>            <span class="st">'analysis'</span>: analysis.text.strip() <span class="cf">if</span> analysis <span class="cf">else</span> <span class="st">''</span>,</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>            <span class="st">'is_genai_role'</span>: is_genai_role</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_classification(<span class="va">self</span>, job_id: <span class="bu">str</span>, result: Dict) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Save classification results to file"""</span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> os.path.join(<span class="va">self</span>.output_dir, <span class="ss">f"</span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">.json"</span>)</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>            json.dump(result, f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Saved classification for job </span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_classified_jobs(<span class="va">self</span>) <span class="op">-&gt;</span> Set[<span class="bu">str</span>]:</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get set of already classified job IDs"""</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="va">self</span>.output_dir):</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">set</span>()</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {f[:<span class="op">-</span><span class="dv">5</span>] <span class="cf">for</span> f <span class="kw">in</span> os.listdir(<span class="va">self</span>.output_dir) <span class="cf">if</span> f.endswith(<span class="st">'.json'</span>)}</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> process_jobs_batch(<span class="va">self</span>, jobs: List[Dict]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process a batch of jobs concurrently"""</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">async</span> <span class="kw">def</span> process_with_semaphore(job: Dict) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="cf">with</span> <span class="va">self</span>.semaphore:</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> <span class="cf">await</span> <span class="va">self</span>.classify_job(job)</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>                job_id <span class="op">=</span> <span class="bu">str</span>(result[<span class="st">'filename'</span>])</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.save_classification(job_id, result)</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.gather(<span class="op">*</span>[process_with_semaphore(job) <span class="cf">for</span> job <span class="kw">in</span> jobs])</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> classify_jobs_async(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process all unclassified jobs in the DataFrame"""</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>        total_jobs <span class="op">=</span> <span class="bu">len</span>(df)</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Starting classification of </span><span class="sc">{</span>total_jobs<span class="sc">}</span><span class="ss"> jobs"</span>)</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>        classified_jobs <span class="op">=</span> <span class="va">self</span>.get_classified_jobs()</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>        jobs_to_process <span class="op">=</span> [</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>            job.to_dict() <span class="cf">for</span> idx, job <span class="kw">in</span> df.iterrows() </span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">str</span>(job[<span class="st">'filename'</span>]) <span class="kw">not</span> <span class="kw">in</span> classified_jobs</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="va">self</span>.process_jobs_batch(jobs_to_process)</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Completed classification of all </span><span class="sc">{</span>total_jobs<span class="sc">}</span><span class="ss"> jobs"</span>)</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> classify_jobs(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Main entry point for job classification"""</span></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df.empty:</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>            logging.warning(<span class="st">"Empty DataFrame provided"</span>)</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'filename'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="st">"DataFrame missing required 'filename' column"</span>)</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>        classified_jobs <span class="op">=</span> <span class="va">self</span>.get_classified_jobs()</span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(classified_jobs)<span class="sc">}</span><span class="ss"> previously classified jobs"</span>)</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>        new_jobs <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">'filename'</span>].isin(classified_jobs)]</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> new_jobs.empty:</span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>            logging.info(<span class="st">"No new jobs to classify"</span>)</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Processing </span><span class="sc">{</span><span class="bu">len</span>(new_jobs)<span class="sc">}</span><span class="ss"> new jobs"</span>)</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Skipping </span><span class="sc">{</span><span class="bu">len</span>(df) <span class="op">-</span> <span class="bu">len</span>(new_jobs)<span class="sc">}</span><span class="ss"> existing jobs"</span>)</span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>        loop <span class="op">=</span> asyncio.get_event_loop()</span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>        loop.run_until_complete(<span class="va">self</span>.classify_jobs_async(new_jobs))</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobDataLoader:</span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles loading and preprocessing of job data"""</span></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> read_json_files(json_dir<span class="op">=</span><span class="st">'json_extracted_data'</span>) <span class="op">-&gt;</span> List[Dict]:</span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Read job data from JSON files"""</span></span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> []</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(json_dir):</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> filename.endswith(<span class="st">'.json'</span>):</span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> os.path.join(json_dir, filename)</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> json.load(f)</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>                        name <span class="op">=</span> filename[:<span class="op">-</span><span class="dv">5</span>]</span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">'responsibilities'</span> <span class="kw">in</span> data <span class="kw">and</span> <span class="st">'skills'</span> <span class="kw">in</span> data:</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>                            result.append({</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'filename'</span>: name,</span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'responsibilities'</span>: data[<span class="st">'responsibilities'</span>],</span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'skills'</span>: data[<span class="st">'skills'</span>]</span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>                            })</span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>                    logging.error(<span class="ss">f"Invalid JSON in </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>                    logging.error(<span class="ss">f"Error processing </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_classifications(input_dir<span class="op">=</span><span class="st">'role_genai_classifications'</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load classification results into DataFrame"""</span></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(input_dir):</span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> pd.DataFrame()</span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a>        all_results <span class="op">=</span> []</span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(input_dir):</span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> filename.endswith(<span class="st">'.json'</span>):</span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(os.path.join(input_dir, filename), <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>                    classification <span class="op">=</span> json.load(f)</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a>                    all_results.append(classification)</span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame(all_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="e01894db" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> JobDataLoader()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>jobs <span class="op">=</span> loader.read_json_files()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(jobs)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#classifier = JobClassifierGenAI()</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#classifier.classify_jobs(df)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load results</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#results_df = loader.load_classifications()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="classify-genaillm-jobs-into-pre-defined-categories" class="level2">
<h2 class="anchored" data-anchor-id="classify-genaillm-jobs-into-pre-defined-categories">Classify GenAI/LLM jobs into pre-defined categories</h2>
<p>For this next classification task, I’ll make the assumption that there are four types of AI engineering and science roles that are relevant to work with GenAI systems. These are:</p>
<ol type="1">
<li>AI Research Scientist</li>
<li>AI/ML Engineer</li>
<li>MLOps / AI Infrastructure Engineer</li>
<li>AI Solution Architect</li>
</ol>
<p>I’ll also include other categories that are not of interest, but may improve classification accuracy. These are:</p>
<ol start="5" type="1">
<li>Data Scientist</li>
<li>Data Engineer</li>
<li>Product Manager</li>
<li>Software Engineer</li>
</ol>
<p>The code below implements an automated job classification system that uses an LLM to categorize job postings into the eight predefined roles listed above (four GenAI-focused and four related roles). It consists of several classes that work together: JobClassifier handles the core classification logic by comparing job descriptions against detailed role templates, JobData and ClassificationResult provide structured data containers, and JobProcessor manages the overall pipeline from loading jobs to saving results. The system processes jobs concurrently using asyncio, includes error handling and rate limiting, and outputs both an analysis explaining the classification and a final numerical category (0-8) for each job, with all results saved as JSON files for further analysis.</p>
<p>Definitions of the roles can be found in the <code>JOB_DESCRIPTIONS</code> variable.</p>
<div id="872d4f90" class="cell" data-code-fold-show="false" data-execution_count="8">
<details class="code-fold">
<summary>Click to view the code for job classification into pre-defined roles</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Set, Optional</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nest_asyncio</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>JOB_DESCRIPTIONS <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="AI Research Scientist" number="1"&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="st">    Investigate and adapt cutting-edge AI methodologies (e.g., generative models, advanced prompt engineering) for applications.</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="st">    Conduct experiments to evaluate the performance (e.g., quality, accuracy) of new AI approaches and refine existing models.</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate with AI/ML Engineers to transition successful prototypes into production.</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="st">    Stay current with the latest AI research and emerging trends in generative AI.</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop human-annotated datasets for training and evaluation of AI models.</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="st">    Deep understanding of LLMs and prompt engineering.</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong background in statistics, optimization, or related fields.</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="st">    Knowledge of experimental methods (e.g., A/B testing) and hypothesis testing.</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="st">    Knowledge of LLM evaluation methods, including algorithmic evals, human evals, or LLM-as-a-judge evals.</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="AI/ML Engineer" number="2"&gt;</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="st">    Transform research output into robust, scalable AI solutions for the product or internal use.</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="st">    Productionize AI models, ensuring they meet performance and reliability requirements.</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop and maintain data pipelines for model training, inference, and monitoring.</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate closely with Research Scientists to optimize and refine model implementations.</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="st">    Proficiency in Python, Go, or similar languages.</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with API development and integration (REST, GraphQL).</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="st">    Working knowledge of software engineering best practices (version control, testing, CI/CD).</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="MLOps / AI Infrastructure Engineer" number="3"&gt;</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="st">    Ensure reliable deployment, scaling, and monitoring of AI systems in production.</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="st">    Set up CI/CD pipelines tailored for AI workflows, including model versioning and data governance.</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="st">    Monitor production models for performance, latency, and data drift, implementing necessary updates.</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="st">    Manage infrastructure for scalable AI deployments (Docker, Kubernetes, cloud services).</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong DevOps background, with tools like Docker, Kubernetes, and Terraform.</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with ML orchestration/monitoring tools (MLflow, Airflow, Prometheus).</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience optimizing compute usage (GPU/TPU) for cost-effective scaling.</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="AI Solution Architect" number="4"&gt;</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="st">    Design and orchestrate AI solutions leveraging generative models and LLM technologies to create impactful experiences and solutions that align with business objectives.</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate with subject matter experts (SMEs) to identify and refine opportunities for generative AI/LLM-based use cases.</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="st">    Assess feasibility and define high-level solution architectures, ensuring they address core business and user requirements.</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop technical proposals and roadmaps, translating complex requirements into actionable plans.</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="st">    Provide thought leadership on conversational design, user experience flow, and model interaction strategies.</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="st">    Ensure solutions comply with relevant data governance, privacy, and security considerations.</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="st">    Facilitate cross-functional collaboration, guiding teams through solution conceptualization and implementation phases.</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong understanding of LLM capabilities and prompt engineering principles.</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with conversational experience design (e.g., chatbots, voice interfaces) and user journey mapping.</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="st">    Ability to analyze business needs and translate them into feasible AI solution proposals.</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with data privacy and security best practices, especially as they pertain to AI solutions.</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="st">    Excellent communication and stakeholder management skills to align technical and non-technical teams.</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="Data Scientist" number="5"&gt; </span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="st">    Leverage statistical analysis, machine learning, and data visualization to derive actionable insights and guide data-informed decisions.</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt; </span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt; </span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="st">    Perform exploratory data analysis (EDA) to identify trends and patterns in large, complex datasets. </span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop and validate predictive and prescriptive models, collaborating with cross-functional teams to implement these solutions. </span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a><span class="st">    Design and execute experiments to test hypotheses, measure impact, and inform business strategies. </span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a><span class="st">    Present findings and recommendations to stakeholders in a clear, concise manner using visualizations and dashboards. </span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="st">    Work with data engineers to ensure data quality, governance, and availability. </span></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt; </span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt; </span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="st">    Proficiency in Python, R, or SQL for data manipulation and analysis. </span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with common ML libraries (e.g., scikit-learn, XGBoost) and deep learning frameworks (e.g., PyTorch, TensorFlow). </span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a><span class="st">    Solid grounding in statistics, probability, and experimental design. </span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with data visualization tools (e.g., Tableau, Power BI) for communicating insights. </span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong analytical thinking and ability to translate complex data problems into business solutions. </span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt; </span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="Data Engineer" number="6"&gt;</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a><span class="st">    Design, build, and maintain scalable data pipelines and architectures that enable efficient data collection, storage, and analysis.</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop and optimize data ingestion and transformation processes (ETL/ELT), ensuring high performance and reliability.</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a><span class="st">    Implement and manage data workflows, integrating internal and external data sources.</span></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate with Data Scientists, AI/ML Engineers, and other stakeholders to ensure data readiness for analytics and model training.</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a><span class="st">    Monitor data pipelines for performance, reliability, and cost-effectiveness, taking corrective actions when needed.</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a><span class="st">    Maintain data quality and governance standards, including metadata management and data cataloging.</span></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a><span class="st">    Proficiency in Python, SQL, and distributed data processing frameworks (e.g., Spark, Kafka).</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with cloud-based data ecosystems (AWS, GCP, or Azure), and related storage/processing services (e.g., S3, BigQuery, Dataflow).</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with infrastructure-as-code and DevOps tools (Terraform, Docker, Kubernetes) for automating data platform deployments.</span></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong understanding of database systems (relational, NoSQL) and data modeling principles.</span></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="st">    Knowledge of data orchestration and workflow management tools (Airflow, Luigi, Dagster).</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="Product Manager" number="7"&gt;</span></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a><span class="st">    Drive the product vision and strategy, ensuring alignment with business goals and user needs while delivering impactful AI-driven solutions.</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a><span class="st">    Conduct user and market research to identify opportunities, define product requirements, and set success metrics.</span></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate with cross-functional teams (Engineering, Data Science, Design) to prioritize features and plan releases.</span></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop and communicate product roadmaps, ensuring stakeholders are aligned on goals and timelines.</span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a><span class="st">    Monitor product performance through data analysis and user feedback, iterating on improvements and new feature ideas.</span></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a><span class="st">    Facilitate agile development practices, writing clear user stories and acceptance criteria.</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong understanding of product lifecycle management and agile methodologies (Scrum/Kanban).</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a><span class="st">    Excellent communication, negotiation, and stakeholder management skills.</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with product management and collaboration tools (e.g., Jira, Confluence, Trello).</span></span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a><span class="st">    Analytical mindset for leveraging metrics, A/B testing, and user feedback in decision-making.</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with AI/ML concepts and the ability to translate technical possibilities into viable product features.</span></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="Software Engineer" number="8"&gt;</span></span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a><span class="st">  Design, develop, and maintain high-quality software applications and services that address user needs and align with overall business objectives.</span></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate with cross-functional teams (Product, Design, QA) to interpret requirements and deliver robust solutions.</span></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a><span class="st">    Write clean, efficient, and testable code following best practices and coding standards.</span></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a><span class="st">    Participate in system architecture and design discussions, contributing to the evolution of technical roadmaps.</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a><span class="st">    Perform code reviews and provide constructive feedback to peers, maintaining a high bar for code quality.</span></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a><span class="st">    Implement and maintain CI/CD pipelines to streamline deployment and reduce manual interventions.</span></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a><span class="st">    Continuously improve system performance and scalability through profiling and optimization.</span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a><span class="st">    Proficiency in one or more programming languages (e.g., Java, Python, JavaScript, C++).</span></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with modern frameworks/libraries (e.g., Spring Boot, Node.js, React, Django).</span></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a><span class="st">    Solid understanding of software design principles (e.g., SOLID, DRY) and architectural patterns (e.g., microservices).</span></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with version control systems (Git), testing frameworks, and agile methodologies.</span></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a><span class="st">    Working knowledge of containerization (Docker), orchestration (Kubernetes), and cloud platforms (AWS, Azure, GCP).</span></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>PROMPTS <span class="op">=</span> {</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a><span class="st">"prompt"</span>: <span class="st">"""</span></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a><span class="st">You will be given a list of Responsibilities and</span></span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a><span class="st">Skills listed for a job. Your task is to determine</span></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a><span class="st">if the job is a good fit with any of the Options,</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a><span class="st">and if so, which one.</span></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Job&gt;</span></span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Responsibilities&gt;</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a><span class="sc">{responsibilities}</span></span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Responsibilities&gt;</span></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Skills&gt;</span></span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a><span class="sc">{skills}</span></span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Skills&gt;</span></span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Job&gt;</span></span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Options&gt;</span></span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a><span class="sc">{Options}</span></span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Options&gt;</span></span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a><span class="st">Start by thinking step-by-step about the Job and its </span></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a><span class="st">Responsibilities and Skills, in relation to each of the </span></span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a><span class="st">Options.</span></span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a><span class="st">Decide if the Job is a good fit with ANY of the Options.</span></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a><span class="st">If NONE of the Options are relevant to the Job, say so and </span></span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a><span class="st">return a 0 as your FinalAnswer.</span></span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a><span class="st">Otherwise, decide which of the Options is the most similar</span></span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a><span class="st">to the Job and return its number as your FinalAnswer.</span></span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a><span class="st">Return your response in the following format:</span></span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Analysis&gt;</span></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a><span class="st">[Your analysis of the job and its Responsibilities and Skills, in relation each of the Options]</span></span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Analysis&gt;</span></span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;FinalAnswer&gt;</span></span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a><span class="st">0|1|2|3|4|5|6|7|8</span></span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/FinalAnswer&gt;</span></span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable nested event loops</span></span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a>nest_asyncio.<span class="bu">apply</span>()</span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobData:</span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Represents a job posting with extracted information."""</span></span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a>    filename: <span class="bu">str</span></span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a>    responsibilities: List[<span class="bu">str</span>]</span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a>    skills: List[<span class="bu">str</span>]</span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ClassificationResult:</span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Represents the result of a job classification."""</span></span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>    filename: <span class="bu">str</span></span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>    responsibilities: List[<span class="bu">str</span>]</span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>    skills: List[<span class="bu">str</span>]</span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>    analysis: <span class="bu">str</span></span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a>    role_classification: Optional[<span class="bu">int</span>]</span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>    role_title: Optional[<span class="bu">str</span>]</span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobClassifier:</span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles classification of jobs into predefined roles."""</span></span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'role_classifications'</span>, batch_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span>):</span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir <span class="op">=</span> output_dir</span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.batch_size <span class="op">=</span> batch_size</span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.semaphore <span class="op">=</span> asyncio.Semaphore(batch_size)</span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a>        os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> classify_job(<span class="va">self</span>, job: JobData) <span class="op">-&gt;</span> ClassificationResult:</span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Classify a single job listing."""</span></span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Classifying job '</span><span class="sc">{</span>job<span class="sc">.</span>filename<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> PROMPTS[<span class="st">"prompt"</span>].<span class="bu">format</span>(</span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a>            responsibilities<span class="op">=</span>job.responsibilities,  <span class="co"># Access as attribute instead of dict</span></span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a>            skills<span class="op">=</span>job.skills,  <span class="co"># Access as attribute instead of dict</span></span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a>            Options<span class="op">=</span>JOB_DESCRIPTIONS</span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="cf">await</span> get_completion(prompt)</span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a>            <span class="cf">await</span> asyncio.sleep(<span class="dv">5</span>)  <span class="co"># Rate limiting</span></span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parse_response(job, response)</span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Failed to classify job '</span><span class="sc">{</span>job<span class="sc">.</span>filename<span class="sc">}</span><span class="ss">': </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ClassificationResult(</span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>                filename<span class="op">=</span>job.filename,</span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a>                responsibilities<span class="op">=</span>job.responsibilities,</span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a>                skills<span class="op">=</span>job.skills,</span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>                analysis<span class="op">=</span><span class="ss">f'Failed to process: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>                role_classification<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a>                role_title<span class="op">=</span><span class="va">None</span></span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse_response(<span class="va">self</span>, job: JobData, response: <span class="bu">str</span>) <span class="op">-&gt;</span> ClassificationResult:</span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Parse LLM response into structured format."""</span></span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a>        soup <span class="op">=</span> BeautifulSoup(<span class="ss">f"&lt;root&gt;</span><span class="sc">{</span>response<span class="sc">}</span><span class="ss">&lt;/root&gt;"</span>, <span class="st">'lxml-xml'</span>)</span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a>        analysis <span class="op">=</span> soup.find(<span class="st">'Analysis'</span>)</span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a>        role_choice <span class="op">=</span> soup.find(<span class="st">'FinalAnswer'</span>)</span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a>        role_number <span class="op">=</span> <span class="bu">int</span>(role_choice.text.strip()) <span class="cf">if</span> role_choice <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a>        role_title <span class="op">=</span> <span class="va">self</span>._get_role_title(role_number)</span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ClassificationResult(</span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a>            filename<span class="op">=</span>job.filename,</span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a>            responsibilities<span class="op">=</span>job.responsibilities,</span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a>            skills<span class="op">=</span>job.skills,</span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a>            analysis<span class="op">=</span>analysis.text.strip() <span class="cf">if</span> analysis <span class="cf">else</span> <span class="st">''</span>,</span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a>            role_classification<span class="op">=</span>role_number,</span>
<span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a>            role_title<span class="op">=</span>role_title</span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_role_title(<span class="va">self</span>, role_number: Optional[<span class="bu">int</span>]) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get the title for a role number."""</span></span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> role_number <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb10-275"><a href="#cb10-275" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb10-276"><a href="#cb10-276" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> role_number <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb10-277"><a href="#cb10-277" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"Other"</span></span>
<span id="cb10-278"><a href="#cb10-278" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-279"><a href="#cb10-279" aria-hidden="true" tabindex="-1"></a>        wrapped_xml <span class="op">=</span> <span class="ss">f"&lt;root&gt;</span><span class="sc">{</span>JOB_DESCRIPTIONS<span class="sc">}</span><span class="ss">&lt;/root&gt;"</span></span>
<span id="cb10-280"><a href="#cb10-280" aria-hidden="true" tabindex="-1"></a>        job_descriptions_soup <span class="op">=</span> BeautifulSoup(wrapped_xml, <span class="st">'lxml-xml'</span>)</span>
<span id="cb10-281"><a href="#cb10-281" aria-hidden="true" tabindex="-1"></a>        matching_job <span class="op">=</span> job_descriptions_soup.find(<span class="st">'Option'</span>, {<span class="st">'number'</span>: <span class="bu">str</span>(role_number)})</span>
<span id="cb10-282"><a href="#cb10-282" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-283"><a href="#cb10-283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> matching_job:</span>
<span id="cb10-284"><a href="#cb10-284" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> matching_job[<span class="st">'title'</span>]</span>
<span id="cb10-285"><a href="#cb10-285" aria-hidden="true" tabindex="-1"></a>        logging.error(<span class="ss">f"No matching job found for role number </span><span class="sc">{</span>role_number<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-286"><a href="#cb10-286" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb10-287"><a href="#cb10-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-288"><a href="#cb10-288" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobProcessor:</span>
<span id="cb10-289"><a href="#cb10-289" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles the processing of job data files."""</span></span>
<span id="cb10-290"><a href="#cb10-290" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-291"><a href="#cb10-291" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'json_extracted_data'</span>):</span>
<span id="cb10-292"><a href="#cb10-292" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_dir <span class="op">=</span> input_dir</span>
<span id="cb10-293"><a href="#cb10-293" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.classifier <span class="op">=</span> JobClassifier()</span>
<span id="cb10-294"><a href="#cb10-294" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-295"><a href="#cb10-295" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_jobs(<span class="va">self</span>) <span class="op">-&gt;</span> List[JobData]:</span>
<span id="cb10-296"><a href="#cb10-296" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load jobs from JSON files."""</span></span>
<span id="cb10-297"><a href="#cb10-297" aria-hidden="true" tabindex="-1"></a>        jobs <span class="op">=</span> []</span>
<span id="cb10-298"><a href="#cb10-298" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get list of all JSON files</span></span>
<span id="cb10-299"><a href="#cb10-299" aria-hidden="true" tabindex="-1"></a>        total_files <span class="op">=</span> <span class="bu">len</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(<span class="va">self</span>.input_dir) <span class="cf">if</span> f.endswith(<span class="st">'.json'</span>)])</span>
<span id="cb10-300"><a href="#cb10-300" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get files that were classified as GenAI-relevant</span></span>
<span id="cb10-301"><a href="#cb10-301" aria-hidden="true" tabindex="-1"></a>        classified_files <span class="op">=</span> <span class="va">self</span>._get_classified_files()</span>
<span id="cb10-302"><a href="#cb10-302" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get files that have already been processed</span></span>
<span id="cb10-303"><a href="#cb10-303" aria-hidden="true" tabindex="-1"></a>        processed_files <span class="op">=</span> {</span>
<span id="cb10-304"><a href="#cb10-304" aria-hidden="true" tabindex="-1"></a>            f[:<span class="op">-</span><span class="dv">5</span>] <span class="cf">for</span> f <span class="kw">in</span> os.listdir(<span class="va">self</span>.classifier.output_dir) </span>
<span id="cb10-305"><a href="#cb10-305" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> f.endswith(<span class="st">'.json'</span>)</span>
<span id="cb10-306"><a href="#cb10-306" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-307"><a href="#cb10-307" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get relevant files that haven't been processed yet</span></span>
<span id="cb10-308"><a href="#cb10-308" aria-hidden="true" tabindex="-1"></a>        files_to_process <span class="op">=</span> classified_files <span class="op">-</span> processed_files</span>
<span id="cb10-309"><a href="#cb10-309" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-310"><a href="#cb10-310" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Found </span><span class="sc">{</span>total_files<span class="sc">}</span><span class="ss"> total files"</span>)</span>
<span id="cb10-311"><a href="#cb10-311" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(classified_files)<span class="sc">}</span><span class="ss"> relevant GenAI files"</span>)</span>
<span id="cb10-312"><a href="#cb10-312" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Already processed: </span><span class="sc">{</span><span class="bu">len</span>(processed_files)<span class="sc">}</span><span class="ss"> files"</span>)</span>
<span id="cb10-313"><a href="#cb10-313" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Remaining to process: </span><span class="sc">{</span><span class="bu">len</span>(files_to_process)<span class="sc">}</span><span class="ss"> files"</span>)</span>
<span id="cb10-314"><a href="#cb10-314" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-315"><a href="#cb10-315" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Only process files that are both relevant and unprocessed</span></span>
<span id="cb10-316"><a href="#cb10-316" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(<span class="va">self</span>.input_dir):</span>
<span id="cb10-317"><a href="#cb10-317" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> filename.endswith(<span class="st">'.json'</span>):</span>
<span id="cb10-318"><a href="#cb10-318" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb10-319"><a href="#cb10-319" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-320"><a href="#cb10-320" aria-hidden="true" tabindex="-1"></a>            name <span class="op">=</span> filename[:<span class="op">-</span><span class="dv">5</span>]</span>
<span id="cb10-321"><a href="#cb10-321" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> name <span class="kw">not</span> <span class="kw">in</span> files_to_process:</span>
<span id="cb10-322"><a href="#cb10-322" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb10-323"><a href="#cb10-323" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-324"><a href="#cb10-324" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb10-325"><a href="#cb10-325" aria-hidden="true" tabindex="-1"></a>                job <span class="op">=</span> <span class="va">self</span>._load_job_file(filename)</span>
<span id="cb10-326"><a href="#cb10-326" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> job:</span>
<span id="cb10-327"><a href="#cb10-327" aria-hidden="true" tabindex="-1"></a>                    jobs.append(job)</span>
<span id="cb10-328"><a href="#cb10-328" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-329"><a href="#cb10-329" aria-hidden="true" tabindex="-1"></a>                logging.error(<span class="ss">f"Error processing </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-330"><a href="#cb10-330" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-331"><a href="#cb10-331" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Processing </span><span class="sc">{</span><span class="bu">len</span>(jobs)<span class="sc">}</span><span class="ss"> remaining jobs"</span>)</span>
<span id="cb10-332"><a href="#cb10-332" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jobs</span>
<span id="cb10-333"><a href="#cb10-333" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-334"><a href="#cb10-334" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_job_file(<span class="va">self</span>, filename: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[JobData]:</span>
<span id="cb10-335"><a href="#cb10-335" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load and parse a single job file."""</span></span>
<span id="cb10-336"><a href="#cb10-336" aria-hidden="true" tabindex="-1"></a>        file_path <span class="op">=</span> os.path.join(<span class="va">self</span>.input_dir, filename)</span>
<span id="cb10-337"><a href="#cb10-337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-338"><a href="#cb10-338" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb10-339"><a href="#cb10-339" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb10-340"><a href="#cb10-340" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">'responsibilities'</span> <span class="kw">in</span> data <span class="kw">and</span> <span class="st">'skills'</span> <span class="kw">in</span> data:</span>
<span id="cb10-341"><a href="#cb10-341" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> JobData(</span>
<span id="cb10-342"><a href="#cb10-342" aria-hidden="true" tabindex="-1"></a>                        filename<span class="op">=</span>filename[:<span class="op">-</span><span class="dv">5</span>],</span>
<span id="cb10-343"><a href="#cb10-343" aria-hidden="true" tabindex="-1"></a>                        responsibilities<span class="op">=</span>data[<span class="st">'responsibilities'</span>],</span>
<span id="cb10-344"><a href="#cb10-344" aria-hidden="true" tabindex="-1"></a>                        skills<span class="op">=</span>data[<span class="st">'skills'</span>]</span>
<span id="cb10-345"><a href="#cb10-345" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb10-346"><a href="#cb10-346" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb10-347"><a href="#cb10-347" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Invalid JSON in </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-348"><a href="#cb10-348" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb10-349"><a href="#cb10-349" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-350"><a href="#cb10-350" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_classified_files(<span class="va">self</span>) <span class="op">-&gt;</span> Set[<span class="bu">str</span>]:</span>
<span id="cb10-351"><a href="#cb10-351" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get set of files that have been previously classified as GenAI-related."""</span></span>
<span id="cb10-352"><a href="#cb10-352" aria-hidden="true" tabindex="-1"></a>        genai_dir <span class="op">=</span> <span class="st">'role_genai_classifications'</span></span>
<span id="cb10-353"><a href="#cb10-353" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(genai_dir):</span>
<span id="cb10-354"><a href="#cb10-354" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">set</span>()</span>
<span id="cb10-355"><a href="#cb10-355" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-356"><a href="#cb10-356" aria-hidden="true" tabindex="-1"></a>        genai_files <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb10-357"><a href="#cb10-357" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> f <span class="kw">in</span> os.listdir(genai_dir):</span>
<span id="cb10-358"><a href="#cb10-358" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> f.endswith(<span class="st">'.json'</span>):</span>
<span id="cb10-359"><a href="#cb10-359" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb10-360"><a href="#cb10-360" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(os.path.join(genai_dir, f), <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb10-361"><a href="#cb10-361" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> json.load(<span class="bu">file</span>)</span>
<span id="cb10-362"><a href="#cb10-362" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> data.get(<span class="st">'is_genai_role'</span>) <span class="kw">is</span> <span class="va">True</span>:  <span class="co"># Explicitly check for True</span></span>
<span id="cb10-363"><a href="#cb10-363" aria-hidden="true" tabindex="-1"></a>                            genai_files.add(f[:<span class="op">-</span><span class="dv">5</span>])</span>
<span id="cb10-364"><a href="#cb10-364" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-365"><a href="#cb10-365" aria-hidden="true" tabindex="-1"></a>                    logging.error(<span class="ss">f"Error reading </span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-366"><a href="#cb10-366" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> genai_files</span>
<span id="cb10-367"><a href="#cb10-367" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-368"><a href="#cb10-368" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> process_jobs(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb10-369"><a href="#cb10-369" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process all jobs."""</span></span>
<span id="cb10-370"><a href="#cb10-370" aria-hidden="true" tabindex="-1"></a>        jobs <span class="op">=</span> <span class="va">self</span>.load_jobs()</span>
<span id="cb10-371"><a href="#cb10-371" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> jobs:</span>
<span id="cb10-372"><a href="#cb10-372" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb10-373"><a href="#cb10-373" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-374"><a href="#cb10-374" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Processing </span><span class="sc">{</span><span class="bu">len</span>(jobs)<span class="sc">}</span><span class="ss"> relevant jobs"</span>)</span>
<span id="cb10-375"><a href="#cb10-375" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="va">self</span>._process_jobs_batch(jobs)</span>
<span id="cb10-376"><a href="#cb10-376" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="st">"Job classification complete"</span>)</span>
<span id="cb10-377"><a href="#cb10-377" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-378"><a href="#cb10-378" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> _process_jobs_batch(<span class="va">self</span>, jobs: List[JobData]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb10-379"><a href="#cb10-379" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process a batch of jobs concurrently."""</span></span>
<span id="cb10-380"><a href="#cb10-380" aria-hidden="true" tabindex="-1"></a>        <span class="cf">async</span> <span class="kw">def</span> process_with_semaphore(job: JobData) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb10-381"><a href="#cb10-381" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="cf">with</span> <span class="va">self</span>.classifier.semaphore:</span>
<span id="cb10-382"><a href="#cb10-382" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> <span class="cf">await</span> <span class="va">self</span>.classifier.classify_job(job)</span>
<span id="cb10-383"><a href="#cb10-383" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._save_result(result)</span>
<span id="cb10-384"><a href="#cb10-384" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-385"><a href="#cb10-385" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.gather(<span class="op">*</span>[process_with_semaphore(job) <span class="cf">for</span> job <span class="kw">in</span> jobs])</span>
<span id="cb10-386"><a href="#cb10-386" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-387"><a href="#cb10-387" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _save_result(<span class="va">self</span>, result: ClassificationResult) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb10-388"><a href="#cb10-388" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Save classification result to file."""</span></span>
<span id="cb10-389"><a href="#cb10-389" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> os.path.join(<span class="va">self</span>.classifier.output_dir, <span class="ss">f"</span><span class="sc">{</span>result<span class="sc">.</span>filename<span class="sc">}</span><span class="ss">.json"</span>)</span>
<span id="cb10-390"><a href="#cb10-390" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb10-391"><a href="#cb10-391" aria-hidden="true" tabindex="-1"></a>            json.dump(<span class="bu">vars</span>(result), f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb10-392"><a href="#cb10-392" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Saved classification for job </span><span class="sc">{</span>result<span class="sc">.</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-393"><a href="#cb10-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-394"><a href="#cb10-394" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classify_job_roles(df: pd.DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb10-395"><a href="#cb10-395" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Main entry point for job classification."""</span></span>
<span id="cb10-396"><a href="#cb10-396" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df.empty:</span>
<span id="cb10-397"><a href="#cb10-397" aria-hidden="true" tabindex="-1"></a>        logging.warning(<span class="st">"Empty DataFrame provided"</span>)</span>
<span id="cb10-398"><a href="#cb10-398" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb10-399"><a href="#cb10-399" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-400"><a href="#cb10-400" aria-hidden="true" tabindex="-1"></a>    processor <span class="op">=</span> JobProcessor()</span>
<span id="cb10-401"><a href="#cb10-401" aria-hidden="true" tabindex="-1"></a>    loop <span class="op">=</span> asyncio.get_event_loop()</span>
<span id="cb10-402"><a href="#cb10-402" aria-hidden="true" tabindex="-1"></a>    loop.run_until_complete(processor.process_jobs())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="9738bf89" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> JobDataLoader()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>jobs <span class="op">=</span> loader.read_json_files()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(jobs)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>classify_job_roles(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-01-24 13:26:45,800 - INFO - Found 739 total files
2025-01-24 13:26:45,800 - INFO - Found 247 relevant GenAI files
2025-01-24 13:26:45,800 - INFO - Already processed: 247 files
2025-01-24 13:26:45,801 - INFO - Remaining to process: 0 files
2025-01-24 13:26:45,802 - INFO - Processing 0 remaining jobs</code></pre>
</div>
</div>
</section>
</section>
<section id="load-final-data" class="level1">
<h1>Load final data</h1>
<p>Now I’ll load and combine all of the different data outputs into a single dataframe.</p>
<p>The code block below uses a DataLoader class with helper classes DataPaths and SalaryProcessor to handle the data processing pipeline. The code merges job posting data with role classifications, processes salary information by converting CAD to USD and extracting salary ranges, and filters the results to only include the four specific AI-related roles of interest: AI Research Scientist, AI Solution Architect, AI/ML Engineer, and MLOps/AI Infrastructure Engineer. The code includes error handling for JSON file loading and salary processing. The final output is a pandas DataFrame containing the merged and processed data, which includes job details, role classifications, and standardized salary information.</p>
<div id="43dc2f69" class="cell" data-code-fold-show="false" data-execution_count="10">
<details class="code-fold">
<summary>Click to view the code for loading and merging all data sources</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Tuple, Optional, Dict</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataPaths:</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Configuration for data file paths"""</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    ROLE_CLASSIFICATIONS_DIR: Path <span class="op">=</span> Path(<span class="st">'role_classifications'</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    JSON_DATA_DIR: Path <span class="op">=</span> Path(<span class="st">'json_data'</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataLoader:</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, paths: DataPaths <span class="op">=</span> DataPaths()):</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.paths <span class="op">=</span> paths</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.salary_processor <span class="op">=</span> SalaryProcessor()</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_and_merge_data(<span class="va">self</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load and merge all data sources"""</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load and merge base data</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        merged_df <span class="op">=</span> <span class="va">self</span>._load_base_data()</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process salaries</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        salary_data <span class="op">=</span> <span class="va">self</span>.salary_processor.extract_salary_ranges(merged_df[<span class="st">'salary'</span>])</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        merged_df <span class="op">=</span> pd.concat([merged_df, salary_data], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter out any jobs not in this list</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>        merged_df <span class="op">=</span> merged_df[merged_df[<span class="st">'role_title'</span>].isin(</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>            [<span class="st">'AI Research Scientist'</span>,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">'AI Solution Architect'</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'AI/ML Engineer'</span>,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MLOps / AI Infrastructure Engineer'</span>]</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        )]</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Shape of merged DataFrame: </span><span class="sc">{</span>merged_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> merged_df</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_base_data(<span class="va">self</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load and merge base data sources"""</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load role classifications</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        role_data <span class="op">=</span> pd.DataFrame(<span class="va">self</span>._load_json_files(<span class="va">self</span>.paths.ROLE_CLASSIFICATIONS_DIR))</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load and process jobs data</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        jobs_data <span class="op">=</span> pd.DataFrame(<span class="va">self</span>._load_json_files(<span class="va">self</span>.paths.JSON_DATA_DIR))</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>        jobs_data[<span class="st">'filename'</span>] <span class="op">=</span> jobs_data[<span class="st">'url'</span>].<span class="bu">apply</span>(</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lambda</span> x: <span class="ss">f"j</span><span class="sc">{</span>hashlib<span class="sc">.</span>md5(x.encode())<span class="sc">.</span>hexdigest()[:<span class="dv">5</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Merge dataframes</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        merged_df <span class="op">=</span> pd.merge(jobs_data, role_data, on<span class="op">=</span><span class="st">'filename'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> merged_df</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_json_files(<span class="va">self</span>, directory: Path) <span class="op">-&gt;</span> List[Dict]:</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load JSON files from directory"""</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>        json_files <span class="op">=</span> []</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> file_path <span class="kw">in</span> directory.glob(<span class="st">'*.json'</span>):</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>                    json_files.append(json.load(f))</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Error reading </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> json_files</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SalaryProcessor:</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles salary-related processing"""</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    CAD_TO_USD_RATE <span class="op">=</span> <span class="fl">1.44</span>  <span class="co"># 1 USD = 1.44 CAD</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_salary_ranges(<span class="va">self</span>, salary_series: pd.Series) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract salary ranges from a series of salary strings"""</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>        salary_data <span class="op">=</span> salary_series.<span class="bu">apply</span>(<span class="va">self</span>._extract_salary_range)</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame({</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">'min_salary'</span>: salary_data.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">0</span>]),</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>            <span class="st">'max_salary'</span>: salary_data.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">1</span>]),</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>            <span class="st">'mid_salary'</span>: salary_data.<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x[<span class="dv">0</span>] <span class="op">+</span> x[<span class="dv">1</span>])<span class="op">/</span><span class="dv">2</span> <span class="cf">if</span> x[<span class="dv">0</span>] <span class="kw">and</span> x[<span class="dv">1</span>] <span class="cf">else</span> <span class="va">None</span>)</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _extract_salary_range(<span class="va">self</span>, salary_str: <span class="bu">str</span>) <span class="op">-&gt;</span> Tuple[Optional[<span class="bu">float</span>], Optional[<span class="bu">float</span>]]:</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract minimum and maximum salary from salary string"""</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(salary_str, <span class="bu">str</span>) <span class="kw">or</span> <span class="st">'0+'</span> <span class="kw">in</span> salary_str:</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Determine currency and convert if needed</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>            is_cad <span class="op">=</span> <span class="st">'CAD'</span> <span class="kw">in</span> salary_str</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>            nums <span class="op">=</span> (salary_str.replace(<span class="st">'CAD '</span>, <span class="st">''</span>)</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>                            .replace(<span class="st">'USD '</span>, <span class="st">''</span>)</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>                            .replace(<span class="st">'K'</span>, <span class="st">''</span>)</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>                            .split(<span class="st">' - '</span>))</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(nums) <span class="op">!=</span> <span class="dv">2</span>:</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Convert to float and apply CAD conversion if needed</span></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>            min_salary <span class="op">=</span> <span class="bu">float</span>(nums[<span class="dv">0</span>])</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>            max_salary <span class="op">=</span> <span class="bu">float</span>(nums[<span class="dv">1</span>])</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_cad:</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>                min_salary <span class="op">*=</span> <span class="va">self</span>.CAD_TO_USD_RATE</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>                max_salary <span class="op">*=</span> <span class="va">self</span>.CAD_TO_USD_RATE</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> min_salary, max_salary</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="8dda6748" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the loader and load the data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the csv file exists</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'genai_job_data.csv'</span>):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    loader <span class="op">=</span> DataLoader()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> loader.load_and_merge_data()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    df.to_csv(<span class="st">'genai_job_data.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(<span class="st">'genai_job_data.csv'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Now df contains all the merged data with processed salaries</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total jobs loaded: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Example operations you can do with the DataFrame:</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># View available columns</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Available columns:"</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.columns.tolist())</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># View distribution of roles</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Role distribution:"</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'role_title'</span>].value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total jobs loaded: 187

Available columns:
['title', 'company', 'location', 'level', 'salary', 'url', 'description', 'scraped_date', 'posted_date', 'raw_data', 'filename', 'responsibilities', 'skills', 'analysis', 'role_classification', 'role_title', 'min_salary', 'max_salary', 'mid_salary']

Role distribution:
role_title
AI/ML Engineer                        60
AI Research Scientist                 52
AI Solution Architect                 48
MLOps / AI Infrastructure Engineer    27
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="salary-analysis" class="level1">
<h1>Salary analysis</h1>
<p>First I’ll analyze the salary data for each role and experience level. I’ll use a RandomForest model to adjust for location differences, and convert any CAD denominated salaries to USD. I’m interested to see what compensation is like for each role, and if there are any significant differences in compensation between the roles.</p>
<p>The code below implements a salary analysis system for the job posting data. It processes salary information across different roles and experience levels, handling currency conversions (CAD to USD) and adjusting for location differences using a RandomForest model. For each role and level combination, it calculates salary ranges, removes statistical outliers, and provides sample sizes. The system includes configuration settings for analysis parameters and comprehensive error handling. The code uses pandas for data manipulation and scikit-learn for the location adjustment model, with results formatted as salary ranges in USD.</p>
<div id="dbc6ca70" class="cell" data-code-fold-show="false" data-execution_count="12">
<details class="code-fold">
<summary>Click to view the code for salary analysis</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Optional, TypedDict, Set</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SalaryConfig:</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Configuration settings for salary analysis"""</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    outlier_threshold: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    n_estimators: <span class="bu">int</span> <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    min_group_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    currency_symbol: <span class="bu">str</span> <span class="op">=</span> <span class="st">'$'</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    cv_folds: <span class="bu">int</span> <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SalaryColumns(TypedDict):</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Type definitions for salary DataFrame columns"""</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    min_salary_usd_k: <span class="bu">float</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    max_salary_usd_k: <span class="bu">float</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    median_salary_usd_k: <span class="bu">float</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    sample_size: <span class="bu">int</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    location_adjusted_zscore: <span class="bu">float</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SalaryAnalyzer:</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Analyzes salary distributions across role titles.</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co">    Column Naming Conventions:</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co">    - *_usd_k: Values in thousands of USD</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co">    - *_zscore: Standardized scores (mean=0, std=1)</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co">    - sample_size: Number of data points in group</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co">    - *_median: Median values</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co">    - location_adjusted_*: Values adjusted for location differences</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes:</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="co">        config: Configuration settings for analysis</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="co">        logger: Logger instance for the class</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input column names</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    COL_MIN_SALARY <span class="op">=</span> <span class="st">'min_salary'</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    COL_MAX_SALARY <span class="op">=</span> <span class="st">'max_salary'</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    COL_ROLE_TITLE <span class="op">=</span> <span class="st">'role_title'</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    COL_LEVEL <span class="op">=</span> <span class="st">'level'</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    COL_LOCATION <span class="op">=</span> <span class="st">'location'</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Processed column names</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    COL_MEDIAN_SALARY <span class="op">=</span> <span class="st">'median_salary_usd_k'</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    COL_MIN_SALARY_MEDIAN <span class="op">=</span> <span class="st">'min_salary_median_usd_k'</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    COL_MAX_SALARY_MEDIAN <span class="op">=</span> <span class="st">'max_salary_median_usd_k'</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>    COL_SAMPLE_SIZE <span class="op">=</span> <span class="st">'sample_size'</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z-score columns</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    COL_MIN_ZSCORE <span class="op">=</span> <span class="st">'min_salary_location_adjusted_zscore'</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    COL_MID_ZSCORE <span class="op">=</span> <span class="st">'median_salary_location_adjusted_zscore'</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>    COL_MAX_ZSCORE <span class="op">=</span> <span class="st">'max_salary_location_adjusted_zscore'</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, config: Optional[SalaryConfig] <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Initialize SalaryAnalyzer with optional configuration."""</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.config <span class="op">=</span> config <span class="kw">or</span> SalaryConfig()</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> <span class="va">None</span>  <span class="co"># Cache for trained model</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> analyze_role_salaries(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="co">        Analyze salary distributions across role titles with location adjustment.</span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a><span class="co">            df: DataFrame containing columns:</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a><span class="co">                - min_salary: Minimum salary (float)</span></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a><span class="co">                - max_salary: Maximum salary (float)</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a><span class="co">                - role_title: Job role (str)</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a><span class="co">                - level: Experience level (str)</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a><span class="co">                - location: Job location (str)</span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a><span class="co">                </span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a><span class="co">            DataFrame with aggregated salary statistics by role and level</span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a><span class="co">        Raises:</span></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a><span class="co">            ValueError: If required columns are missing or DataFrame is empty</span></span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._validate_input(df)</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f"Starting salary analysis with </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss"> records"</span>)</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create working copy of DataFrame</span></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>        analysis_df <span class="op">=</span> <span class="va">self</span>._prepare_data(df)</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process and clean data</span></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>        analysis_df <span class="op">=</span> <span class="va">self</span>._process_data(analysis_df)</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate final results</span></span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> <span class="va">self</span>._aggregate_results(analysis_df)</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">"Salary analysis completed successfully"</span>)</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _validate_input(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Validate input DataFrame."""</span></span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> df.empty:</span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Input DataFrame cannot be None or empty"</span>)</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>        required_cols <span class="op">=</span> {</span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MIN_SALARY, </span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MAX_SALARY, </span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_ROLE_TITLE,</span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_LEVEL,</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_LOCATION</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>        missing_cols <span class="op">=</span> required_cols <span class="op">-</span> <span class="bu">set</span>(df.columns)</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> missing_cols:</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"DataFrame missing required columns: </span><span class="sc">{</span>missing_cols<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _prepare_data(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Prepare data for analysis by filtering valid salaries."""</span></span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>        valid_salary_mask <span class="op">=</span> (</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>            df[<span class="va">self</span>.COL_MIN_SALARY].notna() <span class="op">&amp;</span> </span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>            df[<span class="va">self</span>.COL_MAX_SALARY].notna()</span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> valid_salary_mask.<span class="bu">any</span>():</span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">"No valid salary data found"</span>)</span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> pd.DataFrame()</span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create working copy and calculate median salary</span></span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>        analysis_df <span class="op">=</span> df[valid_salary_mask].copy()</span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>        analysis_df[<span class="va">self</span>.COL_MEDIAN_SALARY] <span class="op">=</span> (</span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>            analysis_df[[<span class="va">self</span>.COL_MIN_SALARY, <span class="va">self</span>.COL_MAX_SALARY]].mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> analysis_df</span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _remove_outliers(<span class="va">self</span>, group: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Remove statistical outliers from salary data."""</span></span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(group) <span class="op">&lt;=</span> <span class="va">self</span>.config.min_group_size:</span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> group</span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Only check min and max salary for outliers</span></span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>        salary_cols <span class="op">=</span> [<span class="va">self</span>.COL_MIN_SALARY, <span class="va">self</span>.COL_MAX_SALARY]</span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> salary_cols:</span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>            Q1 <span class="op">=</span> group[col].quantile(<span class="fl">0.25</span>)</span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>            Q3 <span class="op">=</span> group[col].quantile(<span class="fl">0.75</span>)</span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>            IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>            outlier_mask <span class="op">=</span> <span class="op">~</span>(</span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>                (group[col] <span class="op">&lt;</span> (Q1 <span class="op">-</span> <span class="va">self</span>.config.outlier_threshold <span class="op">*</span> IQR)) <span class="op">|</span> </span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>                (group[col] <span class="op">&gt;</span> (Q3 <span class="op">+</span> <span class="va">self</span>.config.outlier_threshold <span class="op">*</span> IQR))</span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>            group <span class="op">=</span> group[outlier_mask]</span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Recalculate median after removing outliers</span></span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>        group[<span class="va">self</span>.COL_MEDIAN_SALARY] <span class="op">=</span> (</span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>            group[<span class="va">self</span>.COL_MIN_SALARY] <span class="op">+</span> group[<span class="va">self</span>.COL_MAX_SALARY]</span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> group</span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _aggregate_results(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Aggregate and format the final results."""</span></span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>        <span class="co"># First calculate group statistics</span></span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a>        grouped <span class="op">=</span> df.groupby([<span class="va">self</span>.COL_ROLE_TITLE, <span class="va">self</span>.COL_LEVEL]).agg({</span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MIN_SALARY: [<span class="st">'count'</span>, <span class="st">'median'</span>],</span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MAX_SALARY: <span class="st">'median'</span>,</span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a>        }).<span class="bu">round</span>(<span class="dv">0</span>)</span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate median salary from min and max medians</span></span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a>        grouped[<span class="st">'median_salary'</span>] <span class="op">=</span> (</span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>            grouped[(<span class="va">self</span>.COL_MIN_SALARY, <span class="st">'median'</span>)] <span class="op">+</span> </span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>            grouped[(<span class="va">self</span>.COL_MAX_SALARY, <span class="st">'median'</span>)]</span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Flatten and rename columns</span></span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a>        grouped.columns <span class="op">=</span> [</span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a>            <span class="st">'sample_size'</span> <span class="cf">if</span> col <span class="op">==</span> (<span class="va">self</span>.COL_MIN_SALARY, <span class="st">'count'</span>)</span>
<span id="cb16-176"><a href="#cb16-176" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="st">'min_salary_usd_k'</span> <span class="cf">if</span> col <span class="op">==</span> (<span class="va">self</span>.COL_MIN_SALARY, <span class="st">'median'</span>)</span>
<span id="cb16-177"><a href="#cb16-177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="st">'max_salary_usd_k'</span> <span class="cf">if</span> col <span class="op">==</span> (<span class="va">self</span>.COL_MAX_SALARY, <span class="st">'median'</span>)</span>
<span id="cb16-178"><a href="#cb16-178" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="st">'median_salary_usd_k'</span> <span class="cf">if</span> col[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'median_salary'</span></span>
<span id="cb16-179"><a href="#cb16-179" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> col</span>
<span id="cb16-180"><a href="#cb16-180" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> col <span class="kw">in</span> grouped.columns</span>
<span id="cb16-181"><a href="#cb16-181" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb16-182"><a href="#cb16-182" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-183"><a href="#cb16-183" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Order columns</span></span>
<span id="cb16-184"><a href="#cb16-184" aria-hidden="true" tabindex="-1"></a>        ordered_cols <span class="op">=</span> [</span>
<span id="cb16-185"><a href="#cb16-185" aria-hidden="true" tabindex="-1"></a>            <span class="st">'sample_size'</span>,</span>
<span id="cb16-186"><a href="#cb16-186" aria-hidden="true" tabindex="-1"></a>            <span class="st">'min_salary_usd_k'</span>,</span>
<span id="cb16-187"><a href="#cb16-187" aria-hidden="true" tabindex="-1"></a>            <span class="st">'max_salary_usd_k'</span>,</span>
<span id="cb16-188"><a href="#cb16-188" aria-hidden="true" tabindex="-1"></a>            <span class="st">'median_salary_usd_k'</span></span>
<span id="cb16-189"><a href="#cb16-189" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb16-190"><a href="#cb16-190" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> grouped.reindex(columns<span class="op">=</span>ordered_cols)</span>
<span id="cb16-191"><a href="#cb16-191" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-192"><a href="#cb16-192" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Format salary values</span></span>
<span id="cb16-193"><a href="#cb16-193" aria-hidden="true" tabindex="-1"></a>        salary_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> ordered_cols <span class="cf">if</span> col.endswith(<span class="st">'_usd_k'</span>)]</span>
<span id="cb16-194"><a href="#cb16-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> salary_cols:</span>
<span id="cb16-195"><a href="#cb16-195" aria-hidden="true" tabindex="-1"></a>            result[col] <span class="op">=</span> result[col].<span class="bu">apply</span>(</span>
<span id="cb16-196"><a href="#cb16-196" aria-hidden="true" tabindex="-1"></a>                <span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config<span class="sc">.</span>currency_symbol<span class="sc">}{</span>x<span class="sc">:,.0f}</span><span class="ss">K"</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">"N/A"</span></span>
<span id="cb16-197"><a href="#cb16-197" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb16-198"><a href="#cb16-198" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-199"><a href="#cb16-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb16-200"><a href="#cb16-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-201"><a href="#cb16-201" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-202"><a href="#cb16-202" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _process_data(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb16-203"><a href="#cb16-203" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process and clean the salary data."""</span></span>
<span id="cb16-204"><a href="#cb16-204" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove outliers by group</span></span>
<span id="cb16-205"><a href="#cb16-205" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> (df.groupby([<span class="va">self</span>.COL_ROLE_TITLE, <span class="va">self</span>.COL_LEVEL])</span>
<span id="cb16-206"><a href="#cb16-206" aria-hidden="true" tabindex="-1"></a>              .<span class="bu">apply</span>(<span class="va">self</span>._remove_outliers)</span>
<span id="cb16-207"><a href="#cb16-207" aria-hidden="true" tabindex="-1"></a>              .reset_index(drop<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb16-208"><a href="#cb16-208" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-209"><a href="#cb16-209" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add location-adjusted scores</span></span>
<span id="cb16-210"><a href="#cb16-210" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="va">self</span>._add_location_adjusted_scores(df)</span>
<span id="cb16-211"><a href="#cb16-211" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-212"><a href="#cb16-212" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean level names</span></span>
<span id="cb16-213"><a href="#cb16-213" aria-hidden="true" tabindex="-1"></a>        df[<span class="va">self</span>.COL_LEVEL] <span class="op">=</span> (df[<span class="va">self</span>.COL_LEVEL]</span>
<span id="cb16-214"><a href="#cb16-214" aria-hidden="true" tabindex="-1"></a>                             .<span class="bu">str</span>.replace(<span class="st">'-Level / Level'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-215"><a href="#cb16-215" aria-hidden="true" tabindex="-1"></a>                             .<span class="bu">str</span>.replace(<span class="st">'-level'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb16-216"><a href="#cb16-216" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-217"><a href="#cb16-217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb16-218"><a href="#cb16-218" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-219"><a href="#cb16-219" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _train_model(<span class="va">self</span>) <span class="op">-&gt;</span> RandomForestRegressor:</span>
<span id="cb16-220"><a href="#cb16-220" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Train and cache RandomForest model."""</span></span>
<span id="cb16-221"><a href="#cb16-221" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-222"><a href="#cb16-222" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model <span class="op">=</span> RandomForestRegressor(</span>
<span id="cb16-223"><a href="#cb16-223" aria-hidden="true" tabindex="-1"></a>                n_estimators<span class="op">=</span><span class="va">self</span>.config.n_estimators,</span>
<span id="cb16-224"><a href="#cb16-224" aria-hidden="true" tabindex="-1"></a>                random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb16-225"><a href="#cb16-225" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb16-226"><a href="#cb16-226" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._model</span>
<span id="cb16-227"><a href="#cb16-227" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-228"><a href="#cb16-228" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _add_location_adjusted_scores(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb16-229"><a href="#cb16-229" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Add location-adjusted z-scores to the dataframe."""</span></span>
<span id="cb16-230"><a href="#cb16-230" aria-hidden="true" tabindex="-1"></a>        location_dummies <span class="op">=</span> pd.get_dummies(df[<span class="va">self</span>.COL_LOCATION], prefix<span class="op">=</span><span class="st">'loc'</span>)</span>
<span id="cb16-231"><a href="#cb16-231" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> <span class="va">self</span>._train_model()</span>
<span id="cb16-232"><a href="#cb16-232" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-233"><a href="#cb16-233" aria-hidden="true" tabindex="-1"></a>        score_columns <span class="op">=</span> {</span>
<span id="cb16-234"><a href="#cb16-234" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MIN_SALARY: <span class="va">self</span>.COL_MIN_ZSCORE,</span>
<span id="cb16-235"><a href="#cb16-235" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MEDIAN_SALARY: <span class="va">self</span>.COL_MID_ZSCORE,</span>
<span id="cb16-236"><a href="#cb16-236" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MAX_SALARY: <span class="va">self</span>.COL_MAX_ZSCORE</span>
<span id="cb16-237"><a href="#cb16-237" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-238"><a href="#cb16-238" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-239"><a href="#cb16-239" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_col, target_col <span class="kw">in</span> score_columns.items():</span>
<span id="cb16-240"><a href="#cb16-240" aria-hidden="true" tabindex="-1"></a>            df[target_col] <span class="op">=</span> <span class="va">self</span>._adjust_salaries(</span>
<span id="cb16-241"><a href="#cb16-241" aria-hidden="true" tabindex="-1"></a>                df[source_col], </span>
<span id="cb16-242"><a href="#cb16-242" aria-hidden="true" tabindex="-1"></a>                location_dummies,</span>
<span id="cb16-243"><a href="#cb16-243" aria-hidden="true" tabindex="-1"></a>                model</span>
<span id="cb16-244"><a href="#cb16-244" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb16-245"><a href="#cb16-245" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-246"><a href="#cb16-246" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb16-247"><a href="#cb16-247" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-248"><a href="#cb16-248" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _adjust_salaries(<span class="va">self</span>, </span>
<span id="cb16-249"><a href="#cb16-249" aria-hidden="true" tabindex="-1"></a>                        salary_series: pd.Series,</span>
<span id="cb16-250"><a href="#cb16-250" aria-hidden="true" tabindex="-1"></a>                        X: pd.DataFrame,</span>
<span id="cb16-251"><a href="#cb16-251" aria-hidden="true" tabindex="-1"></a>                        model: RandomForestRegressor) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb16-252"><a href="#cb16-252" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Adjust salaries using RandomForest model."""</span></span>
<span id="cb16-253"><a href="#cb16-253" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Evaluate model performance</span></span>
<span id="cb16-254"><a href="#cb16-254" aria-hidden="true" tabindex="-1"></a>        scores <span class="op">=</span> cross_val_score(</span>
<span id="cb16-255"><a href="#cb16-255" aria-hidden="true" tabindex="-1"></a>            model, X, salary_series, </span>
<span id="cb16-256"><a href="#cb16-256" aria-hidden="true" tabindex="-1"></a>            cv<span class="op">=</span><span class="va">self</span>.config.cv_folds</span>
<span id="cb16-257"><a href="#cb16-257" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-258"><a href="#cb16-258" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.debug(<span class="ss">f"Cross-validation scores: </span><span class="sc">{</span>scores<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss"> ± </span><span class="sc">{</span>scores<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb16-259"><a href="#cb16-259" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-260"><a href="#cb16-260" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fit model and calculate residuals</span></span>
<span id="cb16-261"><a href="#cb16-261" aria-hidden="true" tabindex="-1"></a>        model.fit(X, salary_series)</span>
<span id="cb16-262"><a href="#cb16-262" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> model.predict(X)</span>
<span id="cb16-263"><a href="#cb16-263" aria-hidden="true" tabindex="-1"></a>        residuals <span class="op">=</span> salary_series <span class="op">-</span> expected</span>
<span id="cb16-264"><a href="#cb16-264" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-265"><a href="#cb16-265" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return standardized residuals</span></span>
<span id="cb16-266"><a href="#cb16-266" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (residuals <span class="op">-</span> residuals.mean()) <span class="op">/</span> residuals.std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="91ab689a" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>salary_analyzer <span class="op">=</span> SalaryAnalyzer()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>salary_df <span class="op">=</span> salary_analyzer.analyze_role_salaries(df)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>salary_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2025-01-24 13:26:46,128 - INFO - Starting salary analysis with 187 records
2025-01-24 13:26:48,622 - INFO - Salary analysis completed successfully</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sample_size</th>
<th data-quarto-table-cell-role="th">min_salary_usd_k</th>
<th data-quarto-table-cell-role="th">max_salary_usd_k</th>
<th data-quarto-table-cell-role="th">median_salary_usd_k</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">role_title</th>
<th data-quarto-table-cell-role="th">level</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">AI Research Scientist</td>
<td data-quarto-table-cell-role="th">Entry</td>
<td>3</td>
<td>$140K</td>
<td>$170K</td>
<td>$155K</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Mid</td>
<td>8</td>
<td>$122K</td>
<td>$209K</td>
<td>$166K</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Senior</td>
<td>24</td>
<td>$159K</td>
<td>$251K</td>
<td>$205K</td>
</tr>
<tr class="even">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">AI Solution Architect</td>
<td data-quarto-table-cell-role="th">Entry</td>
<td>2</td>
<td>$133K</td>
<td>$266K</td>
<td>$200K</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Mid</td>
<td>7</td>
<td>$120K</td>
<td>$206K</td>
<td>$163K</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Senior</td>
<td>33</td>
<td>$146K</td>
<td>$247K</td>
<td>$196K</td>
</tr>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">AI/ML Engineer</td>
<td data-quarto-table-cell-role="th">Entry</td>
<td>1</td>
<td>$135K</td>
<td>$251K</td>
<td>$193K</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Mid</td>
<td>11</td>
<td>$129K</td>
<td>$224K</td>
<td>$176K</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Senior</td>
<td>28</td>
<td>$158K</td>
<td>$268K</td>
<td>$213K</td>
</tr>
<tr class="even">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">MLOps / AI Infrastructure Engineer</td>
<td data-quarto-table-cell-role="th">Entry</td>
<td>2</td>
<td>$152K</td>
<td>$260K</td>
<td>$206K</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Mid</td>
<td>5</td>
<td>$143K</td>
<td>$214K</td>
<td>$178K</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Senior</td>
<td>16</td>
<td>$164K</td>
<td>$258K</td>
<td>$211K</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Looking across all the four GenAI roles (AI Research, Solutions Architecture, ML Engineering, and MLOps), compensation bands are similar. At senior levels (where I have the largest samples), median salaries cluster tightly between ~$195K-$210K USD. Mid-level positions show medians between ~$165K-$180K USD, and entry-level positions generally start between ~$155K-$205K USD, although this entry-level data is limited by small samples.</p>
<p>This consistency suggests these roles are valued similarly in the market, despite their different focuses.</p>
</section>
<section id="job-responsibilities" class="level1">
<h1>Job responsibilities</h1>
<p>Next, I’m interested to see what the job responsibilities are for some of these roles, and how they differ. I’ll use an LLM to identify the most common responsibilities and skills for a given role. This task will be quite complex, involving a lot of input data. So a model like <code>o1</code> will be more appropriate. I don’t have access to <code>o1</code> via API, so I’ll use the web interface to generate completions, and prepare XML files for the inputs to this task – allowing me to copy-paste the XML into the chat.</p>
<p>As we’ll see, Research Scientists lean heavily into discovery, theoretical advances, publication, and cutting-edge experimentation, whereas ML Engineers center on production-grade systems, robust architecture, MLOps, and aligning with business needs. Although in many cases, the lines between these roles will be blurred.</p>
<div id="446b831f" class="cell" data-code-fold-show="false" data-execution_count="14">
<details class="code-fold">
<summary>Click to view the code for XML generation</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>INSTRUCTION_PREFIX <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="st">Identify the most common Responsibilities and Skills listed in the jobs below, returning a bulleted list in the format</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="st"># Responsibilities</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="st">- [responsibility]: [responsibility description]</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="st">- [responsibility]: [responsibility description]</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="st">...</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="st"># Skills</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="st">- [skill]: [skill description]</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="st">- [skill]: [skill description]</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="st">...</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> XMLGenerator:</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles generation of XML files from job data"""</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'xml_roles'</span>):</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir <span class="op">=</span> output_dir</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>            level<span class="op">=</span>logging.INFO,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> compile_xml_for_role(<span class="va">self</span>, level: <span class="bu">str</span>, role_title: <span class="bu">str</span>, df: pd.DataFrame) <span class="op">-&gt;</span> Dict:</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate XML-formatted string of job details for the given level and role title."""</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter DataFrame for matching level and role</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        filtered_df <span class="op">=</span> df[</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>            (df[<span class="st">'level'</span>] <span class="op">==</span> level) <span class="op">&amp;</span> </span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>            (df[<span class="st">'role_title'</span>] <span class="op">==</span> role_title)</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(filtered_df) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>                <span class="st">'level'</span>: level,</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>                <span class="st">'role_title'</span>: role_title,</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>                <span class="st">'xml_output'</span>: <span class="st">''</span>,</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>                <span class="st">'error'</span>: <span class="ss">f"No jobs found for </span><span class="sc">{</span>level<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>role_title<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Build XML string</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>        xml_output <span class="op">=</span> <span class="st">""</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, job <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>            xml_output <span class="op">+=</span> <span class="st">"&lt;Job&gt;</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>            xml_output <span class="op">+=</span> <span class="ss">f"&lt;Responsibilities&gt;</span><span class="sc">{</span>job[<span class="st">'responsibilities'</span>]<span class="sc">}</span><span class="ss">&lt;/Responsibilities&gt;</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>            xml_output <span class="op">+=</span> <span class="ss">f"&lt;Skills&gt;</span><span class="sc">{</span>job[<span class="st">'skills'</span>]<span class="sc">}</span><span class="ss">&lt;/Skills&gt;</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>            xml_output <span class="op">+=</span> <span class="st">"&lt;/Job&gt;</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>            <span class="st">'level'</span>: level,</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>            <span class="st">'role_title'</span>: role_title,</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">'xml_output'</span>: INSTRUCTION_PREFIX <span class="op">+</span> xml_output</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_xml(<span class="va">self</span>, level: <span class="bu">str</span>, role_title: <span class="bu">str</span>, xml_data: Dict) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Save XML data to a file"""</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> xml_data[<span class="st">'xml_output'</span>]:</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>            <span class="co">#logging.warning(xml_data.get('error', 'Empty XML output'))</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean and sanitize the filename components</span></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>        cleaned_level <span class="op">=</span> level.replace(<span class="st">'-Level / Level'</span>, <span class="st">''</span>).strip()</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>        safe_level <span class="op">=</span> cleaned_level.replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>        safe_role <span class="op">=</span> role_title.replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> os.path.join(<span class="va">self</span>.output_dir, <span class="ss">f"</span><span class="sc">{</span>safe_level<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_role<span class="sc">}</span><span class="ss">.xml"</span>)</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>            f.write(xml_data[<span class="st">'xml_output'</span>])</span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>        logging.debug(<span class="ss">f"Saved XML for </span><span class="sc">{</span>cleaned_level<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>role_title<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_all_xml(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate XML files for all role/level combinations"""</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df.empty:</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>            logging.warning(<span class="st">"No jobs found in DataFrame - check if data was loaded correctly"</span>)</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>        required_cols <span class="op">=</span> [<span class="st">'level'</span>, <span class="st">'role_title'</span>, <span class="st">'responsibilities'</span>, <span class="st">'skills'</span>]  <span class="co"># Changed here too</span></span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(col <span class="kw">in</span> df.columns <span class="cf">for</span> col <span class="kw">in</span> required_cols):</span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"DataFrame missing required columns: </span><span class="sc">{</span>required_cols<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process each unique role/level combination</span></span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>        role_combinations <span class="op">=</span> df[[<span class="st">'level'</span>, <span class="st">'role_title'</span>]].drop_duplicates()</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, combo <span class="kw">in</span> role_combinations.iterrows():</span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>            xml_data <span class="op">=</span> <span class="va">self</span>.compile_xml_for_role(</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>                combo[<span class="st">'level'</span>], </span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>                combo[<span class="st">'role_title'</span>], </span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>                df</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.save_xml(combo[<span class="st">'level'</span>], combo[<span class="st">'role_title'</span>], xml_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="e86f399c" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>xml_generator <span class="op">=</span> XMLGenerator()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>xml_generator.generate_all_xml(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="o1-generated-senior-ai-research-scientist" class="level2">
<h2 class="anchored" data-anchor-id="o1-generated-senior-ai-research-scientist">o1-generated Senior AI Research Scientist</h2>
<p>Here’s what <code>o1</code> said about the Responsibilities and Skills observed in Senior AI Research Scientist roles:</p>
<section id="responsibilities" class="level3">
<h3 class="anchored" data-anchor-id="responsibilities">Responsibilities</h3>
<ul>
<li><p><strong>Conduct advanced AI research</strong><br>
Many roles require pushing the state-of-the-art in Generative AI, LLMs, and related areas (e.g., video/multimodal models, diffusion models) through novel algorithms, architectures, and experimental studies.</p></li>
<li><p><strong>Train and fine-tune large-scale models</strong><br>
Commonly involves working with massive datasets and distributed training setups (thousands of GPUs, HPC environments) to develop foundation models and advanced AI systems.</p></li>
<li><p><strong>Develop and implement new algorithms or architectures</strong><br>
Spans designing novel model architectures (e.g., diffusion, transformer-based, multimodal fusion) and creating robust data processing or simulation pipelines to support AI solutions.</p></li>
<li><p><strong>Collaborate with cross-functional teams</strong><br>
Emphasizes close work with engineering, product management, research, and external stakeholders to integrate AI breakthroughs into real-world applications and products.</p></li>
<li><p><strong>Evaluate and measure AI performance</strong><br>
Entails building rigorous evaluation frameworks, designing new metrics, and systematically analyzing model behavior to ensure quality and reliability.</p></li>
<li><p><strong>Publish and communicate research findings</strong><br>
Many positions highlight writing influential papers, presenting at conferences, and sharing innovative results both internally and with the broader AI community.</p></li>
<li><p><strong>Build and maintain data pipelines</strong><br>
Involves constructing high-quality, scalable data pipelines or tooling to support training, fine-tuning, and inference of large models.</p></li>
<li><p><strong>Ensure production-grade implementation</strong><br>
Requires writing clean, efficient, and maintainable code as well as optimizing models and pipelines to meet performance, reliability, and quality standards.</p></li>
</ul>
</section>
<section id="skills" class="level3">
<h3 class="anchored" data-anchor-id="skills">Skills</h3>
<ul>
<li><p><strong>Proficiency in Python and deep learning frameworks</strong><br>
Strong coding skills in Python and hands-on experience with libraries such as PyTorch, TensorFlow, or JAX appear in nearly every role.</p></li>
<li><p><strong>Expertise with LLMs and Generative AI</strong><br>
Deep understanding of transformer architectures, diffusion models, multimodal systems, prompt engineering, and other advanced AI techniques is frequently mentioned.</p></li>
<li><p><strong>Experience with large-scale/distributed training</strong><br>
Many roles emphasize knowledge of HPC, GPU optimization, model parallelism (e.g., FSDP, DeepSpeed, Megatron-LM), and handling massive datasets.</p></li>
<li><p><strong>Strong software engineering practices</strong><br>
Testing, code review, debugging, version control, and producing clean, modular research or production code are consistently important.</p></li>
<li><p><strong>Collaboration and communication skills</strong><br>
Clear written and verbal communication, along with cross-functional teamwork, is vital for integrating AI solutions into products and relaying complex ideas.</p></li>
<li><p><strong>Research acumen and adaptability</strong><br>
Ability to read, interpret, and prototype cutting-edge AI literature, publish findings, and rapidly iterate on experiments.</p></li>
<li><p><strong>Machine Learning fundamentals</strong><br>
Solid grounding in ML theory (e.g., optimization, statistics, data structures) and experience with model evaluation, data manipulation, and pipeline design.</p></li>
<li><p><strong>Familiarity with prompt engineering and advanced NLP concepts</strong><br>
Many roles highlight crafting effective prompts, aligning model outputs with user needs, and leveraging text-generation or conversational AI techniques.</p></li>
</ul>
</section>
</section>
<section id="o1-generated-senior-ai-ml-engineer" class="level2">
<h2 class="anchored" data-anchor-id="o1-generated-senior-ai-ml-engineer">o1-generated Senior AI ML Engineer</h2>
<p>And here’s what <code>o1</code> said about the Responsibilities and Skills observed in Senior AI ML Engineer roles:</p>
<section id="responsibilities-1" class="level3">
<h3 class="anchored" data-anchor-id="responsibilities-1">Responsibilities</h3>
<ul>
<li><p><strong>Design, develop, and deploy AI/ML solutions</strong><br>
End-to-end creation of machine learning systems, from initial prototypes to production-ready deployments.</p></li>
<li><p><strong>Collaborate with cross-functional teams</strong><br>
Work closely with product managers, data scientists, engineers, and other stakeholders to align technical solutions with business goals.</p></li>
<li><p><strong>Monitor and optimize model performance</strong><br>
Track key metrics, fine-tune models, and iterate to ensure continuous improvement and reliability in production.</p></li>
<li><p><strong>Stay current with AI research and emerging technologies</strong><br>
Keep up-to-date with the latest breakthroughs in areas like LLMs, generative AI, and deep learning.</p></li>
<li><p><strong>Mentor and coach team members</strong><br>
Provide guidance on best practices, design patterns, code quality, and career development for junior or peer engineers.</p></li>
<li><p><strong>Develop scalable data/ML pipelines</strong><br>
Build robust infrastructure for data collection, preprocessing, model training, and deployment at scale.</p></li>
<li><p><strong>Implement and maintain CI/CD and coding best practices</strong><br>
Ensure code quality, streamline release processes, and enforce testing discipline for AI/ML components.</p></li>
<li><p><strong>Integrate and leverage LLMs/generative AI</strong><br>
Incorporate large language models or generative methods into products and workflows.</p></li>
<li><p><strong>Prototype and experiment</strong><br>
Conduct R&amp;D, proof-of-concepts, and pilot programs to explore emerging AI techniques and validate new product ideas.</p></li>
<li><p><strong>Document and communicate findings</strong><br>
Produce clear technical documentation, share results with stakeholders, and provide actionable insights for decision-making.</p></li>
</ul>
</section>
<section id="skills-1" class="level3">
<h3 class="anchored" data-anchor-id="skills-1">Skills</h3>
<ul>
<li><p><strong>Proficiency in Python</strong><br>
Commonly required for AI/ML development, data manipulation, and scripting.</p></li>
<li><p><strong>Experience with ML/DL frameworks</strong><br>
Hands-on expertise in tools like PyTorch, TensorFlow, or JAX for building and training models.</p></li>
<li><p><strong>Familiarity with cloud platforms</strong><br>
Working knowledge of AWS, GCP, or Azure for deploying and scaling AI solutions.</p></li>
<li><p><strong>Expertise in LLMs/generative AI</strong><br>
Understanding of transformer architectures, prompt engineering, retrieval-augmented generation (RAG), and related libraries.</p></li>
<li><p><strong>Strong software engineering fundamentals</strong><br>
Solid grasp of algorithms, data structures, design patterns, and best practices for production code.</p></li>
<li><p><strong>Knowledge of MLOps and CI/CD</strong><br>
Experience with containerization (Docker, Kubernetes), version control (Git), and automated testing/monitoring.</p></li>
<li><p><strong>Data processing and SQL</strong><br>
Skills in handling large datasets, working with Spark or similar frameworks, and writing performant SQL queries.</p></li>
<li><p><strong>Effective communication and collaboration</strong><br>
Ability to translate complex technical concepts for non-technical stakeholders and work well in diverse teams.</p></li>
<li><p><strong>Problem-solving and debugging</strong><br>
Track record of diagnosing issues in production environments and implementing reliable fixes.</p></li>
<li><p><strong>Continuous learning mindset</strong><br>
Eagerness to stay on top of new AI research, frameworks, and technologies to innovate and improve solutions.</p></li>
</ul>
</section>
</section>
</section>
<section id="job-titles" class="level1">
<h1>Job titles</h1>
<p>What are the most common job titles for these roles?</p>
<div id="f9cfdb47" class="cell" data-code-fold-show="false" data-execution_count="16">
<details class="code-fold">
<summary>Click to view the code for aggregating titles</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> aggregate_titles_by_role_level(df: pd.DataFrame, output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'role_titles'</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Aggregate job titles for each role_title and level combination and save to JSON.</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">        df: DataFrame containing 'role_title', 'level', and 'title' columns</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">        output_dir: Directory to save the JSON output</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create output directory if it doesn't exist</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by role_title and level</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    grouped <span class="op">=</span> df.groupby([<span class="st">'role_title'</span>, <span class="st">'level'</span>])</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (role, level), group <span class="kw">in</span> grouped:</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get unique titles for this combination</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> {</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'titles'</span>: group[<span class="st">'title'</span>].unique().tolist()</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create safe filename from role and level</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        safe_role <span class="op">=</span> role.replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>        safe_level <span class="op">=</span> level.replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>safe_level<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_role<span class="sc">}</span><span class="ss">.json"</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Save to JSON file</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(os.path.join(output_dir, filename), <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>            json.dump(result, f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Saved titles for </span><span class="sc">{</span>level<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>role<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="607af472" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>aggregate_titles_by_role_level(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Saved titles for Entry-level AI Research Scientist
Saved titles for Mid-Level / Level AI Research Scientist
Saved titles for Senior-Level / Level AI Research Scientist
Saved titles for Entry-level AI Solution Architect
Saved titles for Mid-Level / Level AI Solution Architect
Saved titles for Senior-Level / Level AI Solution Architect
Saved titles for Entry-level AI/ML Engineer
Saved titles for Mid-Level / Level AI/ML Engineer
Saved titles for Senior-Level / Level AI/ML Engineer
Saved titles for Entry-level MLOps / AI Infrastructure Engineer
Saved titles for Mid-Level / Level MLOps / AI Infrastructure Engineer
Saved titles for Senior-Level / Level MLOps / AI Infrastructure Engineer</code></pre>
</div>
</div>
<p>I’ll use <code>o1</code> again to generate a summary of the most common titles for each role/level combination. In the prompt, I will omit my own role classification so as not to bias the results. I’ll ask it to “identify the most common titles listed below (ignoring slight variations), and then for those titles identify how often they occurred.”</p>
<p>Here’s a sample of what it said.</p>
<p>For Senior AI Research Scientist roles, <code>o1</code> observed the following titles to be common to this role:</p>
<ul>
<li>Research Scientist/Researcher (14 occurrences)</li>
<li>Research Engineer (7 occurrences)</li>
<li>Machine Learning Engineer (3 occurrences)</li>
<li>Generative AI Engineer (2 occurrences)</li>
<li>Software Engineer (Generative AI) (2 occurrences)</li>
</ul>
<p>For Senior AI ML Engineer roles, <code>o1</code> observed the following titles to be common to this role:</p>
<ul>
<li>Senior Software Engineer (6 occurrences)</li>
<li>Senior Machine Learning Engineer (5 occurrences)</li>
<li>Staff Software Engineer (5 occurrences)</li>
<li>Senior AI Engineer (4 occurrences)</li>
<li>Machine Learning Researcher (3 occurrences)</li>
<li>Staff Machine Learning Engineer (2 occurrences)</li>
<li>Principal Software Engineer (2 occurrences)</li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/tylerburleigh\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="tylerburleigh/tylerburleigh.github.io" data-repo-id="R_kgDOKMo8ww" data-category="Blog comments" data-category-id="DIC_kwDOIg6EJc4CSz92" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb24" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Analysis of the GenAI/LLM job market in January 2025"</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-01-24</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "A data-driven exploration of the  GenAI/LLM job market for science and engineering roles in January 2025. I scrape ~1000 job postings from ai-jobs.net, perform data extraction and classification using LLMs, and ultimately analyze the data to identify patterns and insights about the GenAI/LLM job market, including salary ranges, skill requirements, and role distribution."</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - prompt-engineering</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - python</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - job-market</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - GenAI</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - LLM</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="an">freeze:</span><span class="co"> true</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>As someone currently working in a "Prompt Engineering" role, I've been thinking a lot about how this title basically doesn't exist outside of a handful of companies, how the title communicates a narrow range of skills and responsibilities,and how the work that I do day-to-day is much larger in scope than just writing prompts. I identify more as an AI Engineer or AI Research Scientist, and so I was interested to see what I could learn about other similar roles that work with GenAI and LLMs.</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>So with that motivation, I set about to collect some data and look at the job market for these sorts of roles. What responsibilities and skills are being advertised most often, what kinds of titles are being used for these roles, and what kind of compensation is being offered at different levels of seniority?</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>To accomplish this, I built a custom web scraper to collect ~1000 job postings from ai-jobs.net. My code gathers job details like the title, company, location, salary, and posting date -- from a range of U.S. and Canadian cities, covering entry-level, mid-level, and senior positions. I then use a Large Language Model (LLM) to extract each job's key responsibilities, required skills, and qualifications. Afterwards, I classify each position to see whether it involves working with Generative AI or large language models, and if so, categorize it further into four major AI roles: (1) AI Research Scientist, (2) AI/ML Engineer, (3) MLOps/AI Infrastructure Engineer, and (4) AI Solution Architect. I believe this set of roles is a good representation of different areas of focus.</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>Finally, I integrate the various metadata and classifications into a comprehensive dataset. I observe that GenAI/LLM positions command consistently high salary ranges across the four different roles, particularly at more senior levels. Senior-level roles tended to offer median salaries in the $195K–$210K range, while mid-level roles generally clustered around $165K–$180K. Entry-level salaries showed greater variation (likely due to the small sample size) but still landed in competitive ranges of roughly $155K–$205K in many postings. These roles often share common technical demands—like proficiency with large-scale model training, distributed computing, and LLM-specific knowledge—though each role emphasizes distinct priorities (research vs. production, for example).</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="fu"># Scraping job postings</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>I'll scrape job postings from ai-jobs.net.</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>The code below implements a web scraper for job postings from ai-jobs.net. It collects job postings from major cities in the US and Canada, searching across entry-level, mid-level, and senior positions. For each job, it gets the title, company, location, salary, description, and posting date. The scraper saves each job as a JSON file and keeps track of what it has already scraped to avoid duplicates. It includes error handling and logging to track any problems that occur during scraping.</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold-show: false</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Click to view the Job Posting Scraper code"</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Optional, Set</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobData:</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Structured container for job posting data"""</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>    title: <span class="bu">str</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>    company: <span class="bu">str</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>    location: <span class="bu">str</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>    level: Optional[<span class="bu">str</span>]</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>    salary: Optional[<span class="bu">str</span>]</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>    url: <span class="bu">str</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    description: <span class="bu">str</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>    scraped_date: <span class="bu">str</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>    posted_date: Optional[<span class="bu">str</span>]</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>    raw_data: <span class="bu">str</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ScrapeConfig:</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Configuration settings for the scraper"""</span></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>    EXPERIENCE_LEVELS <span class="op">=</span> [<span class="st">'EN'</span>, <span class="st">'MI'</span>, <span class="st">'SE'</span>]  <span class="co"># Entry, Mid, Senior</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>    CITIES <span class="op">=</span> {</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">'5391959'</span>: <span class="st">'San Francisco'</span>,</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">'5128581'</span>: <span class="st">'New York City'</span>,</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">'6167865'</span>: <span class="st">'Toronto'</span>,</span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'6173331'</span>: <span class="st">'Vancouver'</span>,</span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">'5809844'</span>: <span class="st">'Seattle'</span>,</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">'4671654'</span>: <span class="st">'Austin'</span>,</span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>        <span class="st">'4930956'</span>: <span class="st">'Boston'</span>,</span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">'5'</span>: <span class="st">'Region'</span></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>    CATEGORIES <span class="op">=</span> {</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'1'</span>: <span class="st">'Research'</span>,</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">'2'</span>: <span class="st">'Engineering'</span>,</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">'18'</span>: <span class="st">'GenerativeAI'</span></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>    BASE_URL <span class="op">=</span> <span class="st">"https://ai-jobs.net"</span></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SalaryExtractor:</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles salary extraction logic"""</span></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_from_schema(schema_data: Dict) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract salary from schema.org data"""</span></span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> schema_data <span class="kw">and</span> <span class="st">'baseSalary'</span> <span class="kw">in</span> schema_data:</span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>                base_salary <span class="op">=</span> schema_data.get(<span class="st">'baseSalary'</span>, {}).get(<span class="st">'value'</span>, {})</span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> base_salary:</span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>                    min_value <span class="op">=</span> base_salary.get(<span class="st">'minValue'</span>)</span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>                    max_value <span class="op">=</span> base_salary.get(<span class="st">'maxValue'</span>)</span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a>                    currency <span class="op">=</span> base_salary.get(<span class="st">'currency'</span>, <span class="st">'USD'</span>)  <span class="co"># Default to USD if not specified</span></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> min_value <span class="kw">and</span> max_value:</span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>currency<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">float</span>(min_value)<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K - </span><span class="sc">{</span><span class="bu">float</span>(max_value)<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K"</span></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> min_value:</span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>currency<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">float</span>(min_value)<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K+"</span></span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>            logging.debug(<span class="ss">f"Error extracting schema salary: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_from_text(description: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract salary from description text"""</span></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a>        patterns <span class="op">=</span> [</span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'(?:salary range.*?)(?:CAD|\$)?([\d,]+)\s*-\s*(?:CAD|\$)?([\d,]+)'</span>,</span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>            <span class="vs">r'(?:salary.*?)(?:CAD|\$)?([\d,]+)(?:\s*-\s*(?:CAD|\$)?([\d,]+))?'</span></span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pattern <span class="kw">in</span> patterns:</span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> match <span class="op">:=</span> re.search(pattern, description, re.IGNORECASE):</span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a>                    groups <span class="op">=</span> match.groups()</span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Check if salary is in CAD</span></span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a>                    currency <span class="op">=</span> <span class="st">'CAD'</span> <span class="cf">if</span> <span class="st">'CAD'</span> <span class="kw">in</span> description.upper() <span class="cf">else</span> <span class="st">'USD'</span></span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">len</span>(groups) <span class="op">==</span> <span class="dv">2</span> <span class="kw">and</span> groups[<span class="dv">1</span>]:  <span class="co"># Range format</span></span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a>                        min_sal <span class="op">=</span> <span class="bu">float</span>(groups[<span class="dv">0</span>].replace(<span class="st">','</span>, <span class="st">''</span>))</span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>                        max_sal <span class="op">=</span> <span class="bu">float</span>(groups[<span class="dv">1</span>].replace(<span class="st">','</span>, <span class="st">''</span>))</span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>currency<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>min_sal<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K - </span><span class="sc">{</span>max_sal<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K"</span></span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> groups[<span class="dv">0</span>]:  <span class="co"># Single value format</span></span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a>                        base_sal <span class="op">=</span> <span class="bu">float</span>(groups[<span class="dv">0</span>].replace(<span class="st">','</span>, <span class="st">''</span>))</span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>currency<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>base_sal<span class="op">/</span><span class="dv">1000</span><span class="sc">:.0f}</span><span class="ss">K+"</span></span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract(cls, soup: BeautifulSoup, description: <span class="bu">str</span>, schema_data: Dict) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Main salary extraction method"""</span></span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try schema data first</span></span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> salary <span class="op">:=</span> cls.extract_from_schema(schema_data):</span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> salary</span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try description text</span></span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> salary <span class="op">:=</span> cls.extract_from_text(description):</span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> salary</span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try salary badge</span></span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> salary_badge <span class="op">:=</span> soup.find(<span class="st">'span'</span>, class_<span class="op">=</span><span class="st">'badge rounded-pill text-bg-success'</span>):</span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a>            salary_text <span class="op">=</span> salary_badge.text.strip()</span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> re.search(<span class="vs">r'(USD|\$|\d)'</span>, salary_text):</span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> salary_text</span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobPageParser:</span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles parsing of individual job pages"""</span></span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, html: <span class="bu">str</span>):</span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.soup <span class="op">=</span> BeautifulSoup(html, <span class="st">'html.parser'</span>)</span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.raw_html <span class="op">=</span> html</span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_schema_data(<span class="va">self</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Parse schema.org JSON-LD data"""</span></span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> script <span class="op">:=</span> <span class="va">self</span>.soup.find(<span class="st">'script'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'application/ld+json'</span>):</span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a>                cleaned_script <span class="op">=</span> re.sub(<span class="vs">r'[\x00-\x1F\x7F-\x9F]'</span>, <span class="st">''</span>, script.string)</span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> json.loads(cleaned_script)</span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a>                logging.warning(<span class="ss">f"Could not parse JSON-LD data: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> parse_job_data(<span class="va">self</span>, url: <span class="bu">str</span>) <span class="op">-&gt;</span> JobData:</span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract all job data from the page"""</span></span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a>        schema_data <span class="op">=</span> <span class="va">self</span>.parse_schema_data()</span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>        scraped_date <span class="op">=</span> datetime.now().isoformat()</span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get company name from schema or fallback to page element</span></span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a>        company <span class="op">=</span> schema_data.get(<span class="st">'hiringOrganization'</span>, {}).get(<span class="st">'name'</span>)</span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> company:</span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> company_elem <span class="op">:=</span> <span class="va">self</span>.soup.find(<span class="st">'a'</span>, class_<span class="op">=</span><span class="st">'company-name'</span>):</span>
<span id="cb24-170"><a href="#cb24-170" aria-hidden="true" tabindex="-1"></a>                company <span class="op">=</span> company_elem.text.strip()</span>
<span id="cb24-171"><a href="#cb24-171" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb24-172"><a href="#cb24-172" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get job level from meta description</span></span>
<span id="cb24-173"><a href="#cb24-173" aria-hidden="true" tabindex="-1"></a>        level <span class="op">=</span> <span class="va">None</span></span>
<span id="cb24-174"><a href="#cb24-174" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> meta_desc <span class="op">:=</span> <span class="va">self</span>.soup.find(<span class="st">'meta'</span>, {<span class="st">'name'</span>: <span class="st">'description'</span>}):</span>
<span id="cb24-175"><a href="#cb24-175" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> level_match <span class="op">:=</span> re.search(<span class="vs">r'a ([\w-]+level)'</span>, meta_desc[<span class="st">'content'</span>]):</span>
<span id="cb24-176"><a href="#cb24-176" aria-hidden="true" tabindex="-1"></a>                level <span class="op">=</span> level_match.group(<span class="dv">1</span>).replace(<span class="st">'-'</span>, <span class="st">'-level / '</span>).title()</span>
<span id="cb24-177"><a href="#cb24-177" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-178"><a href="#cb24-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> JobData(</span>
<span id="cb24-179"><a href="#cb24-179" aria-hidden="true" tabindex="-1"></a>            title<span class="op">=</span><span class="va">self</span>.soup.find(<span class="st">'h1'</span>, class_<span class="op">=</span><span class="st">'display-5'</span>).text.strip(),</span>
<span id="cb24-180"><a href="#cb24-180" aria-hidden="true" tabindex="-1"></a>            company<span class="op">=</span>company,</span>
<span id="cb24-181"><a href="#cb24-181" aria-hidden="true" tabindex="-1"></a>            location<span class="op">=</span><span class="va">self</span>.soup.find(<span class="st">'h3'</span>, class_<span class="op">=</span><span class="st">'lead'</span>).text.strip(),</span>
<span id="cb24-182"><a href="#cb24-182" aria-hidden="true" tabindex="-1"></a>            level<span class="op">=</span>level,</span>
<span id="cb24-183"><a href="#cb24-183" aria-hidden="true" tabindex="-1"></a>            salary<span class="op">=</span>SalaryExtractor.extract(</span>
<span id="cb24-184"><a href="#cb24-184" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.soup,</span>
<span id="cb24-185"><a href="#cb24-185" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.soup.find(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'job-description-text'</span>).text.strip(),</span>
<span id="cb24-186"><a href="#cb24-186" aria-hidden="true" tabindex="-1"></a>                schema_data</span>
<span id="cb24-187"><a href="#cb24-187" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb24-188"><a href="#cb24-188" aria-hidden="true" tabindex="-1"></a>            url<span class="op">=</span>url,</span>
<span id="cb24-189"><a href="#cb24-189" aria-hidden="true" tabindex="-1"></a>            description<span class="op">=</span><span class="va">self</span>.soup.find(<span class="st">'div'</span>, class_<span class="op">=</span><span class="st">'job-description-text'</span>).text.strip(),</span>
<span id="cb24-190"><a href="#cb24-190" aria-hidden="true" tabindex="-1"></a>            scraped_date<span class="op">=</span>scraped_date,</span>
<span id="cb24-191"><a href="#cb24-191" aria-hidden="true" tabindex="-1"></a>            posted_date<span class="op">=</span><span class="va">self</span>.calculate_posted_date(scraped_date),</span>
<span id="cb24-192"><a href="#cb24-192" aria-hidden="true" tabindex="-1"></a>            raw_data<span class="op">=</span><span class="va">self</span>.raw_html</span>
<span id="cb24-193"><a href="#cb24-193" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-194"><a href="#cb24-194" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-195"><a href="#cb24-195" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calculate_posted_date(<span class="va">self</span>, scraped_date_str: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb24-196"><a href="#cb24-196" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Calculate posting date from 'posted X time ago' text"""</span></span>
<span id="cb24-197"><a href="#cb24-197" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> match <span class="op">:=</span> re.search(<span class="vs">r'Posted (\d+) (hours?|days?|weeks?|months?) ago'</span>, <span class="va">self</span>.raw_html):</span>
<span id="cb24-198"><a href="#cb24-198" aria-hidden="true" tabindex="-1"></a>            number <span class="op">=</span> <span class="bu">int</span>(match.group(<span class="dv">1</span>))</span>
<span id="cb24-199"><a href="#cb24-199" aria-hidden="true" tabindex="-1"></a>            unit <span class="op">=</span> match.group(<span class="dv">2</span>)</span>
<span id="cb24-200"><a href="#cb24-200" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-201"><a href="#cb24-201" aria-hidden="true" tabindex="-1"></a>            scraped_date <span class="op">=</span> datetime.fromisoformat(scraped_date_str)</span>
<span id="cb24-202"><a href="#cb24-202" aria-hidden="true" tabindex="-1"></a>            delta <span class="op">=</span> {</span>
<span id="cb24-203"><a href="#cb24-203" aria-hidden="true" tabindex="-1"></a>                <span class="st">'hour'</span>: timedelta(hours<span class="op">=</span>number),</span>
<span id="cb24-204"><a href="#cb24-204" aria-hidden="true" tabindex="-1"></a>                <span class="st">'day'</span>: timedelta(days<span class="op">=</span>number),</span>
<span id="cb24-205"><a href="#cb24-205" aria-hidden="true" tabindex="-1"></a>                <span class="st">'week'</span>: timedelta(weeks<span class="op">=</span>number),</span>
<span id="cb24-206"><a href="#cb24-206" aria-hidden="true" tabindex="-1"></a>                <span class="st">'month'</span>: timedelta(days<span class="op">=</span>number <span class="op">*</span> <span class="dv">30</span>)  <span class="co"># Approximate</span></span>
<span id="cb24-207"><a href="#cb24-207" aria-hidden="true" tabindex="-1"></a>            }.get(unit.rstrip(<span class="st">'s'</span>))</span>
<span id="cb24-208"><a href="#cb24-208" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-209"><a href="#cb24-209" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> delta:</span>
<span id="cb24-210"><a href="#cb24-210" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> (scraped_date <span class="op">-</span> delta).isoformat()</span>
<span id="cb24-211"><a href="#cb24-211" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb24-212"><a href="#cb24-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-213"><a href="#cb24-213" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AIJobScraper:</span>
<span id="cb24-214"><a href="#cb24-214" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Main scraper orchestration class"""</span></span>
<span id="cb24-215"><a href="#cb24-215" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'json_data'</span>):</span>
<span id="cb24-216"><a href="#cb24-216" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir <span class="op">=</span> Path(output_dir)</span>
<span id="cb24-217"><a href="#cb24-217" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-218"><a href="#cb24-218" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.session <span class="op">=</span> requests.Session()</span>
<span id="cb24-219"><a href="#cb24-219" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.config <span class="op">=</span> ScrapeConfig()</span>
<span id="cb24-220"><a href="#cb24-220" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.existing_jobs <span class="op">=</span> <span class="va">self</span>._load_existing_jobs()</span>
<span id="cb24-221"><a href="#cb24-221" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-222"><a href="#cb24-222" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_existing_jobs(<span class="va">self</span>) <span class="op">-&gt;</span> Set[<span class="bu">str</span>]:</span>
<span id="cb24-223"><a href="#cb24-223" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load set of existing job URLs"""</span></span>
<span id="cb24-224"><a href="#cb24-224" aria-hidden="true" tabindex="-1"></a>        existing_jobs <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb24-225"><a href="#cb24-225" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> f <span class="kw">in</span> <span class="va">self</span>.output_dir.glob(<span class="st">'*.json'</span>):</span>
<span id="cb24-226"><a href="#cb24-226" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb24-227"><a href="#cb24-227" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.loads(f.read_text())</span>
<span id="cb24-228"><a href="#cb24-228" aria-hidden="true" tabindex="-1"></a>                existing_jobs.add(data[<span class="st">'url'</span>])</span>
<span id="cb24-229"><a href="#cb24-229" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-230"><a href="#cb24-230" aria-hidden="true" tabindex="-1"></a>                logging.warning(<span class="ss">f"Error reading </span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-231"><a href="#cb24-231" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> existing_jobs</span>
<span id="cb24-232"><a href="#cb24-232" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-233"><a href="#cb24-233" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _generate_search_urls(<span class="va">self</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb24-234"><a href="#cb24-234" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate all search URL combinations"""</span></span>
<span id="cb24-235"><a href="#cb24-235" aria-hidden="true" tabindex="-1"></a>        urls <span class="op">=</span> []</span>
<span id="cb24-236"><a href="#cb24-236" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> exp <span class="kw">in</span> <span class="va">self</span>.config.EXPERIENCE_LEVELS:</span>
<span id="cb24-237"><a href="#cb24-237" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> cat <span class="kw">in</span> <span class="va">self</span>.config.CATEGORIES:</span>
<span id="cb24-238"><a href="#cb24-238" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> city <span class="kw">in</span> <span class="va">self</span>.config.CITIES:</span>
<span id="cb24-239"><a href="#cb24-239" aria-hidden="true" tabindex="-1"></a>                    url <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config<span class="sc">.</span>BASE_URL<span class="sc">}</span><span class="ss">/?"</span></span>
<span id="cb24-240"><a href="#cb24-240" aria-hidden="true" tabindex="-1"></a>                    url <span class="op">+=</span> <span class="ss">f"cat=</span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb24-241"><a href="#cb24-241" aria-hidden="true" tabindex="-1"></a>                    url <span class="op">+=</span> <span class="ss">f"&amp;</span><span class="sc">{</span><span class="st">'reg'</span> <span class="cf">if</span> city <span class="op">==</span> <span class="st">'5'</span> <span class="cf">else</span> <span class="st">'cit'</span><span class="sc">}</span><span class="ss">=</span><span class="sc">{</span>city<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb24-242"><a href="#cb24-242" aria-hidden="true" tabindex="-1"></a>                    url <span class="op">+=</span> <span class="ss">f"&amp;typ=1&amp;key=&amp;exp=</span><span class="sc">{</span>exp<span class="sc">}</span><span class="ss">&amp;sal="</span></span>
<span id="cb24-243"><a href="#cb24-243" aria-hidden="true" tabindex="-1"></a>                    urls.append(url)</span>
<span id="cb24-244"><a href="#cb24-244" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> urls</span>
<span id="cb24-245"><a href="#cb24-245" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-246"><a href="#cb24-246" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_job_urls(<span class="va">self</span>, search_url: <span class="bu">str</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb24-247"><a href="#cb24-247" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get all job URLs from a search page"""</span></span>
<span id="cb24-248"><a href="#cb24-248" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb24-249"><a href="#cb24-249" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="va">self</span>.session.get(search_url)</span>
<span id="cb24-250"><a href="#cb24-250" aria-hidden="true" tabindex="-1"></a>            response.raise_for_status()</span>
<span id="cb24-251"><a href="#cb24-251" aria-hidden="true" tabindex="-1"></a>            soup <span class="op">=</span> BeautifulSoup(response.text, <span class="st">'html.parser'</span>)</span>
<span id="cb24-252"><a href="#cb24-252" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-253"><a href="#cb24-253" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> job_list <span class="op">:=</span> soup.find(<span class="st">'ul'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'job-list'</span>):</span>
<span id="cb24-254"><a href="#cb24-254" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> [</span>
<span id="cb24-255"><a href="#cb24-255" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config<span class="sc">.</span>BASE_URL<span class="sc">}{</span>link[<span class="st">'href'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb24-256"><a href="#cb24-256" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> link <span class="kw">in</span> job_list.find_all(<span class="st">'a'</span>, href<span class="op">=</span><span class="kw">lambda</span> h: h <span class="kw">and</span> <span class="st">'/job/'</span> <span class="kw">in</span> h)</span>
<span id="cb24-257"><a href="#cb24-257" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb24-258"><a href="#cb24-258" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-259"><a href="#cb24-259" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Error fetching job URLs: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-260"><a href="#cb24-260" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb24-261"><a href="#cb24-261" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-262"><a href="#cb24-262" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> scrape_job_details(<span class="va">self</span>, url: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[JobData]:</span>
<span id="cb24-263"><a href="#cb24-263" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Scrape details from a job page"""</span></span>
<span id="cb24-264"><a href="#cb24-264" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb24-265"><a href="#cb24-265" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="va">self</span>.session.get(url)</span>
<span id="cb24-266"><a href="#cb24-266" aria-hidden="true" tabindex="-1"></a>            response.raise_for_status()</span>
<span id="cb24-267"><a href="#cb24-267" aria-hidden="true" tabindex="-1"></a>            parser <span class="op">=</span> JobPageParser(response.text)</span>
<span id="cb24-268"><a href="#cb24-268" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> parser.parse_job_data(url)</span>
<span id="cb24-269"><a href="#cb24-269" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-270"><a href="#cb24-270" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Error scraping job </span><span class="sc">{</span>url<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-271"><a href="#cb24-271" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb24-272"><a href="#cb24-272" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-273"><a href="#cb24-273" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_job(<span class="va">self</span>, job: JobData) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-274"><a href="#cb24-274" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Save job data to JSON file"""</span></span>
<span id="cb24-275"><a href="#cb24-275" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb24-276"><a href="#cb24-276" aria-hidden="true" tabindex="-1"></a>            safe_title <span class="op">=</span> re.sub(<span class="vs">r'[^\w\s-]'</span>, <span class="st">''</span>, job.title)</span>
<span id="cb24-277"><a href="#cb24-277" aria-hidden="true" tabindex="-1"></a>            safe_company <span class="op">=</span> re.sub(<span class="vs">r'[^\w\s-]'</span>, <span class="st">''</span>, job.company <span class="kw">or</span> <span class="st">'unknown'</span>)</span>
<span id="cb24-278"><a href="#cb24-278" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>safe_company<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_title<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span><span class="bu">hash</span>(job.url)<span class="sc">}</span><span class="ss">.json"</span></span>
<span id="cb24-279"><a href="#cb24-279" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-280"><a href="#cb24-280" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.output_dir.joinpath(filename).write_text(</span>
<span id="cb24-281"><a href="#cb24-281" aria-hidden="true" tabindex="-1"></a>                json.dumps(<span class="bu">vars</span>(job), indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-282"><a href="#cb24-282" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-283"><a href="#cb24-283" aria-hidden="true" tabindex="-1"></a>            logging.info(<span class="ss">f"Saved job: </span><span class="sc">{</span>job<span class="sc">.</span>title<span class="sc">}</span><span class="ss"> at </span><span class="sc">{</span>job<span class="sc">.</span>company<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-284"><a href="#cb24-284" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-285"><a href="#cb24-285" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-286"><a href="#cb24-286" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Error saving job: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-287"><a href="#cb24-287" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span></span>
<span id="cb24-288"><a href="#cb24-288" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-289"><a href="#cb24-289" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> scrape_jobs(<span class="va">self</span>, test: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb24-290"><a href="#cb24-290" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Main scraping method"""</span></span>
<span id="cb24-291"><a href="#cb24-291" aria-hidden="true" tabindex="-1"></a>        jobs_found <span class="op">=</span> jobs_skipped <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb24-292"><a href="#cb24-292" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-293"><a href="#cb24-293" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> search_url <span class="kw">in</span> <span class="va">self</span>._generate_search_urls():</span>
<span id="cb24-294"><a href="#cb24-294" aria-hidden="true" tabindex="-1"></a>            logging.debug(<span class="ss">f"Processing search URL: </span><span class="sc">{</span>search_url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-295"><a href="#cb24-295" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-296"><a href="#cb24-296" aria-hidden="true" tabindex="-1"></a>            job_urls <span class="op">=</span> <span class="va">self</span>.get_job_urls(search_url)</span>
<span id="cb24-297"><a href="#cb24-297" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> test <span class="kw">and</span> job_urls:</span>
<span id="cb24-298"><a href="#cb24-298" aria-hidden="true" tabindex="-1"></a>                job_urls <span class="op">=</span> job_urls[:<span class="dv">1</span>]</span>
<span id="cb24-299"><a href="#cb24-299" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb24-300"><a href="#cb24-300" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> url <span class="kw">in</span> job_urls:</span>
<span id="cb24-301"><a href="#cb24-301" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> url <span class="kw">in</span> <span class="va">self</span>.existing_jobs:</span>
<span id="cb24-302"><a href="#cb24-302" aria-hidden="true" tabindex="-1"></a>                    jobs_skipped <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb24-303"><a href="#cb24-303" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb24-304"><a href="#cb24-304" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb24-305"><a href="#cb24-305" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> job_data <span class="op">:=</span> <span class="va">self</span>.scrape_job_details(url):</span>
<span id="cb24-306"><a href="#cb24-306" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.save_job(job_data)</span>
<span id="cb24-307"><a href="#cb24-307" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.existing_jobs.add(url)</span>
<span id="cb24-308"><a href="#cb24-308" aria-hidden="true" tabindex="-1"></a>                    jobs_found <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb24-309"><a href="#cb24-309" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb24-310"><a href="#cb24-310" aria-hidden="true" tabindex="-1"></a>                time.sleep(<span class="dv">1</span>)  <span class="co"># Rate limiting</span></span>
<span id="cb24-311"><a href="#cb24-311" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb24-312"><a href="#cb24-312" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Found </span><span class="sc">{</span>jobs_found<span class="sc">}</span><span class="ss"> new jobs. Skipped </span><span class="sc">{</span>jobs_skipped<span class="sc">}</span><span class="ss"> existing jobs."</span>)</span>
<span id="cb24-313"><a href="#cb24-313" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">'jobs_found'</span>: jobs_found, <span class="st">'jobs_skipped'</span>: jobs_skipped}</span>
<span id="cb24-314"><a href="#cb24-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-315"><a href="#cb24-315" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scrape_jobs(test: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, verbose: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb24-316"><a href="#cb24-316" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Convenience function to run the scraper"""</span></span>
<span id="cb24-317"><a href="#cb24-317" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> verbose:</span>
<span id="cb24-318"><a href="#cb24-318" aria-hidden="true" tabindex="-1"></a>        logging.getLogger().setLevel(logging.WARNING)</span>
<span id="cb24-319"><a href="#cb24-319" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-320"><a href="#cb24-320" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb24-321"><a href="#cb24-321" aria-hidden="true" tabindex="-1"></a>        scraper <span class="op">=</span> AIJobScraper(output_dir<span class="op">=</span>Path.cwd() <span class="op">/</span> <span class="st">'json_data'</span>)</span>
<span id="cb24-322"><a href="#cb24-322" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> scraper.scrape_jobs(test<span class="op">=</span>test)</span>
<span id="cb24-323"><a href="#cb24-323" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-324"><a href="#cb24-324" aria-hidden="true" tabindex="-1"></a>        logging.error(<span class="ss">f"Scraper failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-325"><a href="#cb24-325" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span></span>
<span id="cb24-326"><a href="#cb24-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-327"><a href="#cb24-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-328"><a href="#cb24-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-331"><a href="#cb24-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-332"><a href="#cb24-332" aria-hidden="true" tabindex="-1"></a><span class="co">#logging.basicConfig(level=logging.INFO)</span></span>
<span id="cb24-333"><a href="#cb24-333" aria-hidden="true" tabindex="-1"></a><span class="co">#scraper = AIJobScraper()</span></span>
<span id="cb24-334"><a href="#cb24-334" aria-hidden="true" tabindex="-1"></a><span class="co">#scrape_results = scraper.scrape_jobs(test=False)</span></span>
<span id="cb24-335"><a href="#cb24-335" aria-hidden="true" tabindex="-1"></a><span class="co">#print(f"Found {scrape_results['jobs_found']} new jobs, skipped {scrape_results['jobs_skipped']} existing jobs")</span></span>
<span id="cb24-336"><a href="#cb24-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-337"><a href="#cb24-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-338"><a href="#cb24-338" aria-hidden="true" tabindex="-1"></a><span class="fu"># General-purpose LLM completion function</span></span>
<span id="cb24-339"><a href="#cb24-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-340"><a href="#cb24-340" aria-hidden="true" tabindex="-1"></a>For the classification tasks, I'll write a general-purpose LLM completion function. This function takes a prompt and a model as parameters, and returns the completion from the OpenAI API.</span>
<span id="cb24-341"><a href="#cb24-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-344"><a href="#cb24-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-345"><a href="#cb24-345" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> AsyncOpenAI</span>
<span id="cb24-346"><a href="#cb24-346" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb24-347"><a href="#cb24-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-348"><a href="#cb24-348" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_completion(prompt: <span class="bu">str</span>, model: <span class="bu">str</span> <span class="op">=</span> <span class="st">"gpt-4o-2024-08-06"</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb24-349"><a href="#cb24-349" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Get a completion from the OpenAI API."""</span></span>
<span id="cb24-350"><a href="#cb24-350" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> AsyncOpenAI(api_key<span class="op">=</span>os.getenv(<span class="st">'OPENAI_API_KEY'</span>))  <span class="co"># Initialize with API key from env vars</span></span>
<span id="cb24-351"><a href="#cb24-351" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="cf">await</span> client.chat.completions.create(</span>
<span id="cb24-352"><a href="#cb24-352" aria-hidden="true" tabindex="-1"></a>        model<span class="op">=</span>model,</span>
<span id="cb24-353"><a href="#cb24-353" aria-hidden="true" tabindex="-1"></a>        messages<span class="op">=</span>[{<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: prompt}],</span>
<span id="cb24-354"><a href="#cb24-354" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span><span class="dv">0</span></span>
<span id="cb24-355"><a href="#cb24-355" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-356"><a href="#cb24-356" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content</span>
<span id="cb24-357"><a href="#cb24-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-358"><a href="#cb24-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-359"><a href="#cb24-359" aria-hidden="true" tabindex="-1"></a><span class="fu"># Extract Responsibilities, Skills, and Qualifications</span></span>
<span id="cb24-360"><a href="#cb24-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-361"><a href="#cb24-361" aria-hidden="true" tabindex="-1"></a>The code below uses an LLM to extract key information from job postings that will be used to classify them into different role categories. It uses OpenAI's GPT-4o model to analyze job descriptions and extract three key components: responsibilities, skills, and qualifications. The system processes multiple jobs concurrently with rate limiting, saves the extracted data as JSON files, and includes retry logic for handling API rate limits. The code uses <span class="in">`asyncio`</span> for concurrent processing and includes error handling and logging. It also checks for previously processed jobs to avoid duplicate work.</span>
<span id="cb24-362"><a href="#cb24-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-363"><a href="#cb24-363" aria-hidden="true" tabindex="-1"></a>Also included is code that implements data preprocessing steps. This code has functions to load JSON files into a pandas DataFrame, uses a list of keywords to filter out certain jobs that are not relevant to the analysis, and removes duplicate or highly similar job descriptions using TF-IDF vectorization and cosine similarity. The main function <span class="in">`process_job_listings()`</span> combines these steps, taking a directory path, similarity threshold, and filter keywords as parameters. It returns a dictionary containing the processed DataFrame along with counts of the original and filtered entries.</span>
<span id="cb24-364"><a href="#cb24-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-367"><a href="#cb24-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-368"><a href="#cb24-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb24-369"><a href="#cb24-369" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold-show: false</span></span>
<span id="cb24-370"><a href="#cb24-370" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Click to view the code for LLM extraction"</span></span>
<span id="cb24-371"><a href="#cb24-371" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb24-372"><a href="#cb24-372" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb24-373"><a href="#cb24-373" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb24-374"><a href="#cb24-374" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb24-375"><a href="#cb24-375" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb24-376"><a href="#cb24-376" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nest_asyncio</span>
<span id="cb24-377"><a href="#cb24-377" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Optional</span>
<span id="cb24-378"><a href="#cb24-378" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-379"><a href="#cb24-379" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb24-380"><a href="#cb24-380" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tenacity <span class="im">import</span> retry, stop_after_attempt, wait_exponential, retry_if_exception_type</span>
<span id="cb24-381"><a href="#cb24-381" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> AsyncOpenAI, RateLimitError</span>
<span id="cb24-382"><a href="#cb24-382" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb24-383"><a href="#cb24-383" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb24-384"><a href="#cb24-384" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb24-385"><a href="#cb24-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-386"><a href="#cb24-386" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable nested event loops for Jupyter notebooks</span></span>
<span id="cb24-387"><a href="#cb24-387" aria-hidden="true" tabindex="-1"></a>nest_asyncio.<span class="bu">apply</span>()</span>
<span id="cb24-388"><a href="#cb24-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-389"><a href="#cb24-389" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up logging configuration</span></span>
<span id="cb24-390"><a href="#cb24-390" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(</span>
<span id="cb24-391"><a href="#cb24-391" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>logging.INFO,</span>
<span id="cb24-392"><a href="#cb24-392" aria-hidden="true" tabindex="-1"></a>    <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span></span>
<span id="cb24-393"><a href="#cb24-393" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-394"><a href="#cb24-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-395"><a href="#cb24-395" aria-hidden="true" tabindex="-1"></a>PROMPTS <span class="op">=</span> {</span>
<span id="cb24-396"><a href="#cb24-396" aria-hidden="true" tabindex="-1"></a>    <span class="st">"prompt"</span>: <span class="st">"""</span></span>
<span id="cb24-397"><a href="#cb24-397" aria-hidden="true" tabindex="-1"></a><span class="st">    You will be given a Job Description.</span></span>
<span id="cb24-398"><a href="#cb24-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-399"><a href="#cb24-399" aria-hidden="true" tabindex="-1"></a><span class="st">    Your task is to extract a list of Responsibilities,</span></span>
<span id="cb24-400"><a href="#cb24-400" aria-hidden="true" tabindex="-1"></a><span class="st">    Skills, and Qualifications. </span></span>
<span id="cb24-401"><a href="#cb24-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-402"><a href="#cb24-402" aria-hidden="true" tabindex="-1"></a><span class="st">    - Responsibilities are the tasks and activities that the job requires the employee to perform.</span></span>
<span id="cb24-403"><a href="#cb24-403" aria-hidden="true" tabindex="-1"></a><span class="st">    - Skills are the abilities and knowledge that the employee needs to have to perform the responsibilities.</span></span>
<span id="cb24-404"><a href="#cb24-404" aria-hidden="true" tabindex="-1"></a><span class="st">    - Qualifications are the requirements that the employee needs to meet to be considered for the job.</span></span>
<span id="cb24-405"><a href="#cb24-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-406"><a href="#cb24-406" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;JobDescription&gt;</span></span>
<span id="cb24-407"><a href="#cb24-407" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="sc">{job_description}</span></span>
<span id="cb24-408"><a href="#cb24-408" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/JobDescription&gt;</span></span>
<span id="cb24-409"><a href="#cb24-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-410"><a href="#cb24-410" aria-hidden="true" tabindex="-1"></a><span class="st">    Return a list of Responsibilities, Skills, and Qualifications as follows:</span></span>
<span id="cb24-411"><a href="#cb24-411" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Responsibilities&gt;</span></span>
<span id="cb24-412"><a href="#cb24-412" aria-hidden="true" tabindex="-1"></a><span class="st">    [Bullet point list of responsibilities]</span></span>
<span id="cb24-413"><a href="#cb24-413" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Responsibilities&gt;</span></span>
<span id="cb24-414"><a href="#cb24-414" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Skills&gt;</span></span>
<span id="cb24-415"><a href="#cb24-415" aria-hidden="true" tabindex="-1"></a><span class="st">    [Bullet point list of skills]</span></span>
<span id="cb24-416"><a href="#cb24-416" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Skills&gt;</span></span>
<span id="cb24-417"><a href="#cb24-417" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Qualifications&gt;</span></span>
<span id="cb24-418"><a href="#cb24-418" aria-hidden="true" tabindex="-1"></a><span class="st">    [Bullet point list of qualifications]</span></span>
<span id="cb24-419"><a href="#cb24-419" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Qualifications&gt;</span></span>
<span id="cb24-420"><a href="#cb24-420" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb24-421"><a href="#cb24-421" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-422"><a href="#cb24-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-423"><a href="#cb24-423" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobProcessor:</span>
<span id="cb24-424"><a href="#cb24-424" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, output_dir<span class="op">=</span><span class="st">'json_extracted_data'</span>):</span>
<span id="cb24-425"><a href="#cb24-425" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir <span class="op">=</span> output_dir</span>
<span id="cb24-426"><a href="#cb24-426" aria-hidden="true" tabindex="-1"></a>        os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-427"><a href="#cb24-427" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.semaphore <span class="op">=</span> asyncio.Semaphore(<span class="dv">3</span>)</span>
<span id="cb24-428"><a href="#cb24-428" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processed <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb24-429"><a href="#cb24-429" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.skipped <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb24-430"><a href="#cb24-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-431"><a href="#cb24-431" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse_llm_response(<span class="va">self</span>, response: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]:</span>
<span id="cb24-432"><a href="#cb24-432" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Parse LLM response into structured data."""</span></span>
<span id="cb24-433"><a href="#cb24-433" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> {</span>
<span id="cb24-434"><a href="#cb24-434" aria-hidden="true" tabindex="-1"></a>            <span class="st">"responsibilities"</span>: [],</span>
<span id="cb24-435"><a href="#cb24-435" aria-hidden="true" tabindex="-1"></a>            <span class="st">"skills"</span>: [],</span>
<span id="cb24-436"><a href="#cb24-436" aria-hidden="true" tabindex="-1"></a>            <span class="st">"qualifications"</span>: []</span>
<span id="cb24-437"><a href="#cb24-437" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-438"><a href="#cb24-438" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-439"><a href="#cb24-439" aria-hidden="true" tabindex="-1"></a>        sections <span class="op">=</span> {</span>
<span id="cb24-440"><a href="#cb24-440" aria-hidden="true" tabindex="-1"></a>            <span class="st">"responsibilities"</span>: <span class="vs">r'&lt;Responsibilities&gt;\n(.*?)\n&lt;/Responsibilities&gt;'</span>,</span>
<span id="cb24-441"><a href="#cb24-441" aria-hidden="true" tabindex="-1"></a>            <span class="st">"skills"</span>: <span class="vs">r'&lt;Skills&gt;\n(.*?)\n&lt;/Skills&gt;'</span>,</span>
<span id="cb24-442"><a href="#cb24-442" aria-hidden="true" tabindex="-1"></a>            <span class="st">"qualifications"</span>: <span class="vs">r'&lt;Qualifications&gt;\n(.*?)\n&lt;/Qualifications&gt;'</span></span>
<span id="cb24-443"><a href="#cb24-443" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-444"><a href="#cb24-444" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-445"><a href="#cb24-445" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> section, pattern <span class="kw">in</span> sections.items():</span>
<span id="cb24-446"><a href="#cb24-446" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> match <span class="op">:=</span> re.search(pattern, response, re.DOTALL):</span>
<span id="cb24-447"><a href="#cb24-447" aria-hidden="true" tabindex="-1"></a>                result[section] <span class="op">=</span> [</span>
<span id="cb24-448"><a href="#cb24-448" aria-hidden="true" tabindex="-1"></a>                    item.strip(<span class="st">'- '</span>) </span>
<span id="cb24-449"><a href="#cb24-449" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> item <span class="kw">in</span> match.group(<span class="dv">1</span>).strip().split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb24-450"><a href="#cb24-450" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> item.strip(<span class="st">'- '</span>)  <span class="co"># Filter out empty items</span></span>
<span id="cb24-451"><a href="#cb24-451" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb24-452"><a href="#cb24-452" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-453"><a href="#cb24-453" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb24-454"><a href="#cb24-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-455"><a href="#cb24-455" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> extract_job_details(<span class="va">self</span>, job_id: <span class="bu">str</span>, job_description: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]:</span>
<span id="cb24-456"><a href="#cb24-456" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract structured information from job description using LLM."""</span></span>
<span id="cb24-457"><a href="#cb24-457" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb24-458"><a href="#cb24-458" aria-hidden="true" tabindex="-1"></a>            prompt <span class="op">=</span> PROMPTS[<span class="st">"prompt"</span>].<span class="bu">format</span>(job_description<span class="op">=</span>job_description)</span>
<span id="cb24-459"><a href="#cb24-459" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="cf">await</span> get_completion(prompt)</span>
<span id="cb24-460"><a href="#cb24-460" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> <span class="va">self</span>._parse_llm_response(response)</span>
<span id="cb24-461"><a href="#cb24-461" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-462"><a href="#cb24-462" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Save results</span></span>
<span id="cb24-463"><a href="#cb24-463" aria-hidden="true" tabindex="-1"></a>            json_path <span class="op">=</span> os.path.join(<span class="va">self</span>.output_dir, <span class="ss">f'</span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">.json'</span>)</span>
<span id="cb24-464"><a href="#cb24-464" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(json_path, <span class="st">'w'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> f:</span>
<span id="cb24-465"><a href="#cb24-465" aria-hidden="true" tabindex="-1"></a>                json.dump(result, f, indent<span class="op">=</span><span class="dv">2</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-466"><a href="#cb24-466" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-467"><a href="#cb24-467" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result</span>
<span id="cb24-468"><a href="#cb24-468" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-469"><a href="#cb24-469" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-470"><a href="#cb24-470" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Error extracting job details: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-471"><a href="#cb24-471" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"responsibilities"</span>: [], <span class="st">"skills"</span>: [], <span class="st">"qualifications"</span>: []}</span>
<span id="cb24-472"><a href="#cb24-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-473"><a href="#cb24-473" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> process_single_job(<span class="va">self</span>, job_id: <span class="bu">str</span>, description: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]:</span>
<span id="cb24-474"><a href="#cb24-474" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process a single job with caching."""</span></span>
<span id="cb24-475"><a href="#cb24-475" aria-hidden="true" tabindex="-1"></a>        json_path <span class="op">=</span> os.path.join(<span class="va">self</span>.output_dir, <span class="ss">f'</span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">.json'</span>)</span>
<span id="cb24-476"><a href="#cb24-476" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-477"><a href="#cb24-477" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> os.path.exists(json_path):</span>
<span id="cb24-478"><a href="#cb24-478" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.skipped <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb24-479"><a href="#cb24-479" aria-hidden="true" tabindex="-1"></a>            logging.debug(<span class="ss">f"Skipping job ID </span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss"> - already processed"</span>)</span>
<span id="cb24-480"><a href="#cb24-480" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(json_path, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> f:</span>
<span id="cb24-481"><a href="#cb24-481" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> json.load(f)</span>
<span id="cb24-482"><a href="#cb24-482" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-483"><a href="#cb24-483" aria-hidden="true" tabindex="-1"></a>        <span class="cf">async</span> <span class="cf">with</span> <span class="va">self</span>.semaphore:</span>
<span id="cb24-484"><a href="#cb24-484" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.processed <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb24-485"><a href="#cb24-485" aria-hidden="true" tabindex="-1"></a>            logging.info(<span class="ss">f"Processing job ID: </span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-486"><a href="#cb24-486" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="cf">await</span> <span class="va">self</span>.extract_job_details(job_id, description)</span>
<span id="cb24-487"><a href="#cb24-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-488"><a href="#cb24-488" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> process_jobs(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]]:</span>
<span id="cb24-489"><a href="#cb24-489" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process multiple jobs concurrently."""</span></span>
<span id="cb24-490"><a href="#cb24-490" aria-hidden="true" tabindex="-1"></a>        tasks <span class="op">=</span> [</span>
<span id="cb24-491"><a href="#cb24-491" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.process_single_job(<span class="bu">str</span>(row[<span class="st">'id'</span>]), row[<span class="st">'description'</span>])</span>
<span id="cb24-492"><a href="#cb24-492" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows()</span>
<span id="cb24-493"><a href="#cb24-493" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb24-494"><a href="#cb24-494" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-495"><a href="#cb24-495" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> <span class="cf">await</span> asyncio.gather(<span class="op">*</span>tasks)</span>
<span id="cb24-496"><a href="#cb24-496" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-497"><a href="#cb24-497" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Processing complete:"</span>)</span>
<span id="cb24-498"><a href="#cb24-498" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"- New jobs processed: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>processed<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-499"><a href="#cb24-499" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"- Skipped jobs (already processed): </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>skipped<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-500"><a href="#cb24-500" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-501"><a href="#cb24-501" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb24-502"><a href="#cb24-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-503"><a href="#cb24-503" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataPreprocessor:</span>
<span id="cb24-504"><a href="#cb24-504" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, similarity_threshold<span class="op">=</span><span class="fl">0.8</span>):</span>
<span id="cb24-505"><a href="#cb24-505" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.similarity_threshold <span class="op">=</span> similarity_threshold</span>
<span id="cb24-506"><a href="#cb24-506" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.default_filter_keywords <span class="op">=</span> [</span>
<span id="cb24-507"><a href="#cb24-507" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Dir '</span>, <span class="st">'Director'</span>, <span class="st">'Intern'</span>, <span class="st">'Data Scientist'</span>, <span class="st">'Data Science'</span>,</span>
<span id="cb24-508"><a href="#cb24-508" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Content Writer'</span>, <span class="st">'Faculty'</span>, <span class="st">'Product Owner'</span>, <span class="st">'Manager'</span>,</span>
<span id="cb24-509"><a href="#cb24-509" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Analyst'</span>, <span class="st">'Postdoctoral'</span>, <span class="st">'Postdoc'</span>, <span class="st">'Summer'</span></span>
<span id="cb24-510"><a href="#cb24-510" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb24-511"><a href="#cb24-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-512"><a href="#cb24-512" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb24-513"><a href="#cb24-513" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_json_files(directory<span class="op">=</span><span class="st">'json_data'</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-514"><a href="#cb24-514" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load JSON files into DataFrame with error handling."""</span></span>
<span id="cb24-515"><a href="#cb24-515" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb24-516"><a href="#cb24-516" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-517"><a href="#cb24-517" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(directory):</span>
<span id="cb24-518"><a href="#cb24-518" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Directory </span><span class="sc">{</span>directory<span class="sc">}</span><span class="ss"> does not exist"</span>)</span>
<span id="cb24-519"><a href="#cb24-519" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> df</span>
<span id="cb24-520"><a href="#cb24-520" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-521"><a href="#cb24-521" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(directory) <span class="cf">if</span> f.endswith(<span class="st">'.json'</span>)]:</span>
<span id="cb24-522"><a href="#cb24-522" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb24-523"><a href="#cb24-523" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(os.path.join(directory, <span class="bu">file</span>), <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb24-524"><a href="#cb24-524" aria-hidden="true" tabindex="-1"></a>                    data <span class="op">=</span> json.load(f)</span>
<span id="cb24-525"><a href="#cb24-525" aria-hidden="true" tabindex="-1"></a>                    df <span class="op">=</span> pd.concat([df, pd.DataFrame([data])], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-526"><a href="#cb24-526" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-527"><a href="#cb24-527" aria-hidden="true" tabindex="-1"></a>                logging.error(<span class="ss">f"Error loading </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-528"><a href="#cb24-528" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-529"><a href="#cb24-529" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> df.empty:</span>
<span id="cb24-530"><a href="#cb24-530" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'id'</span>] <span class="op">=</span> df[<span class="st">'url'</span>].<span class="bu">apply</span>(</span>
<span id="cb24-531"><a href="#cb24-531" aria-hidden="true" tabindex="-1"></a>                <span class="kw">lambda</span> x: <span class="ss">f"j</span><span class="sc">{</span>hashlib<span class="sc">.</span>md5(x.encode())<span class="sc">.</span>hexdigest()[:<span class="dv">5</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb24-532"><a href="#cb24-532" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-533"><a href="#cb24-533" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-534"><a href="#cb24-534" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb24-535"><a href="#cb24-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-536"><a href="#cb24-536" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> filter_by_title(<span class="va">self</span>, df: pd.DataFrame, </span>
<span id="cb24-537"><a href="#cb24-537" aria-hidden="true" tabindex="-1"></a>                       filter_keywords: Optional[List[<span class="bu">str</span>]] <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-538"><a href="#cb24-538" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Filter DataFrame by job titles."""</span></span>
<span id="cb24-539"><a href="#cb24-539" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df.empty:</span>
<span id="cb24-540"><a href="#cb24-540" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> df</span>
<span id="cb24-541"><a href="#cb24-541" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-542"><a href="#cb24-542" aria-hidden="true" tabindex="-1"></a>        keywords <span class="op">=</span> filter_keywords <span class="kw">or</span> <span class="va">self</span>.default_filter_keywords</span>
<span id="cb24-543"><a href="#cb24-543" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df[<span class="op">~</span>df[<span class="st">'title'</span>].<span class="bu">str</span>.contains(</span>
<span id="cb24-544"><a href="#cb24-544" aria-hidden="true" tabindex="-1"></a>            <span class="st">'|'</span>.join(keywords),</span>
<span id="cb24-545"><a href="#cb24-545" aria-hidden="true" tabindex="-1"></a>            case<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb24-546"><a href="#cb24-546" aria-hidden="true" tabindex="-1"></a>            na<span class="op">=</span><span class="va">False</span></span>
<span id="cb24-547"><a href="#cb24-547" aria-hidden="true" tabindex="-1"></a>        )]</span>
<span id="cb24-548"><a href="#cb24-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-549"><a href="#cb24-549" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> remove_similar_descriptions(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-550"><a href="#cb24-550" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Remove similar job descriptions using TF-IDF and cosine similarity."""</span></span>
<span id="cb24-551"><a href="#cb24-551" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df.empty:</span>
<span id="cb24-552"><a href="#cb24-552" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> df</span>
<span id="cb24-553"><a href="#cb24-553" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-554"><a href="#cb24-554" aria-hidden="true" tabindex="-1"></a>        tfidf <span class="op">=</span> TfidfVectorizer(stop_words<span class="op">=</span><span class="st">'english'</span>)</span>
<span id="cb24-555"><a href="#cb24-555" aria-hidden="true" tabindex="-1"></a>        tfidf_matrix <span class="op">=</span> tfidf.fit_transform(df[<span class="st">'description'</span>].fillna(<span class="st">''</span>))</span>
<span id="cb24-556"><a href="#cb24-556" aria-hidden="true" tabindex="-1"></a>        cosine_sim <span class="op">=</span> cosine_similarity(tfidf_matrix, tfidf_matrix)</span>
<span id="cb24-557"><a href="#cb24-557" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-558"><a href="#cb24-558" aria-hidden="true" tabindex="-1"></a>        indices_to_remove <span class="op">=</span> {</span>
<span id="cb24-559"><a href="#cb24-559" aria-hidden="true" tabindex="-1"></a>            j <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df))</span>
<span id="cb24-560"><a href="#cb24-560" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(df))</span>
<span id="cb24-561"><a href="#cb24-561" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cosine_sim[i][j] <span class="op">&gt;</span> <span class="va">self</span>.similarity_threshold</span>
<span id="cb24-562"><a href="#cb24-562" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-563"><a href="#cb24-563" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-564"><a href="#cb24-564" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df.iloc[<span class="op">~</span>df.index.isin(<span class="bu">list</span>(indices_to_remove))]</span>
<span id="cb24-565"><a href="#cb24-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-566"><a href="#cb24-566" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_jobs_from_dataframe(df: pd.DataFrame) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, List[<span class="bu">str</span>]]]:</span>
<span id="cb24-567"><a href="#cb24-567" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Wrapper function to process jobs from a DataFrame."""</span></span>
<span id="cb24-568"><a href="#cb24-568" aria-hidden="true" tabindex="-1"></a>    processor <span class="op">=</span> JobProcessor()</span>
<span id="cb24-569"><a href="#cb24-569" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-570"><a href="#cb24-570" aria-hidden="true" tabindex="-1"></a>    loop <span class="op">=</span> asyncio.get_event_loop()</span>
<span id="cb24-571"><a href="#cb24-571" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> loop.is_running():</span>
<span id="cb24-572"><a href="#cb24-572" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loop.create_task(processor.process_jobs(df))</span>
<span id="cb24-573"><a href="#cb24-573" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb24-574"><a href="#cb24-574" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> asyncio.run(processor.process_jobs(df))</span>
<span id="cb24-575"><a href="#cb24-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-576"><a href="#cb24-576" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_job_listings(directory<span class="op">=</span><span class="st">'json_data'</span>, similarity_threshold<span class="op">=</span><span class="fl">0.8</span>, </span>
<span id="cb24-577"><a href="#cb24-577" aria-hidden="true" tabindex="-1"></a>                        filter_keywords<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb24-578"><a href="#cb24-578" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Main function to process job listings."""</span></span>
<span id="cb24-579"><a href="#cb24-579" aria-hidden="true" tabindex="-1"></a>    preprocessor <span class="op">=</span> DataPreprocessor(similarity_threshold)</span>
<span id="cb24-580"><a href="#cb24-580" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-581"><a href="#cb24-581" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load and preprocess data</span></span>
<span id="cb24-582"><a href="#cb24-582" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> preprocessor.load_json_files(directory)</span>
<span id="cb24-583"><a href="#cb24-583" aria-hidden="true" tabindex="-1"></a>    initial_count <span class="op">=</span> <span class="bu">len</span>(df)</span>
<span id="cb24-584"><a href="#cb24-584" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-585"><a href="#cb24-585" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df.empty:</span>
<span id="cb24-586"><a href="#cb24-586" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb24-587"><a href="#cb24-587" aria-hidden="true" tabindex="-1"></a>            <span class="st">'processed_data'</span>: df,</span>
<span id="cb24-588"><a href="#cb24-588" aria-hidden="true" tabindex="-1"></a>            <span class="st">'original_count'</span>: <span class="dv">0</span>,</span>
<span id="cb24-589"><a href="#cb24-589" aria-hidden="true" tabindex="-1"></a>            <span class="st">'filtered_count'</span>: <span class="dv">0</span></span>
<span id="cb24-590"><a href="#cb24-590" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-591"><a href="#cb24-591" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-592"><a href="#cb24-592" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> preprocessor.filter_by_title(df, filter_keywords)</span>
<span id="cb24-593"><a href="#cb24-593" aria-hidden="true" tabindex="-1"></a>    df_filtered <span class="op">=</span> preprocessor.remove_similar_descriptions(df)</span>
<span id="cb24-594"><a href="#cb24-594" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-595"><a href="#cb24-595" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb24-596"><a href="#cb24-596" aria-hidden="true" tabindex="-1"></a>        <span class="st">'processed_data'</span>: df_filtered,</span>
<span id="cb24-597"><a href="#cb24-597" aria-hidden="true" tabindex="-1"></a>        <span class="st">'original_count'</span>: initial_count,</span>
<span id="cb24-598"><a href="#cb24-598" aria-hidden="true" tabindex="-1"></a>        <span class="st">'filtered_count'</span>: <span class="bu">len</span>(df_filtered)</span>
<span id="cb24-599"><a href="#cb24-599" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-600"><a href="#cb24-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-601"><a href="#cb24-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-604"><a href="#cb24-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-605"><a href="#cb24-605" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> process_job_listings()</span>
<span id="cb24-606"><a href="#cb24-606" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> results[<span class="st">'processed_data'</span>]</span>
<span id="cb24-607"><a href="#cb24-607" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Original count of listings: </span><span class="sc">{</span>results[<span class="st">"original_count"</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb24-608"><a href="#cb24-608" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Filtered count of listings: </span><span class="sc">{</span>results[<span class="st">"filtered_count"</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb24-609"><a href="#cb24-609" aria-hidden="true" tabindex="-1"></a>extract_jobs_from_dataframe(df)</span>
<span id="cb24-610"><a href="#cb24-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-611"><a href="#cb24-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-612"><a href="#cb24-612" aria-hidden="true" tabindex="-1"></a><span class="fu"># Classification</span></span>
<span id="cb24-613"><a href="#cb24-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-614"><a href="#cb24-614" aria-hidden="true" tabindex="-1"></a><span class="fu">## Classify jobs as relevant to GenAI/LLM work or not</span></span>
<span id="cb24-615"><a href="#cb24-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-618"><a href="#cb24-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-619"><a href="#cb24-619" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb24-620"><a href="#cb24-620" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold-show: false</span></span>
<span id="cb24-621"><a href="#cb24-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Click to view the code for job classification as GenAI/LLM relevant or not"</span></span>
<span id="cb24-622"><a href="#cb24-622" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nest_asyncio</span>
<span id="cb24-623"><a href="#cb24-623" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb24-624"><a href="#cb24-624" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb24-625"><a href="#cb24-625" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb24-626"><a href="#cb24-626" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Set</span>
<span id="cb24-627"><a href="#cb24-627" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb24-628"><a href="#cb24-628" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-629"><a href="#cb24-629" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tenacity <span class="im">import</span> retry, stop_after_attempt, wait_exponential, retry_if_exception_type</span>
<span id="cb24-630"><a href="#cb24-630" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> AsyncOpenAI</span>
<span id="cb24-631"><a href="#cb24-631" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb24-632"><a href="#cb24-632" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openai <span class="im">import</span> RateLimitError</span>
<span id="cb24-633"><a href="#cb24-633" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb24-634"><a href="#cb24-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-635"><a href="#cb24-635" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobClassifierGenAI:</span>
<span id="cb24-636"><a href="#cb24-636" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles classification of jobs for GenAI/LLM work"""</span></span>
<span id="cb24-637"><a href="#cb24-637" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-638"><a href="#cb24-638" aria-hidden="true" tabindex="-1"></a>    PROMPT <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb24-639"><a href="#cb24-639" aria-hidden="true" tabindex="-1"></a><span class="st">    You will be given a list of Responsibilities and</span></span>
<span id="cb24-640"><a href="#cb24-640" aria-hidden="true" tabindex="-1"></a><span class="st">    Skills listed for a job. Your task is to determine</span></span>
<span id="cb24-641"><a href="#cb24-641" aria-hidden="true" tabindex="-1"></a><span class="st">    if the job involves working with Generative AI (GenAI)</span></span>
<span id="cb24-642"><a href="#cb24-642" aria-hidden="true" tabindex="-1"></a><span class="st">    or language models (a.k.a. Large Language Models (LLMs)).</span></span>
<span id="cb24-643"><a href="#cb24-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-644"><a href="#cb24-644" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Job&gt;</span></span>
<span id="cb24-645"><a href="#cb24-645" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Responsibilities&gt;</span></span>
<span id="cb24-646"><a href="#cb24-646" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="sc">{responsibilities}</span></span>
<span id="cb24-647"><a href="#cb24-647" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Responsibilities&gt;</span></span>
<span id="cb24-648"><a href="#cb24-648" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Skills&gt;</span></span>
<span id="cb24-649"><a href="#cb24-649" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="sc">{skills}</span></span>
<span id="cb24-650"><a href="#cb24-650" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Skills&gt;</span></span>
<span id="cb24-651"><a href="#cb24-651" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Job&gt;</span></span>
<span id="cb24-652"><a href="#cb24-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-653"><a href="#cb24-653" aria-hidden="true" tabindex="-1"></a><span class="st">    Start by thinking step-by-step about the Job and its </span></span>
<span id="cb24-654"><a href="#cb24-654" aria-hidden="true" tabindex="-1"></a><span class="st">    Responsibilities and Skills, and whether it involves</span></span>
<span id="cb24-655"><a href="#cb24-655" aria-hidden="true" tabindex="-1"></a><span class="st">    working with Generative AI (GenAI) or language models</span></span>
<span id="cb24-656"><a href="#cb24-656" aria-hidden="true" tabindex="-1"></a><span class="st">    (a.k.a. Large Language Models (LLMs)).</span></span>
<span id="cb24-657"><a href="#cb24-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-658"><a href="#cb24-658" aria-hidden="true" tabindex="-1"></a><span class="st">    Return your response in the following format:</span></span>
<span id="cb24-659"><a href="#cb24-659" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;Analysis&gt;</span></span>
<span id="cb24-660"><a href="#cb24-660" aria-hidden="true" tabindex="-1"></a><span class="st">    [Your analysis of the job and its Responsibilities and Skills]</span></span>
<span id="cb24-661"><a href="#cb24-661" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/Analysis&gt;</span></span>
<span id="cb24-662"><a href="#cb24-662" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;FinalAnswer&gt;</span></span>
<span id="cb24-663"><a href="#cb24-663" aria-hidden="true" tabindex="-1"></a><span class="st">    true|false</span></span>
<span id="cb24-664"><a href="#cb24-664" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/FinalAnswer&gt;</span></span>
<span id="cb24-665"><a href="#cb24-665" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb24-666"><a href="#cb24-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-667"><a href="#cb24-667" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, output_dir<span class="op">=</span><span class="st">'role_genai_classifications'</span>, batch_size<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb24-668"><a href="#cb24-668" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir <span class="op">=</span> output_dir</span>
<span id="cb24-669"><a href="#cb24-669" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.batch_size <span class="op">=</span> batch_size</span>
<span id="cb24-670"><a href="#cb24-670" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.semaphore <span class="op">=</span> asyncio.Semaphore(batch_size)</span>
<span id="cb24-671"><a href="#cb24-671" aria-hidden="true" tabindex="-1"></a>        os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-672"><a href="#cb24-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-673"><a href="#cb24-673" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> classify_job(<span class="va">self</span>, job: Dict) <span class="op">-&gt;</span> Dict:</span>
<span id="cb24-674"><a href="#cb24-674" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Classify a single job listing"""</span></span>
<span id="cb24-675"><a href="#cb24-675" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Classifying job '</span><span class="sc">{</span>job[<span class="st">'filename'</span>]<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb24-676"><a href="#cb24-676" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-677"><a href="#cb24-677" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="va">self</span>.PROMPT.<span class="bu">format</span>(</span>
<span id="cb24-678"><a href="#cb24-678" aria-hidden="true" tabindex="-1"></a>            responsibilities<span class="op">=</span>job[<span class="st">'responsibilities'</span>],</span>
<span id="cb24-679"><a href="#cb24-679" aria-hidden="true" tabindex="-1"></a>            skills<span class="op">=</span>job.get(<span class="st">'skills'</span>, <span class="st">''</span>)</span>
<span id="cb24-680"><a href="#cb24-680" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-681"><a href="#cb24-681" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-682"><a href="#cb24-682" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb24-683"><a href="#cb24-683" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="cf">await</span> get_completion(prompt)</span>
<span id="cb24-684"><a href="#cb24-684" aria-hidden="true" tabindex="-1"></a>            <span class="cf">await</span> asyncio.sleep(<span class="dv">2</span>)  <span class="co"># Rate limiting</span></span>
<span id="cb24-685"><a href="#cb24-685" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-686"><a href="#cb24-686" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Failed to classify job '</span><span class="sc">{</span>job[<span class="st">'filename'</span>]<span class="sc">}</span><span class="ss">': </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-687"><a href="#cb24-687" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {</span>
<span id="cb24-688"><a href="#cb24-688" aria-hidden="true" tabindex="-1"></a>                <span class="op">**</span>job,</span>
<span id="cb24-689"><a href="#cb24-689" aria-hidden="true" tabindex="-1"></a>                <span class="st">'analysis'</span>: <span class="ss">f'Failed to process: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb24-690"><a href="#cb24-690" aria-hidden="true" tabindex="-1"></a>                <span class="st">'is_genai_role'</span>: <span class="va">None</span></span>
<span id="cb24-691"><a href="#cb24-691" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb24-692"><a href="#cb24-692" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-693"><a href="#cb24-693" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._parse_response(job, response)</span>
<span id="cb24-694"><a href="#cb24-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-695"><a href="#cb24-695" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse_response(<span class="va">self</span>, job: Dict, response: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb24-696"><a href="#cb24-696" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Parse LLM response into structured format"""</span></span>
<span id="cb24-697"><a href="#cb24-697" aria-hidden="true" tabindex="-1"></a>        soup <span class="op">=</span> BeautifulSoup(<span class="ss">f"&lt;root&gt;</span><span class="sc">{</span>response<span class="sc">}</span><span class="ss">&lt;/root&gt;"</span>, <span class="st">'lxml-xml'</span>)</span>
<span id="cb24-698"><a href="#cb24-698" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-699"><a href="#cb24-699" aria-hidden="true" tabindex="-1"></a>        analysis <span class="op">=</span> soup.find(<span class="st">'Analysis'</span>)</span>
<span id="cb24-700"><a href="#cb24-700" aria-hidden="true" tabindex="-1"></a>        final_answer <span class="op">=</span> soup.find(<span class="st">'FinalAnswer'</span>)</span>
<span id="cb24-701"><a href="#cb24-701" aria-hidden="true" tabindex="-1"></a>        is_genai_role <span class="op">=</span> <span class="va">None</span></span>
<span id="cb24-702"><a href="#cb24-702" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-703"><a href="#cb24-703" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> final_answer:</span>
<span id="cb24-704"><a href="#cb24-704" aria-hidden="true" tabindex="-1"></a>            answer_text <span class="op">=</span> final_answer.text.strip().lower()</span>
<span id="cb24-705"><a href="#cb24-705" aria-hidden="true" tabindex="-1"></a>            is_genai_role <span class="op">=</span> <span class="va">True</span> <span class="cf">if</span> answer_text <span class="op">==</span> <span class="st">'true'</span> <span class="cf">else</span> <span class="va">False</span> <span class="cf">if</span> answer_text <span class="op">==</span> <span class="st">'false'</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb24-706"><a href="#cb24-706" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-707"><a href="#cb24-707" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb24-708"><a href="#cb24-708" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>job,</span>
<span id="cb24-709"><a href="#cb24-709" aria-hidden="true" tabindex="-1"></a>            <span class="st">'analysis'</span>: analysis.text.strip() <span class="cf">if</span> analysis <span class="cf">else</span> <span class="st">''</span>,</span>
<span id="cb24-710"><a href="#cb24-710" aria-hidden="true" tabindex="-1"></a>            <span class="st">'is_genai_role'</span>: is_genai_role</span>
<span id="cb24-711"><a href="#cb24-711" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-712"><a href="#cb24-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-713"><a href="#cb24-713" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_classification(<span class="va">self</span>, job_id: <span class="bu">str</span>, result: Dict) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-714"><a href="#cb24-714" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Save classification results to file"""</span></span>
<span id="cb24-715"><a href="#cb24-715" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> os.path.join(<span class="va">self</span>.output_dir, <span class="ss">f"</span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">.json"</span>)</span>
<span id="cb24-716"><a href="#cb24-716" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb24-717"><a href="#cb24-717" aria-hidden="true" tabindex="-1"></a>            json.dump(result, f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb24-718"><a href="#cb24-718" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Saved classification for job </span><span class="sc">{</span>job_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-719"><a href="#cb24-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-720"><a href="#cb24-720" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_classified_jobs(<span class="va">self</span>) <span class="op">-&gt;</span> Set[<span class="bu">str</span>]:</span>
<span id="cb24-721"><a href="#cb24-721" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get set of already classified job IDs"""</span></span>
<span id="cb24-722"><a href="#cb24-722" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="va">self</span>.output_dir):</span>
<span id="cb24-723"><a href="#cb24-723" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">set</span>()</span>
<span id="cb24-724"><a href="#cb24-724" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {f[:<span class="op">-</span><span class="dv">5</span>] <span class="cf">for</span> f <span class="kw">in</span> os.listdir(<span class="va">self</span>.output_dir) <span class="cf">if</span> f.endswith(<span class="st">'.json'</span>)}</span>
<span id="cb24-725"><a href="#cb24-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-726"><a href="#cb24-726" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> process_jobs_batch(<span class="va">self</span>, jobs: List[Dict]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-727"><a href="#cb24-727" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process a batch of jobs concurrently"""</span></span>
<span id="cb24-728"><a href="#cb24-728" aria-hidden="true" tabindex="-1"></a>        <span class="cf">async</span> <span class="kw">def</span> process_with_semaphore(job: Dict) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-729"><a href="#cb24-729" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="cf">with</span> <span class="va">self</span>.semaphore:</span>
<span id="cb24-730"><a href="#cb24-730" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> <span class="cf">await</span> <span class="va">self</span>.classify_job(job)</span>
<span id="cb24-731"><a href="#cb24-731" aria-hidden="true" tabindex="-1"></a>                job_id <span class="op">=</span> <span class="bu">str</span>(result[<span class="st">'filename'</span>])</span>
<span id="cb24-732"><a href="#cb24-732" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.save_classification(job_id, result)</span>
<span id="cb24-733"><a href="#cb24-733" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-734"><a href="#cb24-734" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.gather(<span class="op">*</span>[process_with_semaphore(job) <span class="cf">for</span> job <span class="kw">in</span> jobs])</span>
<span id="cb24-735"><a href="#cb24-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-736"><a href="#cb24-736" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> classify_jobs_async(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-737"><a href="#cb24-737" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process all unclassified jobs in the DataFrame"""</span></span>
<span id="cb24-738"><a href="#cb24-738" aria-hidden="true" tabindex="-1"></a>        total_jobs <span class="op">=</span> <span class="bu">len</span>(df)</span>
<span id="cb24-739"><a href="#cb24-739" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Starting classification of </span><span class="sc">{</span>total_jobs<span class="sc">}</span><span class="ss"> jobs"</span>)</span>
<span id="cb24-740"><a href="#cb24-740" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-741"><a href="#cb24-741" aria-hidden="true" tabindex="-1"></a>        classified_jobs <span class="op">=</span> <span class="va">self</span>.get_classified_jobs()</span>
<span id="cb24-742"><a href="#cb24-742" aria-hidden="true" tabindex="-1"></a>        jobs_to_process <span class="op">=</span> [</span>
<span id="cb24-743"><a href="#cb24-743" aria-hidden="true" tabindex="-1"></a>            job.to_dict() <span class="cf">for</span> idx, job <span class="kw">in</span> df.iterrows() </span>
<span id="cb24-744"><a href="#cb24-744" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">str</span>(job[<span class="st">'filename'</span>]) <span class="kw">not</span> <span class="kw">in</span> classified_jobs</span>
<span id="cb24-745"><a href="#cb24-745" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb24-746"><a href="#cb24-746" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-747"><a href="#cb24-747" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="va">self</span>.process_jobs_batch(jobs_to_process)</span>
<span id="cb24-748"><a href="#cb24-748" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Completed classification of all </span><span class="sc">{</span>total_jobs<span class="sc">}</span><span class="ss"> jobs"</span>)</span>
<span id="cb24-749"><a href="#cb24-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-750"><a href="#cb24-750" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> classify_jobs(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-751"><a href="#cb24-751" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Main entry point for job classification"""</span></span>
<span id="cb24-752"><a href="#cb24-752" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df.empty:</span>
<span id="cb24-753"><a href="#cb24-753" aria-hidden="true" tabindex="-1"></a>            logging.warning(<span class="st">"Empty DataFrame provided"</span>)</span>
<span id="cb24-754"><a href="#cb24-754" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb24-755"><a href="#cb24-755" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-756"><a href="#cb24-756" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'filename'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb24-757"><a href="#cb24-757" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="st">"DataFrame missing required 'filename' column"</span>)</span>
<span id="cb24-758"><a href="#cb24-758" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb24-759"><a href="#cb24-759" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-760"><a href="#cb24-760" aria-hidden="true" tabindex="-1"></a>        classified_jobs <span class="op">=</span> <span class="va">self</span>.get_classified_jobs()</span>
<span id="cb24-761"><a href="#cb24-761" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(classified_jobs)<span class="sc">}</span><span class="ss"> previously classified jobs"</span>)</span>
<span id="cb24-762"><a href="#cb24-762" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-763"><a href="#cb24-763" aria-hidden="true" tabindex="-1"></a>        new_jobs <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">'filename'</span>].isin(classified_jobs)]</span>
<span id="cb24-764"><a href="#cb24-764" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> new_jobs.empty:</span>
<span id="cb24-765"><a href="#cb24-765" aria-hidden="true" tabindex="-1"></a>            logging.info(<span class="st">"No new jobs to classify"</span>)</span>
<span id="cb24-766"><a href="#cb24-766" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb24-767"><a href="#cb24-767" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-768"><a href="#cb24-768" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Processing </span><span class="sc">{</span><span class="bu">len</span>(new_jobs)<span class="sc">}</span><span class="ss"> new jobs"</span>)</span>
<span id="cb24-769"><a href="#cb24-769" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Skipping </span><span class="sc">{</span><span class="bu">len</span>(df) <span class="op">-</span> <span class="bu">len</span>(new_jobs)<span class="sc">}</span><span class="ss"> existing jobs"</span>)</span>
<span id="cb24-770"><a href="#cb24-770" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-771"><a href="#cb24-771" aria-hidden="true" tabindex="-1"></a>        loop <span class="op">=</span> asyncio.get_event_loop()</span>
<span id="cb24-772"><a href="#cb24-772" aria-hidden="true" tabindex="-1"></a>        loop.run_until_complete(<span class="va">self</span>.classify_jobs_async(new_jobs))</span>
<span id="cb24-773"><a href="#cb24-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-774"><a href="#cb24-774" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobDataLoader:</span>
<span id="cb24-775"><a href="#cb24-775" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles loading and preprocessing of job data"""</span></span>
<span id="cb24-776"><a href="#cb24-776" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-777"><a href="#cb24-777" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb24-778"><a href="#cb24-778" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> read_json_files(json_dir<span class="op">=</span><span class="st">'json_extracted_data'</span>) <span class="op">-&gt;</span> List[Dict]:</span>
<span id="cb24-779"><a href="#cb24-779" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Read job data from JSON files"""</span></span>
<span id="cb24-780"><a href="#cb24-780" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> []</span>
<span id="cb24-781"><a href="#cb24-781" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-782"><a href="#cb24-782" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(json_dir):</span>
<span id="cb24-783"><a href="#cb24-783" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> filename.endswith(<span class="st">'.json'</span>):</span>
<span id="cb24-784"><a href="#cb24-784" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> os.path.join(json_dir, filename)</span>
<span id="cb24-785"><a href="#cb24-785" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb24-786"><a href="#cb24-786" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb24-787"><a href="#cb24-787" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> json.load(f)</span>
<span id="cb24-788"><a href="#cb24-788" aria-hidden="true" tabindex="-1"></a>                        name <span class="op">=</span> filename[:<span class="op">-</span><span class="dv">5</span>]</span>
<span id="cb24-789"><a href="#cb24-789" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="st">'responsibilities'</span> <span class="kw">in</span> data <span class="kw">and</span> <span class="st">'skills'</span> <span class="kw">in</span> data:</span>
<span id="cb24-790"><a href="#cb24-790" aria-hidden="true" tabindex="-1"></a>                            result.append({</span>
<span id="cb24-791"><a href="#cb24-791" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'filename'</span>: name,</span>
<span id="cb24-792"><a href="#cb24-792" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'responsibilities'</span>: data[<span class="st">'responsibilities'</span>],</span>
<span id="cb24-793"><a href="#cb24-793" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'skills'</span>: data[<span class="st">'skills'</span>]</span>
<span id="cb24-794"><a href="#cb24-794" aria-hidden="true" tabindex="-1"></a>                            })</span>
<span id="cb24-795"><a href="#cb24-795" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb24-796"><a href="#cb24-796" aria-hidden="true" tabindex="-1"></a>                    logging.error(<span class="ss">f"Invalid JSON in </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-797"><a href="#cb24-797" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-798"><a href="#cb24-798" aria-hidden="true" tabindex="-1"></a>                    logging.error(<span class="ss">f"Error processing </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-799"><a href="#cb24-799" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-800"><a href="#cb24-800" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb24-801"><a href="#cb24-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-802"><a href="#cb24-802" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb24-803"><a href="#cb24-803" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_classifications(input_dir<span class="op">=</span><span class="st">'role_genai_classifications'</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-804"><a href="#cb24-804" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load classification results into DataFrame"""</span></span>
<span id="cb24-805"><a href="#cb24-805" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(input_dir):</span>
<span id="cb24-806"><a href="#cb24-806" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> pd.DataFrame()</span>
<span id="cb24-807"><a href="#cb24-807" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-808"><a href="#cb24-808" aria-hidden="true" tabindex="-1"></a>        all_results <span class="op">=</span> []</span>
<span id="cb24-809"><a href="#cb24-809" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(input_dir):</span>
<span id="cb24-810"><a href="#cb24-810" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> filename.endswith(<span class="st">'.json'</span>):</span>
<span id="cb24-811"><a href="#cb24-811" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(os.path.join(input_dir, filename), <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb24-812"><a href="#cb24-812" aria-hidden="true" tabindex="-1"></a>                    classification <span class="op">=</span> json.load(f)</span>
<span id="cb24-813"><a href="#cb24-813" aria-hidden="true" tabindex="-1"></a>                    all_results.append(classification)</span>
<span id="cb24-814"><a href="#cb24-814" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-815"><a href="#cb24-815" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame(all_results)</span>
<span id="cb24-816"><a href="#cb24-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-817"><a href="#cb24-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-818"><a href="#cb24-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-821"><a href="#cb24-821" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-822"><a href="#cb24-822" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> JobDataLoader()</span>
<span id="cb24-823"><a href="#cb24-823" aria-hidden="true" tabindex="-1"></a>jobs <span class="op">=</span> loader.read_json_files()</span>
<span id="cb24-824"><a href="#cb24-824" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(jobs)</span>
<span id="cb24-825"><a href="#cb24-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-826"><a href="#cb24-826" aria-hidden="true" tabindex="-1"></a><span class="co">#classifier = JobClassifierGenAI()</span></span>
<span id="cb24-827"><a href="#cb24-827" aria-hidden="true" tabindex="-1"></a><span class="co">#classifier.classify_jobs(df)</span></span>
<span id="cb24-828"><a href="#cb24-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-829"><a href="#cb24-829" aria-hidden="true" tabindex="-1"></a><span class="co"># Load results</span></span>
<span id="cb24-830"><a href="#cb24-830" aria-hidden="true" tabindex="-1"></a><span class="co">#results_df = loader.load_classifications()</span></span>
<span id="cb24-831"><a href="#cb24-831" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-832"><a href="#cb24-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-833"><a href="#cb24-833" aria-hidden="true" tabindex="-1"></a><span class="fu">## Classify GenAI/LLM jobs into pre-defined categories</span></span>
<span id="cb24-834"><a href="#cb24-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-835"><a href="#cb24-835" aria-hidden="true" tabindex="-1"></a>For this next classification task, I'll make the assumption that there are four types of AI engineering and science roles that are relevant to work with GenAI systems. These are:</span>
<span id="cb24-836"><a href="#cb24-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-837"><a href="#cb24-837" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>AI Research Scientist</span>
<span id="cb24-838"><a href="#cb24-838" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>AI/ML Engineer</span>
<span id="cb24-839"><a href="#cb24-839" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>MLOps / AI Infrastructure Engineer</span>
<span id="cb24-840"><a href="#cb24-840" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>AI Solution Architect</span>
<span id="cb24-841"><a href="#cb24-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-842"><a href="#cb24-842" aria-hidden="true" tabindex="-1"></a>I'll also include other categories that are not of interest, but may improve classification accuracy. These are:</span>
<span id="cb24-843"><a href="#cb24-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-844"><a href="#cb24-844" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Data Scientist</span>
<span id="cb24-845"><a href="#cb24-845" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Data Engineer</span>
<span id="cb24-846"><a href="#cb24-846" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Product Manager</span>
<span id="cb24-847"><a href="#cb24-847" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Software Engineer</span>
<span id="cb24-848"><a href="#cb24-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-849"><a href="#cb24-849" aria-hidden="true" tabindex="-1"></a>The code below implements an automated job classification system that uses an LLM to categorize job postings into the eight predefined roles listed above (four GenAI-focused and four related roles). It consists of several classes that work together: JobClassifier handles the core classification logic by comparing job descriptions against detailed role templates, JobData and ClassificationResult provide structured data containers, and JobProcessor manages the overall pipeline from loading jobs to saving results. The system processes jobs concurrently using asyncio, includes error handling and rate limiting, and outputs both an analysis explaining the classification and a final numerical category (0-8) for each job, with all results saved as JSON files for further analysis.</span>
<span id="cb24-850"><a href="#cb24-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-851"><a href="#cb24-851" aria-hidden="true" tabindex="-1"></a>Definitions of the roles can be found in the <span class="in">`JOB_DESCRIPTIONS`</span> variable.</span>
<span id="cb24-852"><a href="#cb24-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-855"><a href="#cb24-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-856"><a href="#cb24-856" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb24-857"><a href="#cb24-857" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold-show: false</span></span>
<span id="cb24-858"><a href="#cb24-858" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Click to view the code for job classification into pre-defined roles"</span></span>
<span id="cb24-859"><a href="#cb24-859" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="cb24-860"><a href="#cb24-860" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Set, Optional</span>
<span id="cb24-861"><a href="#cb24-861" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb24-862"><a href="#cb24-862" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb24-863"><a href="#cb24-863" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb24-864"><a href="#cb24-864" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb24-865"><a href="#cb24-865" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb24-866"><a href="#cb24-866" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-867"><a href="#cb24-867" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nest_asyncio</span>
<span id="cb24-868"><a href="#cb24-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-869"><a href="#cb24-869" aria-hidden="true" tabindex="-1"></a>JOB_DESCRIPTIONS <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb24-870"><a href="#cb24-870" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="AI Research Scientist" number="1"&gt;</span></span>
<span id="cb24-871"><a href="#cb24-871" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb24-872"><a href="#cb24-872" aria-hidden="true" tabindex="-1"></a><span class="st">    Investigate and adapt cutting-edge AI methodologies (e.g., generative models, advanced prompt engineering) for applications.</span></span>
<span id="cb24-873"><a href="#cb24-873" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb24-874"><a href="#cb24-874" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb24-875"><a href="#cb24-875" aria-hidden="true" tabindex="-1"></a><span class="st">    Conduct experiments to evaluate the performance (e.g., quality, accuracy) of new AI approaches and refine existing models.</span></span>
<span id="cb24-876"><a href="#cb24-876" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate with AI/ML Engineers to transition successful prototypes into production.</span></span>
<span id="cb24-877"><a href="#cb24-877" aria-hidden="true" tabindex="-1"></a><span class="st">    Stay current with the latest AI research and emerging trends in generative AI.</span></span>
<span id="cb24-878"><a href="#cb24-878" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop human-annotated datasets for training and evaluation of AI models.</span></span>
<span id="cb24-879"><a href="#cb24-879" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb24-880"><a href="#cb24-880" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb24-881"><a href="#cb24-881" aria-hidden="true" tabindex="-1"></a><span class="st">    Deep understanding of LLMs and prompt engineering.</span></span>
<span id="cb24-882"><a href="#cb24-882" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong background in statistics, optimization, or related fields.</span></span>
<span id="cb24-883"><a href="#cb24-883" aria-hidden="true" tabindex="-1"></a><span class="st">    Knowledge of experimental methods (e.g., A/B testing) and hypothesis testing.</span></span>
<span id="cb24-884"><a href="#cb24-884" aria-hidden="true" tabindex="-1"></a><span class="st">    Knowledge of LLM evaluation methods, including algorithmic evals, human evals, or LLM-as-a-judge evals.</span></span>
<span id="cb24-885"><a href="#cb24-885" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb24-886"><a href="#cb24-886" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb24-887"><a href="#cb24-887" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="AI/ML Engineer" number="2"&gt;</span></span>
<span id="cb24-888"><a href="#cb24-888" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb24-889"><a href="#cb24-889" aria-hidden="true" tabindex="-1"></a><span class="st">    Transform research output into robust, scalable AI solutions for the product or internal use.</span></span>
<span id="cb24-890"><a href="#cb24-890" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb24-891"><a href="#cb24-891" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb24-892"><a href="#cb24-892" aria-hidden="true" tabindex="-1"></a><span class="st">    Productionize AI models, ensuring they meet performance and reliability requirements.</span></span>
<span id="cb24-893"><a href="#cb24-893" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop and maintain data pipelines for model training, inference, and monitoring.</span></span>
<span id="cb24-894"><a href="#cb24-894" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate closely with Research Scientists to optimize and refine model implementations.</span></span>
<span id="cb24-895"><a href="#cb24-895" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb24-896"><a href="#cb24-896" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb24-897"><a href="#cb24-897" aria-hidden="true" tabindex="-1"></a><span class="st">    Proficiency in Python, Go, or similar languages.</span></span>
<span id="cb24-898"><a href="#cb24-898" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with API development and integration (REST, GraphQL).</span></span>
<span id="cb24-899"><a href="#cb24-899" aria-hidden="true" tabindex="-1"></a><span class="st">    Working knowledge of software engineering best practices (version control, testing, CI/CD).</span></span>
<span id="cb24-900"><a href="#cb24-900" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb24-901"><a href="#cb24-901" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb24-902"><a href="#cb24-902" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="MLOps / AI Infrastructure Engineer" number="3"&gt;</span></span>
<span id="cb24-903"><a href="#cb24-903" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb24-904"><a href="#cb24-904" aria-hidden="true" tabindex="-1"></a><span class="st">    Ensure reliable deployment, scaling, and monitoring of AI systems in production.</span></span>
<span id="cb24-905"><a href="#cb24-905" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb24-906"><a href="#cb24-906" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb24-907"><a href="#cb24-907" aria-hidden="true" tabindex="-1"></a><span class="st">    Set up CI/CD pipelines tailored for AI workflows, including model versioning and data governance.</span></span>
<span id="cb24-908"><a href="#cb24-908" aria-hidden="true" tabindex="-1"></a><span class="st">    Monitor production models for performance, latency, and data drift, implementing necessary updates.</span></span>
<span id="cb24-909"><a href="#cb24-909" aria-hidden="true" tabindex="-1"></a><span class="st">    Manage infrastructure for scalable AI deployments (Docker, Kubernetes, cloud services).</span></span>
<span id="cb24-910"><a href="#cb24-910" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb24-911"><a href="#cb24-911" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb24-912"><a href="#cb24-912" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong DevOps background, with tools like Docker, Kubernetes, and Terraform.</span></span>
<span id="cb24-913"><a href="#cb24-913" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with ML orchestration/monitoring tools (MLflow, Airflow, Prometheus).</span></span>
<span id="cb24-914"><a href="#cb24-914" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience optimizing compute usage (GPU/TPU) for cost-effective scaling.</span></span>
<span id="cb24-915"><a href="#cb24-915" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb24-916"><a href="#cb24-916" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb24-917"><a href="#cb24-917" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="AI Solution Architect" number="4"&gt;</span></span>
<span id="cb24-918"><a href="#cb24-918" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb24-919"><a href="#cb24-919" aria-hidden="true" tabindex="-1"></a><span class="st">    Design and orchestrate AI solutions leveraging generative models and LLM technologies to create impactful experiences and solutions that align with business objectives.</span></span>
<span id="cb24-920"><a href="#cb24-920" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb24-921"><a href="#cb24-921" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb24-922"><a href="#cb24-922" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate with subject matter experts (SMEs) to identify and refine opportunities for generative AI/LLM-based use cases.</span></span>
<span id="cb24-923"><a href="#cb24-923" aria-hidden="true" tabindex="-1"></a><span class="st">    Assess feasibility and define high-level solution architectures, ensuring they address core business and user requirements.</span></span>
<span id="cb24-924"><a href="#cb24-924" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop technical proposals and roadmaps, translating complex requirements into actionable plans.</span></span>
<span id="cb24-925"><a href="#cb24-925" aria-hidden="true" tabindex="-1"></a><span class="st">    Provide thought leadership on conversational design, user experience flow, and model interaction strategies.</span></span>
<span id="cb24-926"><a href="#cb24-926" aria-hidden="true" tabindex="-1"></a><span class="st">    Ensure solutions comply with relevant data governance, privacy, and security considerations.</span></span>
<span id="cb24-927"><a href="#cb24-927" aria-hidden="true" tabindex="-1"></a><span class="st">    Facilitate cross-functional collaboration, guiding teams through solution conceptualization and implementation phases.</span></span>
<span id="cb24-928"><a href="#cb24-928" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb24-929"><a href="#cb24-929" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb24-930"><a href="#cb24-930" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong understanding of LLM capabilities and prompt engineering principles.</span></span>
<span id="cb24-931"><a href="#cb24-931" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with conversational experience design (e.g., chatbots, voice interfaces) and user journey mapping.</span></span>
<span id="cb24-932"><a href="#cb24-932" aria-hidden="true" tabindex="-1"></a><span class="st">    Ability to analyze business needs and translate them into feasible AI solution proposals.</span></span>
<span id="cb24-933"><a href="#cb24-933" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with data privacy and security best practices, especially as they pertain to AI solutions.</span></span>
<span id="cb24-934"><a href="#cb24-934" aria-hidden="true" tabindex="-1"></a><span class="st">    Excellent communication and stakeholder management skills to align technical and non-technical teams.</span></span>
<span id="cb24-935"><a href="#cb24-935" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb24-936"><a href="#cb24-936" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb24-937"><a href="#cb24-937" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="Data Scientist" number="5"&gt; </span></span>
<span id="cb24-938"><a href="#cb24-938" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb24-939"><a href="#cb24-939" aria-hidden="true" tabindex="-1"></a><span class="st">    Leverage statistical analysis, machine learning, and data visualization to derive actionable insights and guide data-informed decisions.</span></span>
<span id="cb24-940"><a href="#cb24-940" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt; </span></span>
<span id="cb24-941"><a href="#cb24-941" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt; </span></span>
<span id="cb24-942"><a href="#cb24-942" aria-hidden="true" tabindex="-1"></a><span class="st">    Perform exploratory data analysis (EDA) to identify trends and patterns in large, complex datasets. </span></span>
<span id="cb24-943"><a href="#cb24-943" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop and validate predictive and prescriptive models, collaborating with cross-functional teams to implement these solutions. </span></span>
<span id="cb24-944"><a href="#cb24-944" aria-hidden="true" tabindex="-1"></a><span class="st">    Design and execute experiments to test hypotheses, measure impact, and inform business strategies. </span></span>
<span id="cb24-945"><a href="#cb24-945" aria-hidden="true" tabindex="-1"></a><span class="st">    Present findings and recommendations to stakeholders in a clear, concise manner using visualizations and dashboards. </span></span>
<span id="cb24-946"><a href="#cb24-946" aria-hidden="true" tabindex="-1"></a><span class="st">    Work with data engineers to ensure data quality, governance, and availability. </span></span>
<span id="cb24-947"><a href="#cb24-947" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt; </span></span>
<span id="cb24-948"><a href="#cb24-948" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt; </span></span>
<span id="cb24-949"><a href="#cb24-949" aria-hidden="true" tabindex="-1"></a><span class="st">    Proficiency in Python, R, or SQL for data manipulation and analysis. </span></span>
<span id="cb24-950"><a href="#cb24-950" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with common ML libraries (e.g., scikit-learn, XGBoost) and deep learning frameworks (e.g., PyTorch, TensorFlow). </span></span>
<span id="cb24-951"><a href="#cb24-951" aria-hidden="true" tabindex="-1"></a><span class="st">    Solid grounding in statistics, probability, and experimental design. </span></span>
<span id="cb24-952"><a href="#cb24-952" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with data visualization tools (e.g., Tableau, Power BI) for communicating insights. </span></span>
<span id="cb24-953"><a href="#cb24-953" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong analytical thinking and ability to translate complex data problems into business solutions. </span></span>
<span id="cb24-954"><a href="#cb24-954" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt; </span></span>
<span id="cb24-955"><a href="#cb24-955" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb24-956"><a href="#cb24-956" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="Data Engineer" number="6"&gt;</span></span>
<span id="cb24-957"><a href="#cb24-957" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb24-958"><a href="#cb24-958" aria-hidden="true" tabindex="-1"></a><span class="st">    Design, build, and maintain scalable data pipelines and architectures that enable efficient data collection, storage, and analysis.</span></span>
<span id="cb24-959"><a href="#cb24-959" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb24-960"><a href="#cb24-960" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb24-961"><a href="#cb24-961" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop and optimize data ingestion and transformation processes (ETL/ELT), ensuring high performance and reliability.</span></span>
<span id="cb24-962"><a href="#cb24-962" aria-hidden="true" tabindex="-1"></a><span class="st">    Implement and manage data workflows, integrating internal and external data sources.</span></span>
<span id="cb24-963"><a href="#cb24-963" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate with Data Scientists, AI/ML Engineers, and other stakeholders to ensure data readiness for analytics and model training.</span></span>
<span id="cb24-964"><a href="#cb24-964" aria-hidden="true" tabindex="-1"></a><span class="st">    Monitor data pipelines for performance, reliability, and cost-effectiveness, taking corrective actions when needed.</span></span>
<span id="cb24-965"><a href="#cb24-965" aria-hidden="true" tabindex="-1"></a><span class="st">    Maintain data quality and governance standards, including metadata management and data cataloging.</span></span>
<span id="cb24-966"><a href="#cb24-966" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb24-967"><a href="#cb24-967" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb24-968"><a href="#cb24-968" aria-hidden="true" tabindex="-1"></a><span class="st">    Proficiency in Python, SQL, and distributed data processing frameworks (e.g., Spark, Kafka).</span></span>
<span id="cb24-969"><a href="#cb24-969" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with cloud-based data ecosystems (AWS, GCP, or Azure), and related storage/processing services (e.g., S3, BigQuery, Dataflow).</span></span>
<span id="cb24-970"><a href="#cb24-970" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with infrastructure-as-code and DevOps tools (Terraform, Docker, Kubernetes) for automating data platform deployments.</span></span>
<span id="cb24-971"><a href="#cb24-971" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong understanding of database systems (relational, NoSQL) and data modeling principles.</span></span>
<span id="cb24-972"><a href="#cb24-972" aria-hidden="true" tabindex="-1"></a><span class="st">    Knowledge of data orchestration and workflow management tools (Airflow, Luigi, Dagster).</span></span>
<span id="cb24-973"><a href="#cb24-973" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb24-974"><a href="#cb24-974" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb24-975"><a href="#cb24-975" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="Product Manager" number="7"&gt;</span></span>
<span id="cb24-976"><a href="#cb24-976" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb24-977"><a href="#cb24-977" aria-hidden="true" tabindex="-1"></a><span class="st">    Drive the product vision and strategy, ensuring alignment with business goals and user needs while delivering impactful AI-driven solutions.</span></span>
<span id="cb24-978"><a href="#cb24-978" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb24-979"><a href="#cb24-979" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb24-980"><a href="#cb24-980" aria-hidden="true" tabindex="-1"></a><span class="st">    Conduct user and market research to identify opportunities, define product requirements, and set success metrics.</span></span>
<span id="cb24-981"><a href="#cb24-981" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate with cross-functional teams (Engineering, Data Science, Design) to prioritize features and plan releases.</span></span>
<span id="cb24-982"><a href="#cb24-982" aria-hidden="true" tabindex="-1"></a><span class="st">    Develop and communicate product roadmaps, ensuring stakeholders are aligned on goals and timelines.</span></span>
<span id="cb24-983"><a href="#cb24-983" aria-hidden="true" tabindex="-1"></a><span class="st">    Monitor product performance through data analysis and user feedback, iterating on improvements and new feature ideas.</span></span>
<span id="cb24-984"><a href="#cb24-984" aria-hidden="true" tabindex="-1"></a><span class="st">    Facilitate agile development practices, writing clear user stories and acceptance criteria.</span></span>
<span id="cb24-985"><a href="#cb24-985" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb24-986"><a href="#cb24-986" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb24-987"><a href="#cb24-987" aria-hidden="true" tabindex="-1"></a><span class="st">    Strong understanding of product lifecycle management and agile methodologies (Scrum/Kanban).</span></span>
<span id="cb24-988"><a href="#cb24-988" aria-hidden="true" tabindex="-1"></a><span class="st">    Excellent communication, negotiation, and stakeholder management skills.</span></span>
<span id="cb24-989"><a href="#cb24-989" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with product management and collaboration tools (e.g., Jira, Confluence, Trello).</span></span>
<span id="cb24-990"><a href="#cb24-990" aria-hidden="true" tabindex="-1"></a><span class="st">    Analytical mindset for leveraging metrics, A/B testing, and user feedback in decision-making.</span></span>
<span id="cb24-991"><a href="#cb24-991" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with AI/ML concepts and the ability to translate technical possibilities into viable product features.</span></span>
<span id="cb24-992"><a href="#cb24-992" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb24-993"><a href="#cb24-993" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb24-994"><a href="#cb24-994" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Option title="Software Engineer" number="8"&gt;</span></span>
<span id="cb24-995"><a href="#cb24-995" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;PrimaryFocus&gt;</span></span>
<span id="cb24-996"><a href="#cb24-996" aria-hidden="true" tabindex="-1"></a><span class="st">  Design, develop, and maintain high-quality software applications and services that address user needs and align with overall business objectives.</span></span>
<span id="cb24-997"><a href="#cb24-997" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/PrimaryFocus&gt;</span></span>
<span id="cb24-998"><a href="#cb24-998" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;KeyResponsibilities&gt;</span></span>
<span id="cb24-999"><a href="#cb24-999" aria-hidden="true" tabindex="-1"></a><span class="st">    Collaborate with cross-functional teams (Product, Design, QA) to interpret requirements and deliver robust solutions.</span></span>
<span id="cb24-1000"><a href="#cb24-1000" aria-hidden="true" tabindex="-1"></a><span class="st">    Write clean, efficient, and testable code following best practices and coding standards.</span></span>
<span id="cb24-1001"><a href="#cb24-1001" aria-hidden="true" tabindex="-1"></a><span class="st">    Participate in system architecture and design discussions, contributing to the evolution of technical roadmaps.</span></span>
<span id="cb24-1002"><a href="#cb24-1002" aria-hidden="true" tabindex="-1"></a><span class="st">    Perform code reviews and provide constructive feedback to peers, maintaining a high bar for code quality.</span></span>
<span id="cb24-1003"><a href="#cb24-1003" aria-hidden="true" tabindex="-1"></a><span class="st">    Implement and maintain CI/CD pipelines to streamline deployment and reduce manual interventions.</span></span>
<span id="cb24-1004"><a href="#cb24-1004" aria-hidden="true" tabindex="-1"></a><span class="st">    Continuously improve system performance and scalability through profiling and optimization.</span></span>
<span id="cb24-1005"><a href="#cb24-1005" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/KeyResponsibilities&gt;</span></span>
<span id="cb24-1006"><a href="#cb24-1006" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;SkillsAndTools&gt;</span></span>
<span id="cb24-1007"><a href="#cb24-1007" aria-hidden="true" tabindex="-1"></a><span class="st">    Proficiency in one or more programming languages (e.g., Java, Python, JavaScript, C++).</span></span>
<span id="cb24-1008"><a href="#cb24-1008" aria-hidden="true" tabindex="-1"></a><span class="st">    Experience with modern frameworks/libraries (e.g., Spring Boot, Node.js, React, Django).</span></span>
<span id="cb24-1009"><a href="#cb24-1009" aria-hidden="true" tabindex="-1"></a><span class="st">    Solid understanding of software design principles (e.g., SOLID, DRY) and architectural patterns (e.g., microservices).</span></span>
<span id="cb24-1010"><a href="#cb24-1010" aria-hidden="true" tabindex="-1"></a><span class="st">    Familiarity with version control systems (Git), testing frameworks, and agile methodologies.</span></span>
<span id="cb24-1011"><a href="#cb24-1011" aria-hidden="true" tabindex="-1"></a><span class="st">    Working knowledge of containerization (Docker), orchestration (Kubernetes), and cloud platforms (AWS, Azure, GCP).</span></span>
<span id="cb24-1012"><a href="#cb24-1012" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/SkillsAndTools&gt;</span></span>
<span id="cb24-1013"><a href="#cb24-1013" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Option&gt;</span></span>
<span id="cb24-1014"><a href="#cb24-1014" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb24-1015"><a href="#cb24-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1016"><a href="#cb24-1016" aria-hidden="true" tabindex="-1"></a>PROMPTS <span class="op">=</span> {</span>
<span id="cb24-1017"><a href="#cb24-1017" aria-hidden="true" tabindex="-1"></a><span class="st">"prompt"</span>: <span class="st">"""</span></span>
<span id="cb24-1018"><a href="#cb24-1018" aria-hidden="true" tabindex="-1"></a><span class="st">You will be given a list of Responsibilities and</span></span>
<span id="cb24-1019"><a href="#cb24-1019" aria-hidden="true" tabindex="-1"></a><span class="st">Skills listed for a job. Your task is to determine</span></span>
<span id="cb24-1020"><a href="#cb24-1020" aria-hidden="true" tabindex="-1"></a><span class="st">if the job is a good fit with any of the Options,</span></span>
<span id="cb24-1021"><a href="#cb24-1021" aria-hidden="true" tabindex="-1"></a><span class="st">and if so, which one.</span></span>
<span id="cb24-1022"><a href="#cb24-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1023"><a href="#cb24-1023" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Job&gt;</span></span>
<span id="cb24-1024"><a href="#cb24-1024" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Responsibilities&gt;</span></span>
<span id="cb24-1025"><a href="#cb24-1025" aria-hidden="true" tabindex="-1"></a><span class="sc">{responsibilities}</span></span>
<span id="cb24-1026"><a href="#cb24-1026" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Responsibilities&gt;</span></span>
<span id="cb24-1027"><a href="#cb24-1027" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Skills&gt;</span></span>
<span id="cb24-1028"><a href="#cb24-1028" aria-hidden="true" tabindex="-1"></a><span class="sc">{skills}</span></span>
<span id="cb24-1029"><a href="#cb24-1029" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Skills&gt;</span></span>
<span id="cb24-1030"><a href="#cb24-1030" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Job&gt;</span></span>
<span id="cb24-1031"><a href="#cb24-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1032"><a href="#cb24-1032" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Options&gt;</span></span>
<span id="cb24-1033"><a href="#cb24-1033" aria-hidden="true" tabindex="-1"></a><span class="sc">{Options}</span></span>
<span id="cb24-1034"><a href="#cb24-1034" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Options&gt;</span></span>
<span id="cb24-1035"><a href="#cb24-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1036"><a href="#cb24-1036" aria-hidden="true" tabindex="-1"></a><span class="st">Start by thinking step-by-step about the Job and its </span></span>
<span id="cb24-1037"><a href="#cb24-1037" aria-hidden="true" tabindex="-1"></a><span class="st">Responsibilities and Skills, in relation to each of the </span></span>
<span id="cb24-1038"><a href="#cb24-1038" aria-hidden="true" tabindex="-1"></a><span class="st">Options.</span></span>
<span id="cb24-1039"><a href="#cb24-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1040"><a href="#cb24-1040" aria-hidden="true" tabindex="-1"></a><span class="st">Decide if the Job is a good fit with ANY of the Options.</span></span>
<span id="cb24-1041"><a href="#cb24-1041" aria-hidden="true" tabindex="-1"></a><span class="st">If NONE of the Options are relevant to the Job, say so and </span></span>
<span id="cb24-1042"><a href="#cb24-1042" aria-hidden="true" tabindex="-1"></a><span class="st">return a 0 as your FinalAnswer.</span></span>
<span id="cb24-1043"><a href="#cb24-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1044"><a href="#cb24-1044" aria-hidden="true" tabindex="-1"></a><span class="st">Otherwise, decide which of the Options is the most similar</span></span>
<span id="cb24-1045"><a href="#cb24-1045" aria-hidden="true" tabindex="-1"></a><span class="st">to the Job and return its number as your FinalAnswer.</span></span>
<span id="cb24-1046"><a href="#cb24-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1047"><a href="#cb24-1047" aria-hidden="true" tabindex="-1"></a><span class="st">Return your response in the following format:</span></span>
<span id="cb24-1048"><a href="#cb24-1048" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;Analysis&gt;</span></span>
<span id="cb24-1049"><a href="#cb24-1049" aria-hidden="true" tabindex="-1"></a><span class="st">[Your analysis of the job and its Responsibilities and Skills, in relation each of the Options]</span></span>
<span id="cb24-1050"><a href="#cb24-1050" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/Analysis&gt;</span></span>
<span id="cb24-1051"><a href="#cb24-1051" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;FinalAnswer&gt;</span></span>
<span id="cb24-1052"><a href="#cb24-1052" aria-hidden="true" tabindex="-1"></a><span class="st">0|1|2|3|4|5|6|7|8</span></span>
<span id="cb24-1053"><a href="#cb24-1053" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/FinalAnswer&gt;</span></span>
<span id="cb24-1054"><a href="#cb24-1054" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb24-1055"><a href="#cb24-1055" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-1056"><a href="#cb24-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1057"><a href="#cb24-1057" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable nested event loops</span></span>
<span id="cb24-1058"><a href="#cb24-1058" aria-hidden="true" tabindex="-1"></a>nest_asyncio.<span class="bu">apply</span>()</span>
<span id="cb24-1059"><a href="#cb24-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1060"><a href="#cb24-1060" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb24-1061"><a href="#cb24-1061" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobData:</span>
<span id="cb24-1062"><a href="#cb24-1062" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Represents a job posting with extracted information."""</span></span>
<span id="cb24-1063"><a href="#cb24-1063" aria-hidden="true" tabindex="-1"></a>    filename: <span class="bu">str</span></span>
<span id="cb24-1064"><a href="#cb24-1064" aria-hidden="true" tabindex="-1"></a>    responsibilities: List[<span class="bu">str</span>]</span>
<span id="cb24-1065"><a href="#cb24-1065" aria-hidden="true" tabindex="-1"></a>    skills: List[<span class="bu">str</span>]</span>
<span id="cb24-1066"><a href="#cb24-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1067"><a href="#cb24-1067" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb24-1068"><a href="#cb24-1068" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ClassificationResult:</span>
<span id="cb24-1069"><a href="#cb24-1069" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Represents the result of a job classification."""</span></span>
<span id="cb24-1070"><a href="#cb24-1070" aria-hidden="true" tabindex="-1"></a>    filename: <span class="bu">str</span></span>
<span id="cb24-1071"><a href="#cb24-1071" aria-hidden="true" tabindex="-1"></a>    responsibilities: List[<span class="bu">str</span>]</span>
<span id="cb24-1072"><a href="#cb24-1072" aria-hidden="true" tabindex="-1"></a>    skills: List[<span class="bu">str</span>]</span>
<span id="cb24-1073"><a href="#cb24-1073" aria-hidden="true" tabindex="-1"></a>    analysis: <span class="bu">str</span></span>
<span id="cb24-1074"><a href="#cb24-1074" aria-hidden="true" tabindex="-1"></a>    role_classification: Optional[<span class="bu">int</span>]</span>
<span id="cb24-1075"><a href="#cb24-1075" aria-hidden="true" tabindex="-1"></a>    role_title: Optional[<span class="bu">str</span>]</span>
<span id="cb24-1076"><a href="#cb24-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1077"><a href="#cb24-1077" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobClassifier:</span>
<span id="cb24-1078"><a href="#cb24-1078" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles classification of jobs into predefined roles."""</span></span>
<span id="cb24-1079"><a href="#cb24-1079" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1080"><a href="#cb24-1080" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'role_classifications'</span>, batch_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span>):</span>
<span id="cb24-1081"><a href="#cb24-1081" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir <span class="op">=</span> output_dir</span>
<span id="cb24-1082"><a href="#cb24-1082" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.batch_size <span class="op">=</span> batch_size</span>
<span id="cb24-1083"><a href="#cb24-1083" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.semaphore <span class="op">=</span> asyncio.Semaphore(batch_size)</span>
<span id="cb24-1084"><a href="#cb24-1084" aria-hidden="true" tabindex="-1"></a>        os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-1085"><a href="#cb24-1085" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1086"><a href="#cb24-1086" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> classify_job(<span class="va">self</span>, job: JobData) <span class="op">-&gt;</span> ClassificationResult:</span>
<span id="cb24-1087"><a href="#cb24-1087" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Classify a single job listing."""</span></span>
<span id="cb24-1088"><a href="#cb24-1088" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Classifying job '</span><span class="sc">{</span>job<span class="sc">.</span>filename<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb24-1089"><a href="#cb24-1089" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1090"><a href="#cb24-1090" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> PROMPTS[<span class="st">"prompt"</span>].<span class="bu">format</span>(</span>
<span id="cb24-1091"><a href="#cb24-1091" aria-hidden="true" tabindex="-1"></a>            responsibilities<span class="op">=</span>job.responsibilities,  <span class="co"># Access as attribute instead of dict</span></span>
<span id="cb24-1092"><a href="#cb24-1092" aria-hidden="true" tabindex="-1"></a>            skills<span class="op">=</span>job.skills,  <span class="co"># Access as attribute instead of dict</span></span>
<span id="cb24-1093"><a href="#cb24-1093" aria-hidden="true" tabindex="-1"></a>            Options<span class="op">=</span>JOB_DESCRIPTIONS</span>
<span id="cb24-1094"><a href="#cb24-1094" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-1095"><a href="#cb24-1095" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1096"><a href="#cb24-1096" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb24-1097"><a href="#cb24-1097" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="cf">await</span> get_completion(prompt)</span>
<span id="cb24-1098"><a href="#cb24-1098" aria-hidden="true" tabindex="-1"></a>            <span class="cf">await</span> asyncio.sleep(<span class="dv">5</span>)  <span class="co"># Rate limiting</span></span>
<span id="cb24-1099"><a href="#cb24-1099" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._parse_response(job, response)</span>
<span id="cb24-1100"><a href="#cb24-1100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-1101"><a href="#cb24-1101" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Failed to classify job '</span><span class="sc">{</span>job<span class="sc">.</span>filename<span class="sc">}</span><span class="ss">': </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1102"><a href="#cb24-1102" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> ClassificationResult(</span>
<span id="cb24-1103"><a href="#cb24-1103" aria-hidden="true" tabindex="-1"></a>                filename<span class="op">=</span>job.filename,</span>
<span id="cb24-1104"><a href="#cb24-1104" aria-hidden="true" tabindex="-1"></a>                responsibilities<span class="op">=</span>job.responsibilities,</span>
<span id="cb24-1105"><a href="#cb24-1105" aria-hidden="true" tabindex="-1"></a>                skills<span class="op">=</span>job.skills,</span>
<span id="cb24-1106"><a href="#cb24-1106" aria-hidden="true" tabindex="-1"></a>                analysis<span class="op">=</span><span class="ss">f'Failed to process: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb24-1107"><a href="#cb24-1107" aria-hidden="true" tabindex="-1"></a>                role_classification<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb24-1108"><a href="#cb24-1108" aria-hidden="true" tabindex="-1"></a>                role_title<span class="op">=</span><span class="va">None</span></span>
<span id="cb24-1109"><a href="#cb24-1109" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-1110"><a href="#cb24-1110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1111"><a href="#cb24-1111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _parse_response(<span class="va">self</span>, job: JobData, response: <span class="bu">str</span>) <span class="op">-&gt;</span> ClassificationResult:</span>
<span id="cb24-1112"><a href="#cb24-1112" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Parse LLM response into structured format."""</span></span>
<span id="cb24-1113"><a href="#cb24-1113" aria-hidden="true" tabindex="-1"></a>        soup <span class="op">=</span> BeautifulSoup(<span class="ss">f"&lt;root&gt;</span><span class="sc">{</span>response<span class="sc">}</span><span class="ss">&lt;/root&gt;"</span>, <span class="st">'lxml-xml'</span>)</span>
<span id="cb24-1114"><a href="#cb24-1114" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1115"><a href="#cb24-1115" aria-hidden="true" tabindex="-1"></a>        analysis <span class="op">=</span> soup.find(<span class="st">'Analysis'</span>)</span>
<span id="cb24-1116"><a href="#cb24-1116" aria-hidden="true" tabindex="-1"></a>        role_choice <span class="op">=</span> soup.find(<span class="st">'FinalAnswer'</span>)</span>
<span id="cb24-1117"><a href="#cb24-1117" aria-hidden="true" tabindex="-1"></a>        role_number <span class="op">=</span> <span class="bu">int</span>(role_choice.text.strip()) <span class="cf">if</span> role_choice <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb24-1118"><a href="#cb24-1118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1119"><a href="#cb24-1119" aria-hidden="true" tabindex="-1"></a>        role_title <span class="op">=</span> <span class="va">self</span>._get_role_title(role_number)</span>
<span id="cb24-1120"><a href="#cb24-1120" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1121"><a href="#cb24-1121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ClassificationResult(</span>
<span id="cb24-1122"><a href="#cb24-1122" aria-hidden="true" tabindex="-1"></a>            filename<span class="op">=</span>job.filename,</span>
<span id="cb24-1123"><a href="#cb24-1123" aria-hidden="true" tabindex="-1"></a>            responsibilities<span class="op">=</span>job.responsibilities,</span>
<span id="cb24-1124"><a href="#cb24-1124" aria-hidden="true" tabindex="-1"></a>            skills<span class="op">=</span>job.skills,</span>
<span id="cb24-1125"><a href="#cb24-1125" aria-hidden="true" tabindex="-1"></a>            analysis<span class="op">=</span>analysis.text.strip() <span class="cf">if</span> analysis <span class="cf">else</span> <span class="st">''</span>,</span>
<span id="cb24-1126"><a href="#cb24-1126" aria-hidden="true" tabindex="-1"></a>            role_classification<span class="op">=</span>role_number,</span>
<span id="cb24-1127"><a href="#cb24-1127" aria-hidden="true" tabindex="-1"></a>            role_title<span class="op">=</span>role_title</span>
<span id="cb24-1128"><a href="#cb24-1128" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-1129"><a href="#cb24-1129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1130"><a href="#cb24-1130" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_role_title(<span class="va">self</span>, role_number: Optional[<span class="bu">int</span>]) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb24-1131"><a href="#cb24-1131" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get the title for a role number."""</span></span>
<span id="cb24-1132"><a href="#cb24-1132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> role_number <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb24-1133"><a href="#cb24-1133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb24-1134"><a href="#cb24-1134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> role_number <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb24-1135"><a href="#cb24-1135" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"Other"</span></span>
<span id="cb24-1136"><a href="#cb24-1136" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1137"><a href="#cb24-1137" aria-hidden="true" tabindex="-1"></a>        wrapped_xml <span class="op">=</span> <span class="ss">f"&lt;root&gt;</span><span class="sc">{</span>JOB_DESCRIPTIONS<span class="sc">}</span><span class="ss">&lt;/root&gt;"</span></span>
<span id="cb24-1138"><a href="#cb24-1138" aria-hidden="true" tabindex="-1"></a>        job_descriptions_soup <span class="op">=</span> BeautifulSoup(wrapped_xml, <span class="st">'lxml-xml'</span>)</span>
<span id="cb24-1139"><a href="#cb24-1139" aria-hidden="true" tabindex="-1"></a>        matching_job <span class="op">=</span> job_descriptions_soup.find(<span class="st">'Option'</span>, {<span class="st">'number'</span>: <span class="bu">str</span>(role_number)})</span>
<span id="cb24-1140"><a href="#cb24-1140" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1141"><a href="#cb24-1141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> matching_job:</span>
<span id="cb24-1142"><a href="#cb24-1142" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> matching_job[<span class="st">'title'</span>]</span>
<span id="cb24-1143"><a href="#cb24-1143" aria-hidden="true" tabindex="-1"></a>        logging.error(<span class="ss">f"No matching job found for role number </span><span class="sc">{</span>role_number<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1144"><a href="#cb24-1144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb24-1145"><a href="#cb24-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1146"><a href="#cb24-1146" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> JobProcessor:</span>
<span id="cb24-1147"><a href="#cb24-1147" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles the processing of job data files."""</span></span>
<span id="cb24-1148"><a href="#cb24-1148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1149"><a href="#cb24-1149" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'json_extracted_data'</span>):</span>
<span id="cb24-1150"><a href="#cb24-1150" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_dir <span class="op">=</span> input_dir</span>
<span id="cb24-1151"><a href="#cb24-1151" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.classifier <span class="op">=</span> JobClassifier()</span>
<span id="cb24-1152"><a href="#cb24-1152" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1153"><a href="#cb24-1153" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_jobs(<span class="va">self</span>) <span class="op">-&gt;</span> List[JobData]:</span>
<span id="cb24-1154"><a href="#cb24-1154" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load jobs from JSON files."""</span></span>
<span id="cb24-1155"><a href="#cb24-1155" aria-hidden="true" tabindex="-1"></a>        jobs <span class="op">=</span> []</span>
<span id="cb24-1156"><a href="#cb24-1156" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get list of all JSON files</span></span>
<span id="cb24-1157"><a href="#cb24-1157" aria-hidden="true" tabindex="-1"></a>        total_files <span class="op">=</span> <span class="bu">len</span>([f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(<span class="va">self</span>.input_dir) <span class="cf">if</span> f.endswith(<span class="st">'.json'</span>)])</span>
<span id="cb24-1158"><a href="#cb24-1158" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get files that were classified as GenAI-relevant</span></span>
<span id="cb24-1159"><a href="#cb24-1159" aria-hidden="true" tabindex="-1"></a>        classified_files <span class="op">=</span> <span class="va">self</span>._get_classified_files()</span>
<span id="cb24-1160"><a href="#cb24-1160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get files that have already been processed</span></span>
<span id="cb24-1161"><a href="#cb24-1161" aria-hidden="true" tabindex="-1"></a>        processed_files <span class="op">=</span> {</span>
<span id="cb24-1162"><a href="#cb24-1162" aria-hidden="true" tabindex="-1"></a>            f[:<span class="op">-</span><span class="dv">5</span>] <span class="cf">for</span> f <span class="kw">in</span> os.listdir(<span class="va">self</span>.classifier.output_dir) </span>
<span id="cb24-1163"><a href="#cb24-1163" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> f.endswith(<span class="st">'.json'</span>)</span>
<span id="cb24-1164"><a href="#cb24-1164" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-1165"><a href="#cb24-1165" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get relevant files that haven't been processed yet</span></span>
<span id="cb24-1166"><a href="#cb24-1166" aria-hidden="true" tabindex="-1"></a>        files_to_process <span class="op">=</span> classified_files <span class="op">-</span> processed_files</span>
<span id="cb24-1167"><a href="#cb24-1167" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1168"><a href="#cb24-1168" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Found </span><span class="sc">{</span>total_files<span class="sc">}</span><span class="ss"> total files"</span>)</span>
<span id="cb24-1169"><a href="#cb24-1169" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(classified_files)<span class="sc">}</span><span class="ss"> relevant GenAI files"</span>)</span>
<span id="cb24-1170"><a href="#cb24-1170" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Already processed: </span><span class="sc">{</span><span class="bu">len</span>(processed_files)<span class="sc">}</span><span class="ss"> files"</span>)</span>
<span id="cb24-1171"><a href="#cb24-1171" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Remaining to process: </span><span class="sc">{</span><span class="bu">len</span>(files_to_process)<span class="sc">}</span><span class="ss"> files"</span>)</span>
<span id="cb24-1172"><a href="#cb24-1172" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1173"><a href="#cb24-1173" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Only process files that are both relevant and unprocessed</span></span>
<span id="cb24-1174"><a href="#cb24-1174" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(<span class="va">self</span>.input_dir):</span>
<span id="cb24-1175"><a href="#cb24-1175" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> filename.endswith(<span class="st">'.json'</span>):</span>
<span id="cb24-1176"><a href="#cb24-1176" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb24-1177"><a href="#cb24-1177" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb24-1178"><a href="#cb24-1178" aria-hidden="true" tabindex="-1"></a>            name <span class="op">=</span> filename[:<span class="op">-</span><span class="dv">5</span>]</span>
<span id="cb24-1179"><a href="#cb24-1179" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> name <span class="kw">not</span> <span class="kw">in</span> files_to_process:</span>
<span id="cb24-1180"><a href="#cb24-1180" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb24-1181"><a href="#cb24-1181" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb24-1182"><a href="#cb24-1182" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb24-1183"><a href="#cb24-1183" aria-hidden="true" tabindex="-1"></a>                job <span class="op">=</span> <span class="va">self</span>._load_job_file(filename)</span>
<span id="cb24-1184"><a href="#cb24-1184" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> job:</span>
<span id="cb24-1185"><a href="#cb24-1185" aria-hidden="true" tabindex="-1"></a>                    jobs.append(job)</span>
<span id="cb24-1186"><a href="#cb24-1186" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-1187"><a href="#cb24-1187" aria-hidden="true" tabindex="-1"></a>                logging.error(<span class="ss">f"Error processing </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1188"><a href="#cb24-1188" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1189"><a href="#cb24-1189" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Processing </span><span class="sc">{</span><span class="bu">len</span>(jobs)<span class="sc">}</span><span class="ss"> remaining jobs"</span>)</span>
<span id="cb24-1190"><a href="#cb24-1190" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jobs</span>
<span id="cb24-1191"><a href="#cb24-1191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1192"><a href="#cb24-1192" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_job_file(<span class="va">self</span>, filename: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[JobData]:</span>
<span id="cb24-1193"><a href="#cb24-1193" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load and parse a single job file."""</span></span>
<span id="cb24-1194"><a href="#cb24-1194" aria-hidden="true" tabindex="-1"></a>        file_path <span class="op">=</span> os.path.join(<span class="va">self</span>.input_dir, filename)</span>
<span id="cb24-1195"><a href="#cb24-1195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb24-1196"><a href="#cb24-1196" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb24-1197"><a href="#cb24-1197" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> json.load(f)</span>
<span id="cb24-1198"><a href="#cb24-1198" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">'responsibilities'</span> <span class="kw">in</span> data <span class="kw">and</span> <span class="st">'skills'</span> <span class="kw">in</span> data:</span>
<span id="cb24-1199"><a href="#cb24-1199" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> JobData(</span>
<span id="cb24-1200"><a href="#cb24-1200" aria-hidden="true" tabindex="-1"></a>                        filename<span class="op">=</span>filename[:<span class="op">-</span><span class="dv">5</span>],</span>
<span id="cb24-1201"><a href="#cb24-1201" aria-hidden="true" tabindex="-1"></a>                        responsibilities<span class="op">=</span>data[<span class="st">'responsibilities'</span>],</span>
<span id="cb24-1202"><a href="#cb24-1202" aria-hidden="true" tabindex="-1"></a>                        skills<span class="op">=</span>data[<span class="st">'skills'</span>]</span>
<span id="cb24-1203"><a href="#cb24-1203" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb24-1204"><a href="#cb24-1204" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb24-1205"><a href="#cb24-1205" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"Invalid JSON in </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1206"><a href="#cb24-1206" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb24-1207"><a href="#cb24-1207" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1208"><a href="#cb24-1208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_classified_files(<span class="va">self</span>) <span class="op">-&gt;</span> Set[<span class="bu">str</span>]:</span>
<span id="cb24-1209"><a href="#cb24-1209" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get set of files that have been previously classified as GenAI-related."""</span></span>
<span id="cb24-1210"><a href="#cb24-1210" aria-hidden="true" tabindex="-1"></a>        genai_dir <span class="op">=</span> <span class="st">'role_genai_classifications'</span></span>
<span id="cb24-1211"><a href="#cb24-1211" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(genai_dir):</span>
<span id="cb24-1212"><a href="#cb24-1212" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">set</span>()</span>
<span id="cb24-1213"><a href="#cb24-1213" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1214"><a href="#cb24-1214" aria-hidden="true" tabindex="-1"></a>        genai_files <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb24-1215"><a href="#cb24-1215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> f <span class="kw">in</span> os.listdir(genai_dir):</span>
<span id="cb24-1216"><a href="#cb24-1216" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> f.endswith(<span class="st">'.json'</span>):</span>
<span id="cb24-1217"><a href="#cb24-1217" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb24-1218"><a href="#cb24-1218" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(os.path.join(genai_dir, f), <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb24-1219"><a href="#cb24-1219" aria-hidden="true" tabindex="-1"></a>                        data <span class="op">=</span> json.load(<span class="bu">file</span>)</span>
<span id="cb24-1220"><a href="#cb24-1220" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> data.get(<span class="st">'is_genai_role'</span>) <span class="kw">is</span> <span class="va">True</span>:  <span class="co"># Explicitly check for True</span></span>
<span id="cb24-1221"><a href="#cb24-1221" aria-hidden="true" tabindex="-1"></a>                            genai_files.add(f[:<span class="op">-</span><span class="dv">5</span>])</span>
<span id="cb24-1222"><a href="#cb24-1222" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-1223"><a href="#cb24-1223" aria-hidden="true" tabindex="-1"></a>                    logging.error(<span class="ss">f"Error reading </span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1224"><a href="#cb24-1224" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> genai_files</span>
<span id="cb24-1225"><a href="#cb24-1225" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1226"><a href="#cb24-1226" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> process_jobs(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-1227"><a href="#cb24-1227" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process all jobs."""</span></span>
<span id="cb24-1228"><a href="#cb24-1228" aria-hidden="true" tabindex="-1"></a>        jobs <span class="op">=</span> <span class="va">self</span>.load_jobs()</span>
<span id="cb24-1229"><a href="#cb24-1229" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> jobs:</span>
<span id="cb24-1230"><a href="#cb24-1230" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb24-1231"><a href="#cb24-1231" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1232"><a href="#cb24-1232" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Processing </span><span class="sc">{</span><span class="bu">len</span>(jobs)<span class="sc">}</span><span class="ss"> relevant jobs"</span>)</span>
<span id="cb24-1233"><a href="#cb24-1233" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="va">self</span>._process_jobs_batch(jobs)</span>
<span id="cb24-1234"><a href="#cb24-1234" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="st">"Job classification complete"</span>)</span>
<span id="cb24-1235"><a href="#cb24-1235" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1236"><a href="#cb24-1236" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="kw">def</span> _process_jobs_batch(<span class="va">self</span>, jobs: List[JobData]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-1237"><a href="#cb24-1237" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process a batch of jobs concurrently."""</span></span>
<span id="cb24-1238"><a href="#cb24-1238" aria-hidden="true" tabindex="-1"></a>        <span class="cf">async</span> <span class="kw">def</span> process_with_semaphore(job: JobData) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-1239"><a href="#cb24-1239" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="cf">with</span> <span class="va">self</span>.classifier.semaphore:</span>
<span id="cb24-1240"><a href="#cb24-1240" aria-hidden="true" tabindex="-1"></a>                result <span class="op">=</span> <span class="cf">await</span> <span class="va">self</span>.classifier.classify_job(job)</span>
<span id="cb24-1241"><a href="#cb24-1241" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>._save_result(result)</span>
<span id="cb24-1242"><a href="#cb24-1242" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1243"><a href="#cb24-1243" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> asyncio.gather(<span class="op">*</span>[process_with_semaphore(job) <span class="cf">for</span> job <span class="kw">in</span> jobs])</span>
<span id="cb24-1244"><a href="#cb24-1244" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1245"><a href="#cb24-1245" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _save_result(<span class="va">self</span>, result: ClassificationResult) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-1246"><a href="#cb24-1246" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Save classification result to file."""</span></span>
<span id="cb24-1247"><a href="#cb24-1247" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> os.path.join(<span class="va">self</span>.classifier.output_dir, <span class="ss">f"</span><span class="sc">{</span>result<span class="sc">.</span>filename<span class="sc">}</span><span class="ss">.json"</span>)</span>
<span id="cb24-1248"><a href="#cb24-1248" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb24-1249"><a href="#cb24-1249" aria-hidden="true" tabindex="-1"></a>            json.dump(<span class="bu">vars</span>(result), f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb24-1250"><a href="#cb24-1250" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Saved classification for job </span><span class="sc">{</span>result<span class="sc">.</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1251"><a href="#cb24-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1252"><a href="#cb24-1252" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classify_job_roles(df: pd.DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-1253"><a href="#cb24-1253" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Main entry point for job classification."""</span></span>
<span id="cb24-1254"><a href="#cb24-1254" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df.empty:</span>
<span id="cb24-1255"><a href="#cb24-1255" aria-hidden="true" tabindex="-1"></a>        logging.warning(<span class="st">"Empty DataFrame provided"</span>)</span>
<span id="cb24-1256"><a href="#cb24-1256" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb24-1257"><a href="#cb24-1257" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1258"><a href="#cb24-1258" aria-hidden="true" tabindex="-1"></a>    processor <span class="op">=</span> JobProcessor()</span>
<span id="cb24-1259"><a href="#cb24-1259" aria-hidden="true" tabindex="-1"></a>    loop <span class="op">=</span> asyncio.get_event_loop()</span>
<span id="cb24-1260"><a href="#cb24-1260" aria-hidden="true" tabindex="-1"></a>    loop.run_until_complete(processor.process_jobs())</span>
<span id="cb24-1261"><a href="#cb24-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1262"><a href="#cb24-1262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1263"><a href="#cb24-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1266"><a href="#cb24-1266" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-1267"><a href="#cb24-1267" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb24-1268"><a href="#cb24-1268" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO)</span>
<span id="cb24-1269"><a href="#cb24-1269" aria-hidden="true" tabindex="-1"></a>loader <span class="op">=</span> JobDataLoader()</span>
<span id="cb24-1270"><a href="#cb24-1270" aria-hidden="true" tabindex="-1"></a>jobs <span class="op">=</span> loader.read_json_files()</span>
<span id="cb24-1271"><a href="#cb24-1271" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(jobs)</span>
<span id="cb24-1272"><a href="#cb24-1272" aria-hidden="true" tabindex="-1"></a>classify_job_roles(df)</span>
<span id="cb24-1273"><a href="#cb24-1273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1274"><a href="#cb24-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1275"><a href="#cb24-1275" aria-hidden="true" tabindex="-1"></a><span class="fu"># Load final data</span></span>
<span id="cb24-1276"><a href="#cb24-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1277"><a href="#cb24-1277" aria-hidden="true" tabindex="-1"></a>Now I'll load and combine all of the different data outputs into a single dataframe.</span>
<span id="cb24-1278"><a href="#cb24-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1279"><a href="#cb24-1279" aria-hidden="true" tabindex="-1"></a>The code block below uses a DataLoader class with helper classes DataPaths and SalaryProcessor to handle the data processing pipeline. The code merges job posting data with role classifications, processes salary information by converting CAD to USD and extracting salary ranges, and filters the results to only include the four specific AI-related roles of interest: AI Research Scientist, AI Solution Architect, AI/ML Engineer, and MLOps/AI Infrastructure Engineer. The code includes error handling for JSON file loading and salary processing. The final output is a pandas DataFrame containing the merged and processed data, which includes job details, role classifications, and standardized salary information.</span>
<span id="cb24-1280"><a href="#cb24-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1281"><a href="#cb24-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1284"><a href="#cb24-1284" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-1285"><a href="#cb24-1285" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb24-1286"><a href="#cb24-1286" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold-show: false</span></span>
<span id="cb24-1287"><a href="#cb24-1287" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Click to view the code for loading and merging all data sources"</span></span>
<span id="cb24-1288"><a href="#cb24-1288" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Tuple, Optional, Dict</span>
<span id="cb24-1289"><a href="#cb24-1289" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-1290"><a href="#cb24-1290" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb24-1291"><a href="#cb24-1291" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb24-1292"><a href="#cb24-1292" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="cb24-1293"><a href="#cb24-1293" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb24-1294"><a href="#cb24-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1295"><a href="#cb24-1295" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb24-1296"><a href="#cb24-1296" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataPaths:</span>
<span id="cb24-1297"><a href="#cb24-1297" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Configuration for data file paths"""</span></span>
<span id="cb24-1298"><a href="#cb24-1298" aria-hidden="true" tabindex="-1"></a>    ROLE_CLASSIFICATIONS_DIR: Path <span class="op">=</span> Path(<span class="st">'role_classifications'</span>)</span>
<span id="cb24-1299"><a href="#cb24-1299" aria-hidden="true" tabindex="-1"></a>    JSON_DATA_DIR: Path <span class="op">=</span> Path(<span class="st">'json_data'</span>)</span>
<span id="cb24-1300"><a href="#cb24-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1301"><a href="#cb24-1301" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataLoader:</span>
<span id="cb24-1302"><a href="#cb24-1302" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, paths: DataPaths <span class="op">=</span> DataPaths()):</span>
<span id="cb24-1303"><a href="#cb24-1303" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.paths <span class="op">=</span> paths</span>
<span id="cb24-1304"><a href="#cb24-1304" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.salary_processor <span class="op">=</span> SalaryProcessor()</span>
<span id="cb24-1305"><a href="#cb24-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1306"><a href="#cb24-1306" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_and_merge_data(<span class="va">self</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-1307"><a href="#cb24-1307" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load and merge all data sources"""</span></span>
<span id="cb24-1308"><a href="#cb24-1308" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load and merge base data</span></span>
<span id="cb24-1309"><a href="#cb24-1309" aria-hidden="true" tabindex="-1"></a>        merged_df <span class="op">=</span> <span class="va">self</span>._load_base_data()</span>
<span id="cb24-1310"><a href="#cb24-1310" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1311"><a href="#cb24-1311" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process salaries</span></span>
<span id="cb24-1312"><a href="#cb24-1312" aria-hidden="true" tabindex="-1"></a>        salary_data <span class="op">=</span> <span class="va">self</span>.salary_processor.extract_salary_ranges(merged_df[<span class="st">'salary'</span>])</span>
<span id="cb24-1313"><a href="#cb24-1313" aria-hidden="true" tabindex="-1"></a>        merged_df <span class="op">=</span> pd.concat([merged_df, salary_data], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-1314"><a href="#cb24-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1315"><a href="#cb24-1315" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter out any jobs not in this list</span></span>
<span id="cb24-1316"><a href="#cb24-1316" aria-hidden="true" tabindex="-1"></a>        merged_df <span class="op">=</span> merged_df[merged_df[<span class="st">'role_title'</span>].isin(</span>
<span id="cb24-1317"><a href="#cb24-1317" aria-hidden="true" tabindex="-1"></a>            [<span class="st">'AI Research Scientist'</span>,</span>
<span id="cb24-1318"><a href="#cb24-1318" aria-hidden="true" tabindex="-1"></a>            <span class="st">'AI Solution Architect'</span>,</span>
<span id="cb24-1319"><a href="#cb24-1319" aria-hidden="true" tabindex="-1"></a>            <span class="st">'AI/ML Engineer'</span>,</span>
<span id="cb24-1320"><a href="#cb24-1320" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MLOps / AI Infrastructure Engineer'</span>]</span>
<span id="cb24-1321"><a href="#cb24-1321" aria-hidden="true" tabindex="-1"></a>        )]</span>
<span id="cb24-1322"><a href="#cb24-1322" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1323"><a href="#cb24-1323" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Shape of merged DataFrame: </span><span class="sc">{</span>merged_df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1324"><a href="#cb24-1324" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> merged_df</span>
<span id="cb24-1325"><a href="#cb24-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1326"><a href="#cb24-1326" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_base_data(<span class="va">self</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-1327"><a href="#cb24-1327" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load and merge base data sources"""</span></span>
<span id="cb24-1328"><a href="#cb24-1328" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load role classifications</span></span>
<span id="cb24-1329"><a href="#cb24-1329" aria-hidden="true" tabindex="-1"></a>        role_data <span class="op">=</span> pd.DataFrame(<span class="va">self</span>._load_json_files(<span class="va">self</span>.paths.ROLE_CLASSIFICATIONS_DIR))</span>
<span id="cb24-1330"><a href="#cb24-1330" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1331"><a href="#cb24-1331" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load and process jobs data</span></span>
<span id="cb24-1332"><a href="#cb24-1332" aria-hidden="true" tabindex="-1"></a>        jobs_data <span class="op">=</span> pd.DataFrame(<span class="va">self</span>._load_json_files(<span class="va">self</span>.paths.JSON_DATA_DIR))</span>
<span id="cb24-1333"><a href="#cb24-1333" aria-hidden="true" tabindex="-1"></a>        jobs_data[<span class="st">'filename'</span>] <span class="op">=</span> jobs_data[<span class="st">'url'</span>].<span class="bu">apply</span>(</span>
<span id="cb24-1334"><a href="#cb24-1334" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lambda</span> x: <span class="ss">f"j</span><span class="sc">{</span>hashlib<span class="sc">.</span>md5(x.encode())<span class="sc">.</span>hexdigest()[:<span class="dv">5</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb24-1335"><a href="#cb24-1335" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-1336"><a href="#cb24-1336" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1337"><a href="#cb24-1337" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Merge dataframes</span></span>
<span id="cb24-1338"><a href="#cb24-1338" aria-hidden="true" tabindex="-1"></a>        merged_df <span class="op">=</span> pd.merge(jobs_data, role_data, on<span class="op">=</span><span class="st">'filename'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb24-1339"><a href="#cb24-1339" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> merged_df</span>
<span id="cb24-1340"><a href="#cb24-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1341"><a href="#cb24-1341" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _load_json_files(<span class="va">self</span>, directory: Path) <span class="op">-&gt;</span> List[Dict]:</span>
<span id="cb24-1342"><a href="#cb24-1342" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load JSON files from directory"""</span></span>
<span id="cb24-1343"><a href="#cb24-1343" aria-hidden="true" tabindex="-1"></a>        json_files <span class="op">=</span> []</span>
<span id="cb24-1344"><a href="#cb24-1344" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> file_path <span class="kw">in</span> directory.glob(<span class="st">'*.json'</span>):</span>
<span id="cb24-1345"><a href="#cb24-1345" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb24-1346"><a href="#cb24-1346" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb24-1347"><a href="#cb24-1347" aria-hidden="true" tabindex="-1"></a>                    json_files.append(json.load(f))</span>
<span id="cb24-1348"><a href="#cb24-1348" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb24-1349"><a href="#cb24-1349" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Error reading </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1350"><a href="#cb24-1350" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> json_files</span>
<span id="cb24-1351"><a href="#cb24-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1352"><a href="#cb24-1352" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SalaryProcessor:</span>
<span id="cb24-1353"><a href="#cb24-1353" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles salary-related processing"""</span></span>
<span id="cb24-1354"><a href="#cb24-1354" aria-hidden="true" tabindex="-1"></a>    CAD_TO_USD_RATE <span class="op">=</span> <span class="fl">1.44</span>  <span class="co"># 1 USD = 1.44 CAD</span></span>
<span id="cb24-1355"><a href="#cb24-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1356"><a href="#cb24-1356" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> extract_salary_ranges(<span class="va">self</span>, salary_series: pd.Series) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-1357"><a href="#cb24-1357" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract salary ranges from a series of salary strings"""</span></span>
<span id="cb24-1358"><a href="#cb24-1358" aria-hidden="true" tabindex="-1"></a>        salary_data <span class="op">=</span> salary_series.<span class="bu">apply</span>(<span class="va">self</span>._extract_salary_range)</span>
<span id="cb24-1359"><a href="#cb24-1359" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.DataFrame({</span>
<span id="cb24-1360"><a href="#cb24-1360" aria-hidden="true" tabindex="-1"></a>            <span class="st">'min_salary'</span>: salary_data.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">0</span>]),</span>
<span id="cb24-1361"><a href="#cb24-1361" aria-hidden="true" tabindex="-1"></a>            <span class="st">'max_salary'</span>: salary_data.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">1</span>]),</span>
<span id="cb24-1362"><a href="#cb24-1362" aria-hidden="true" tabindex="-1"></a>            <span class="st">'mid_salary'</span>: salary_data.<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x[<span class="dv">0</span>] <span class="op">+</span> x[<span class="dv">1</span>])<span class="op">/</span><span class="dv">2</span> <span class="cf">if</span> x[<span class="dv">0</span>] <span class="kw">and</span> x[<span class="dv">1</span>] <span class="cf">else</span> <span class="va">None</span>)</span>
<span id="cb24-1363"><a href="#cb24-1363" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb24-1364"><a href="#cb24-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1365"><a href="#cb24-1365" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _extract_salary_range(<span class="va">self</span>, salary_str: <span class="bu">str</span>) <span class="op">-&gt;</span> Tuple[Optional[<span class="bu">float</span>], Optional[<span class="bu">float</span>]]:</span>
<span id="cb24-1366"><a href="#cb24-1366" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Extract minimum and maximum salary from salary string"""</span></span>
<span id="cb24-1367"><a href="#cb24-1367" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb24-1368"><a href="#cb24-1368" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(salary_str, <span class="bu">str</span>) <span class="kw">or</span> <span class="st">'0+'</span> <span class="kw">in</span> salary_str:</span>
<span id="cb24-1369"><a href="#cb24-1369" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb24-1370"><a href="#cb24-1370" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1371"><a href="#cb24-1371" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Determine currency and convert if needed</span></span>
<span id="cb24-1372"><a href="#cb24-1372" aria-hidden="true" tabindex="-1"></a>            is_cad <span class="op">=</span> <span class="st">'CAD'</span> <span class="kw">in</span> salary_str</span>
<span id="cb24-1373"><a href="#cb24-1373" aria-hidden="true" tabindex="-1"></a>            nums <span class="op">=</span> (salary_str.replace(<span class="st">'CAD '</span>, <span class="st">''</span>)</span>
<span id="cb24-1374"><a href="#cb24-1374" aria-hidden="true" tabindex="-1"></a>                            .replace(<span class="st">'USD '</span>, <span class="st">''</span>)</span>
<span id="cb24-1375"><a href="#cb24-1375" aria-hidden="true" tabindex="-1"></a>                            .replace(<span class="st">'K'</span>, <span class="st">''</span>)</span>
<span id="cb24-1376"><a href="#cb24-1376" aria-hidden="true" tabindex="-1"></a>                            .split(<span class="st">' - '</span>))</span>
<span id="cb24-1377"><a href="#cb24-1377" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1378"><a href="#cb24-1378" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(nums) <span class="op">!=</span> <span class="dv">2</span>:</span>
<span id="cb24-1379"><a href="#cb24-1379" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb24-1380"><a href="#cb24-1380" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1381"><a href="#cb24-1381" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Convert to float and apply CAD conversion if needed</span></span>
<span id="cb24-1382"><a href="#cb24-1382" aria-hidden="true" tabindex="-1"></a>            min_salary <span class="op">=</span> <span class="bu">float</span>(nums[<span class="dv">0</span>])</span>
<span id="cb24-1383"><a href="#cb24-1383" aria-hidden="true" tabindex="-1"></a>            max_salary <span class="op">=</span> <span class="bu">float</span>(nums[<span class="dv">1</span>])</span>
<span id="cb24-1384"><a href="#cb24-1384" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1385"><a href="#cb24-1385" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> is_cad:</span>
<span id="cb24-1386"><a href="#cb24-1386" aria-hidden="true" tabindex="-1"></a>                min_salary <span class="op">*=</span> <span class="va">self</span>.CAD_TO_USD_RATE</span>
<span id="cb24-1387"><a href="#cb24-1387" aria-hidden="true" tabindex="-1"></a>                max_salary <span class="op">*=</span> <span class="va">self</span>.CAD_TO_USD_RATE</span>
<span id="cb24-1388"><a href="#cb24-1388" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb24-1389"><a href="#cb24-1389" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> min_salary, max_salary</span>
<span id="cb24-1390"><a href="#cb24-1390" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb24-1391"><a href="#cb24-1391" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb24-1392"><a href="#cb24-1392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1393"><a href="#cb24-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1394"><a href="#cb24-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1397"><a href="#cb24-1397" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-1398"><a href="#cb24-1398" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the loader and load the data</span></span>
<span id="cb24-1399"><a href="#cb24-1399" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the csv file exists</span></span>
<span id="cb24-1400"><a href="#cb24-1400" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'genai_job_data.csv'</span>):</span>
<span id="cb24-1401"><a href="#cb24-1401" aria-hidden="true" tabindex="-1"></a>    loader <span class="op">=</span> DataLoader()</span>
<span id="cb24-1402"><a href="#cb24-1402" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> loader.load_and_merge_data()</span>
<span id="cb24-1403"><a href="#cb24-1403" aria-hidden="true" tabindex="-1"></a>    df.to_csv(<span class="st">'genai_job_data.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-1404"><a href="#cb24-1404" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb24-1405"><a href="#cb24-1405" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(<span class="st">'genai_job_data.csv'</span>)</span>
<span id="cb24-1406"><a href="#cb24-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1407"><a href="#cb24-1407" aria-hidden="true" tabindex="-1"></a><span class="co"># Now df contains all the merged data with processed salaries</span></span>
<span id="cb24-1408"><a href="#cb24-1408" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total jobs loaded: </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1409"><a href="#cb24-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1410"><a href="#cb24-1410" aria-hidden="true" tabindex="-1"></a><span class="co"># Example operations you can do with the DataFrame:</span></span>
<span id="cb24-1411"><a href="#cb24-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1412"><a href="#cb24-1412" aria-hidden="true" tabindex="-1"></a><span class="co"># View available columns</span></span>
<span id="cb24-1413"><a href="#cb24-1413" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Available columns:"</span>)</span>
<span id="cb24-1414"><a href="#cb24-1414" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.columns.tolist())</span>
<span id="cb24-1415"><a href="#cb24-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1416"><a href="#cb24-1416" aria-hidden="true" tabindex="-1"></a><span class="co"># View distribution of roles</span></span>
<span id="cb24-1417"><a href="#cb24-1417" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Role distribution:"</span>)</span>
<span id="cb24-1418"><a href="#cb24-1418" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'role_title'</span>].value_counts())</span>
<span id="cb24-1419"><a href="#cb24-1419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1420"><a href="#cb24-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1421"><a href="#cb24-1421" aria-hidden="true" tabindex="-1"></a><span class="fu"># Salary analysis</span></span>
<span id="cb24-1422"><a href="#cb24-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1423"><a href="#cb24-1423" aria-hidden="true" tabindex="-1"></a>First I'll analyze the salary data for each role and experience level. I'll use a RandomForest model to adjust for location differences, and convert any CAD denominated salaries to USD. I'm interested to see what compensation is like for each role, and if there are any significant differences in compensation between the roles.</span>
<span id="cb24-1424"><a href="#cb24-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1425"><a href="#cb24-1425" aria-hidden="true" tabindex="-1"></a>The code below implements a salary analysis system for the job posting data. It processes salary information across different roles and experience levels, handling currency conversions (CAD to USD) and adjusting for location differences using a RandomForest model. For each role and level combination, it calculates salary ranges, removes statistical outliers, and provides sample sizes. The system includes configuration settings for analysis parameters and comprehensive error handling. The code uses pandas for data manipulation and scikit-learn for the location adjustment model, with results formatted as salary ranges in USD.</span>
<span id="cb24-1426"><a href="#cb24-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1429"><a href="#cb24-1429" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-1430"><a href="#cb24-1430" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb24-1431"><a href="#cb24-1431" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold-show: false</span></span>
<span id="cb24-1432"><a href="#cb24-1432" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Click to view the code for salary analysis"</span></span>
<span id="cb24-1433"><a href="#cb24-1433" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="cb24-1434"><a href="#cb24-1434" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Optional, TypedDict, Set</span>
<span id="cb24-1435"><a href="#cb24-1435" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb24-1436"><a href="#cb24-1436" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-1437"><a href="#cb24-1437" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb24-1438"><a href="#cb24-1438" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb24-1439"><a href="#cb24-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1440"><a href="#cb24-1440" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb24-1441"><a href="#cb24-1441" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SalaryConfig:</span>
<span id="cb24-1442"><a href="#cb24-1442" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Configuration settings for salary analysis"""</span></span>
<span id="cb24-1443"><a href="#cb24-1443" aria-hidden="true" tabindex="-1"></a>    outlier_threshold: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb24-1444"><a href="#cb24-1444" aria-hidden="true" tabindex="-1"></a>    n_estimators: <span class="bu">int</span> <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb24-1445"><a href="#cb24-1445" aria-hidden="true" tabindex="-1"></a>    min_group_size: <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb24-1446"><a href="#cb24-1446" aria-hidden="true" tabindex="-1"></a>    currency_symbol: <span class="bu">str</span> <span class="op">=</span> <span class="st">'$'</span></span>
<span id="cb24-1447"><a href="#cb24-1447" aria-hidden="true" tabindex="-1"></a>    cv_folds: <span class="bu">int</span> <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb24-1448"><a href="#cb24-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1449"><a href="#cb24-1449" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SalaryColumns(TypedDict):</span>
<span id="cb24-1450"><a href="#cb24-1450" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Type definitions for salary DataFrame columns"""</span></span>
<span id="cb24-1451"><a href="#cb24-1451" aria-hidden="true" tabindex="-1"></a>    min_salary_usd_k: <span class="bu">float</span></span>
<span id="cb24-1452"><a href="#cb24-1452" aria-hidden="true" tabindex="-1"></a>    max_salary_usd_k: <span class="bu">float</span></span>
<span id="cb24-1453"><a href="#cb24-1453" aria-hidden="true" tabindex="-1"></a>    median_salary_usd_k: <span class="bu">float</span></span>
<span id="cb24-1454"><a href="#cb24-1454" aria-hidden="true" tabindex="-1"></a>    sample_size: <span class="bu">int</span></span>
<span id="cb24-1455"><a href="#cb24-1455" aria-hidden="true" tabindex="-1"></a>    location_adjusted_zscore: <span class="bu">float</span></span>
<span id="cb24-1456"><a href="#cb24-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1457"><a href="#cb24-1457" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SalaryAnalyzer:</span>
<span id="cb24-1458"><a href="#cb24-1458" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Analyzes salary distributions across role titles.</span></span>
<span id="cb24-1459"><a href="#cb24-1459" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb24-1460"><a href="#cb24-1460" aria-hidden="true" tabindex="-1"></a><span class="co">    Column Naming Conventions:</span></span>
<span id="cb24-1461"><a href="#cb24-1461" aria-hidden="true" tabindex="-1"></a><span class="co">    - *_usd_k: Values in thousands of USD</span></span>
<span id="cb24-1462"><a href="#cb24-1462" aria-hidden="true" tabindex="-1"></a><span class="co">    - *_zscore: Standardized scores (mean=0, std=1)</span></span>
<span id="cb24-1463"><a href="#cb24-1463" aria-hidden="true" tabindex="-1"></a><span class="co">    - sample_size: Number of data points in group</span></span>
<span id="cb24-1464"><a href="#cb24-1464" aria-hidden="true" tabindex="-1"></a><span class="co">    - *_median: Median values</span></span>
<span id="cb24-1465"><a href="#cb24-1465" aria-hidden="true" tabindex="-1"></a><span class="co">    - location_adjusted_*: Values adjusted for location differences</span></span>
<span id="cb24-1466"><a href="#cb24-1466" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb24-1467"><a href="#cb24-1467" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes:</span></span>
<span id="cb24-1468"><a href="#cb24-1468" aria-hidden="true" tabindex="-1"></a><span class="co">        config: Configuration settings for analysis</span></span>
<span id="cb24-1469"><a href="#cb24-1469" aria-hidden="true" tabindex="-1"></a><span class="co">        logger: Logger instance for the class</span></span>
<span id="cb24-1470"><a href="#cb24-1470" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb24-1471"><a href="#cb24-1471" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1472"><a href="#cb24-1472" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input column names</span></span>
<span id="cb24-1473"><a href="#cb24-1473" aria-hidden="true" tabindex="-1"></a>    COL_MIN_SALARY <span class="op">=</span> <span class="st">'min_salary'</span></span>
<span id="cb24-1474"><a href="#cb24-1474" aria-hidden="true" tabindex="-1"></a>    COL_MAX_SALARY <span class="op">=</span> <span class="st">'max_salary'</span></span>
<span id="cb24-1475"><a href="#cb24-1475" aria-hidden="true" tabindex="-1"></a>    COL_ROLE_TITLE <span class="op">=</span> <span class="st">'role_title'</span></span>
<span id="cb24-1476"><a href="#cb24-1476" aria-hidden="true" tabindex="-1"></a>    COL_LEVEL <span class="op">=</span> <span class="st">'level'</span></span>
<span id="cb24-1477"><a href="#cb24-1477" aria-hidden="true" tabindex="-1"></a>    COL_LOCATION <span class="op">=</span> <span class="st">'location'</span></span>
<span id="cb24-1478"><a href="#cb24-1478" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1479"><a href="#cb24-1479" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Processed column names</span></span>
<span id="cb24-1480"><a href="#cb24-1480" aria-hidden="true" tabindex="-1"></a>    COL_MEDIAN_SALARY <span class="op">=</span> <span class="st">'median_salary_usd_k'</span></span>
<span id="cb24-1481"><a href="#cb24-1481" aria-hidden="true" tabindex="-1"></a>    COL_MIN_SALARY_MEDIAN <span class="op">=</span> <span class="st">'min_salary_median_usd_k'</span></span>
<span id="cb24-1482"><a href="#cb24-1482" aria-hidden="true" tabindex="-1"></a>    COL_MAX_SALARY_MEDIAN <span class="op">=</span> <span class="st">'max_salary_median_usd_k'</span></span>
<span id="cb24-1483"><a href="#cb24-1483" aria-hidden="true" tabindex="-1"></a>    COL_SAMPLE_SIZE <span class="op">=</span> <span class="st">'sample_size'</span></span>
<span id="cb24-1484"><a href="#cb24-1484" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1485"><a href="#cb24-1485" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z-score columns</span></span>
<span id="cb24-1486"><a href="#cb24-1486" aria-hidden="true" tabindex="-1"></a>    COL_MIN_ZSCORE <span class="op">=</span> <span class="st">'min_salary_location_adjusted_zscore'</span></span>
<span id="cb24-1487"><a href="#cb24-1487" aria-hidden="true" tabindex="-1"></a>    COL_MID_ZSCORE <span class="op">=</span> <span class="st">'median_salary_location_adjusted_zscore'</span></span>
<span id="cb24-1488"><a href="#cb24-1488" aria-hidden="true" tabindex="-1"></a>    COL_MAX_ZSCORE <span class="op">=</span> <span class="st">'max_salary_location_adjusted_zscore'</span></span>
<span id="cb24-1489"><a href="#cb24-1489" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1490"><a href="#cb24-1490" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, config: Optional[SalaryConfig] <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb24-1491"><a href="#cb24-1491" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Initialize SalaryAnalyzer with optional configuration."""</span></span>
<span id="cb24-1492"><a href="#cb24-1492" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.config <span class="op">=</span> config <span class="kw">or</span> SalaryConfig()</span>
<span id="cb24-1493"><a href="#cb24-1493" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb24-1494"><a href="#cb24-1494" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._model <span class="op">=</span> <span class="va">None</span>  <span class="co"># Cache for trained model</span></span>
<span id="cb24-1495"><a href="#cb24-1495" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1496"><a href="#cb24-1496" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> analyze_role_salaries(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-1497"><a href="#cb24-1497" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb24-1498"><a href="#cb24-1498" aria-hidden="true" tabindex="-1"></a><span class="co">        Analyze salary distributions across role titles with location adjustment.</span></span>
<span id="cb24-1499"><a href="#cb24-1499" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb24-1500"><a href="#cb24-1500" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb24-1501"><a href="#cb24-1501" aria-hidden="true" tabindex="-1"></a><span class="co">            df: DataFrame containing columns:</span></span>
<span id="cb24-1502"><a href="#cb24-1502" aria-hidden="true" tabindex="-1"></a><span class="co">                - min_salary: Minimum salary (float)</span></span>
<span id="cb24-1503"><a href="#cb24-1503" aria-hidden="true" tabindex="-1"></a><span class="co">                - max_salary: Maximum salary (float)</span></span>
<span id="cb24-1504"><a href="#cb24-1504" aria-hidden="true" tabindex="-1"></a><span class="co">                - role_title: Job role (str)</span></span>
<span id="cb24-1505"><a href="#cb24-1505" aria-hidden="true" tabindex="-1"></a><span class="co">                - level: Experience level (str)</span></span>
<span id="cb24-1506"><a href="#cb24-1506" aria-hidden="true" tabindex="-1"></a><span class="co">                - location: Job location (str)</span></span>
<span id="cb24-1507"><a href="#cb24-1507" aria-hidden="true" tabindex="-1"></a><span class="co">                </span></span>
<span id="cb24-1508"><a href="#cb24-1508" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb24-1509"><a href="#cb24-1509" aria-hidden="true" tabindex="-1"></a><span class="co">            DataFrame with aggregated salary statistics by role and level</span></span>
<span id="cb24-1510"><a href="#cb24-1510" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb24-1511"><a href="#cb24-1511" aria-hidden="true" tabindex="-1"></a><span class="co">        Raises:</span></span>
<span id="cb24-1512"><a href="#cb24-1512" aria-hidden="true" tabindex="-1"></a><span class="co">            ValueError: If required columns are missing or DataFrame is empty</span></span>
<span id="cb24-1513"><a href="#cb24-1513" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb24-1514"><a href="#cb24-1514" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._validate_input(df)</span>
<span id="cb24-1515"><a href="#cb24-1515" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="ss">f"Starting salary analysis with </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">}</span><span class="ss"> records"</span>)</span>
<span id="cb24-1516"><a href="#cb24-1516" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1517"><a href="#cb24-1517" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create working copy of DataFrame</span></span>
<span id="cb24-1518"><a href="#cb24-1518" aria-hidden="true" tabindex="-1"></a>        analysis_df <span class="op">=</span> <span class="va">self</span>._prepare_data(df)</span>
<span id="cb24-1519"><a href="#cb24-1519" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1520"><a href="#cb24-1520" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process and clean data</span></span>
<span id="cb24-1521"><a href="#cb24-1521" aria-hidden="true" tabindex="-1"></a>        analysis_df <span class="op">=</span> <span class="va">self</span>._process_data(analysis_df)</span>
<span id="cb24-1522"><a href="#cb24-1522" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1523"><a href="#cb24-1523" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate final results</span></span>
<span id="cb24-1524"><a href="#cb24-1524" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> <span class="va">self</span>._aggregate_results(analysis_df)</span>
<span id="cb24-1525"><a href="#cb24-1525" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1526"><a href="#cb24-1526" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.info(<span class="st">"Salary analysis completed successfully"</span>)</span>
<span id="cb24-1527"><a href="#cb24-1527" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb24-1528"><a href="#cb24-1528" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1529"><a href="#cb24-1529" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _validate_input(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-1530"><a href="#cb24-1530" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Validate input DataFrame."""</span></span>
<span id="cb24-1531"><a href="#cb24-1531" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> df.empty:</span>
<span id="cb24-1532"><a href="#cb24-1532" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Input DataFrame cannot be None or empty"</span>)</span>
<span id="cb24-1533"><a href="#cb24-1533" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1534"><a href="#cb24-1534" aria-hidden="true" tabindex="-1"></a>        required_cols <span class="op">=</span> {</span>
<span id="cb24-1535"><a href="#cb24-1535" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MIN_SALARY, </span>
<span id="cb24-1536"><a href="#cb24-1536" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MAX_SALARY, </span>
<span id="cb24-1537"><a href="#cb24-1537" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_ROLE_TITLE,</span>
<span id="cb24-1538"><a href="#cb24-1538" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_LEVEL,</span>
<span id="cb24-1539"><a href="#cb24-1539" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_LOCATION</span>
<span id="cb24-1540"><a href="#cb24-1540" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-1541"><a href="#cb24-1541" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1542"><a href="#cb24-1542" aria-hidden="true" tabindex="-1"></a>        missing_cols <span class="op">=</span> required_cols <span class="op">-</span> <span class="bu">set</span>(df.columns)</span>
<span id="cb24-1543"><a href="#cb24-1543" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> missing_cols:</span>
<span id="cb24-1544"><a href="#cb24-1544" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"DataFrame missing required columns: </span><span class="sc">{</span>missing_cols<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1545"><a href="#cb24-1545" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1546"><a href="#cb24-1546" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _prepare_data(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-1547"><a href="#cb24-1547" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Prepare data for analysis by filtering valid salaries."""</span></span>
<span id="cb24-1548"><a href="#cb24-1548" aria-hidden="true" tabindex="-1"></a>        valid_salary_mask <span class="op">=</span> (</span>
<span id="cb24-1549"><a href="#cb24-1549" aria-hidden="true" tabindex="-1"></a>            df[<span class="va">self</span>.COL_MIN_SALARY].notna() <span class="op">&amp;</span> </span>
<span id="cb24-1550"><a href="#cb24-1550" aria-hidden="true" tabindex="-1"></a>            df[<span class="va">self</span>.COL_MAX_SALARY].notna()</span>
<span id="cb24-1551"><a href="#cb24-1551" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-1552"><a href="#cb24-1552" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1553"><a href="#cb24-1553" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> valid_salary_mask.<span class="bu">any</span>():</span>
<span id="cb24-1554"><a href="#cb24-1554" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.logger.warning(<span class="st">"No valid salary data found"</span>)</span>
<span id="cb24-1555"><a href="#cb24-1555" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> pd.DataFrame()</span>
<span id="cb24-1556"><a href="#cb24-1556" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1557"><a href="#cb24-1557" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create working copy and calculate median salary</span></span>
<span id="cb24-1558"><a href="#cb24-1558" aria-hidden="true" tabindex="-1"></a>        analysis_df <span class="op">=</span> df[valid_salary_mask].copy()</span>
<span id="cb24-1559"><a href="#cb24-1559" aria-hidden="true" tabindex="-1"></a>        analysis_df[<span class="va">self</span>.COL_MEDIAN_SALARY] <span class="op">=</span> (</span>
<span id="cb24-1560"><a href="#cb24-1560" aria-hidden="true" tabindex="-1"></a>            analysis_df[[<span class="va">self</span>.COL_MIN_SALARY, <span class="va">self</span>.COL_MAX_SALARY]].mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-1561"><a href="#cb24-1561" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-1562"><a href="#cb24-1562" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1563"><a href="#cb24-1563" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> analysis_df</span>
<span id="cb24-1564"><a href="#cb24-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1565"><a href="#cb24-1565" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _remove_outliers(<span class="va">self</span>, group: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-1566"><a href="#cb24-1566" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Remove statistical outliers from salary data."""</span></span>
<span id="cb24-1567"><a href="#cb24-1567" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(group) <span class="op">&lt;=</span> <span class="va">self</span>.config.min_group_size:</span>
<span id="cb24-1568"><a href="#cb24-1568" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> group</span>
<span id="cb24-1569"><a href="#cb24-1569" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1570"><a href="#cb24-1570" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Only check min and max salary for outliers</span></span>
<span id="cb24-1571"><a href="#cb24-1571" aria-hidden="true" tabindex="-1"></a>        salary_cols <span class="op">=</span> [<span class="va">self</span>.COL_MIN_SALARY, <span class="va">self</span>.COL_MAX_SALARY]</span>
<span id="cb24-1572"><a href="#cb24-1572" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1573"><a href="#cb24-1573" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> salary_cols:</span>
<span id="cb24-1574"><a href="#cb24-1574" aria-hidden="true" tabindex="-1"></a>            Q1 <span class="op">=</span> group[col].quantile(<span class="fl">0.25</span>)</span>
<span id="cb24-1575"><a href="#cb24-1575" aria-hidden="true" tabindex="-1"></a>            Q3 <span class="op">=</span> group[col].quantile(<span class="fl">0.75</span>)</span>
<span id="cb24-1576"><a href="#cb24-1576" aria-hidden="true" tabindex="-1"></a>            IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb24-1577"><a href="#cb24-1577" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1578"><a href="#cb24-1578" aria-hidden="true" tabindex="-1"></a>            outlier_mask <span class="op">=</span> <span class="op">~</span>(</span>
<span id="cb24-1579"><a href="#cb24-1579" aria-hidden="true" tabindex="-1"></a>                (group[col] <span class="op">&lt;</span> (Q1 <span class="op">-</span> <span class="va">self</span>.config.outlier_threshold <span class="op">*</span> IQR)) <span class="op">|</span> </span>
<span id="cb24-1580"><a href="#cb24-1580" aria-hidden="true" tabindex="-1"></a>                (group[col] <span class="op">&gt;</span> (Q3 <span class="op">+</span> <span class="va">self</span>.config.outlier_threshold <span class="op">*</span> IQR))</span>
<span id="cb24-1581"><a href="#cb24-1581" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-1582"><a href="#cb24-1582" aria-hidden="true" tabindex="-1"></a>            group <span class="op">=</span> group[outlier_mask]</span>
<span id="cb24-1583"><a href="#cb24-1583" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1584"><a href="#cb24-1584" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Recalculate median after removing outliers</span></span>
<span id="cb24-1585"><a href="#cb24-1585" aria-hidden="true" tabindex="-1"></a>        group[<span class="va">self</span>.COL_MEDIAN_SALARY] <span class="op">=</span> (</span>
<span id="cb24-1586"><a href="#cb24-1586" aria-hidden="true" tabindex="-1"></a>            group[<span class="va">self</span>.COL_MIN_SALARY] <span class="op">+</span> group[<span class="va">self</span>.COL_MAX_SALARY]</span>
<span id="cb24-1587"><a href="#cb24-1587" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb24-1588"><a href="#cb24-1588" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1589"><a href="#cb24-1589" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> group</span>
<span id="cb24-1590"><a href="#cb24-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1591"><a href="#cb24-1591" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _aggregate_results(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-1592"><a href="#cb24-1592" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Aggregate and format the final results."""</span></span>
<span id="cb24-1593"><a href="#cb24-1593" aria-hidden="true" tabindex="-1"></a>        <span class="co"># First calculate group statistics</span></span>
<span id="cb24-1594"><a href="#cb24-1594" aria-hidden="true" tabindex="-1"></a>        grouped <span class="op">=</span> df.groupby([<span class="va">self</span>.COL_ROLE_TITLE, <span class="va">self</span>.COL_LEVEL]).agg({</span>
<span id="cb24-1595"><a href="#cb24-1595" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MIN_SALARY: [<span class="st">'count'</span>, <span class="st">'median'</span>],</span>
<span id="cb24-1596"><a href="#cb24-1596" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MAX_SALARY: <span class="st">'median'</span>,</span>
<span id="cb24-1597"><a href="#cb24-1597" aria-hidden="true" tabindex="-1"></a>        }).<span class="bu">round</span>(<span class="dv">0</span>)</span>
<span id="cb24-1598"><a href="#cb24-1598" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1599"><a href="#cb24-1599" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate median salary from min and max medians</span></span>
<span id="cb24-1600"><a href="#cb24-1600" aria-hidden="true" tabindex="-1"></a>        grouped[<span class="st">'median_salary'</span>] <span class="op">=</span> (</span>
<span id="cb24-1601"><a href="#cb24-1601" aria-hidden="true" tabindex="-1"></a>            grouped[(<span class="va">self</span>.COL_MIN_SALARY, <span class="st">'median'</span>)] <span class="op">+</span> </span>
<span id="cb24-1602"><a href="#cb24-1602" aria-hidden="true" tabindex="-1"></a>            grouped[(<span class="va">self</span>.COL_MAX_SALARY, <span class="st">'median'</span>)]</span>
<span id="cb24-1603"><a href="#cb24-1603" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb24-1604"><a href="#cb24-1604" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1605"><a href="#cb24-1605" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Flatten and rename columns</span></span>
<span id="cb24-1606"><a href="#cb24-1606" aria-hidden="true" tabindex="-1"></a>        grouped.columns <span class="op">=</span> [</span>
<span id="cb24-1607"><a href="#cb24-1607" aria-hidden="true" tabindex="-1"></a>            <span class="st">'sample_size'</span> <span class="cf">if</span> col <span class="op">==</span> (<span class="va">self</span>.COL_MIN_SALARY, <span class="st">'count'</span>)</span>
<span id="cb24-1608"><a href="#cb24-1608" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="st">'min_salary_usd_k'</span> <span class="cf">if</span> col <span class="op">==</span> (<span class="va">self</span>.COL_MIN_SALARY, <span class="st">'median'</span>)</span>
<span id="cb24-1609"><a href="#cb24-1609" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="st">'max_salary_usd_k'</span> <span class="cf">if</span> col <span class="op">==</span> (<span class="va">self</span>.COL_MAX_SALARY, <span class="st">'median'</span>)</span>
<span id="cb24-1610"><a href="#cb24-1610" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="st">'median_salary_usd_k'</span> <span class="cf">if</span> col[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'median_salary'</span></span>
<span id="cb24-1611"><a href="#cb24-1611" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> col</span>
<span id="cb24-1612"><a href="#cb24-1612" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> col <span class="kw">in</span> grouped.columns</span>
<span id="cb24-1613"><a href="#cb24-1613" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb24-1614"><a href="#cb24-1614" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1615"><a href="#cb24-1615" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Order columns</span></span>
<span id="cb24-1616"><a href="#cb24-1616" aria-hidden="true" tabindex="-1"></a>        ordered_cols <span class="op">=</span> [</span>
<span id="cb24-1617"><a href="#cb24-1617" aria-hidden="true" tabindex="-1"></a>            <span class="st">'sample_size'</span>,</span>
<span id="cb24-1618"><a href="#cb24-1618" aria-hidden="true" tabindex="-1"></a>            <span class="st">'min_salary_usd_k'</span>,</span>
<span id="cb24-1619"><a href="#cb24-1619" aria-hidden="true" tabindex="-1"></a>            <span class="st">'max_salary_usd_k'</span>,</span>
<span id="cb24-1620"><a href="#cb24-1620" aria-hidden="true" tabindex="-1"></a>            <span class="st">'median_salary_usd_k'</span></span>
<span id="cb24-1621"><a href="#cb24-1621" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb24-1622"><a href="#cb24-1622" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> grouped.reindex(columns<span class="op">=</span>ordered_cols)</span>
<span id="cb24-1623"><a href="#cb24-1623" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1624"><a href="#cb24-1624" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Format salary values</span></span>
<span id="cb24-1625"><a href="#cb24-1625" aria-hidden="true" tabindex="-1"></a>        salary_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> ordered_cols <span class="cf">if</span> col.endswith(<span class="st">'_usd_k'</span>)]</span>
<span id="cb24-1626"><a href="#cb24-1626" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> salary_cols:</span>
<span id="cb24-1627"><a href="#cb24-1627" aria-hidden="true" tabindex="-1"></a>            result[col] <span class="op">=</span> result[col].<span class="bu">apply</span>(</span>
<span id="cb24-1628"><a href="#cb24-1628" aria-hidden="true" tabindex="-1"></a>                <span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>config<span class="sc">.</span>currency_symbol<span class="sc">}{</span>x<span class="sc">:,.0f}</span><span class="ss">K"</span> <span class="cf">if</span> pd.notna(x) <span class="cf">else</span> <span class="st">"N/A"</span></span>
<span id="cb24-1629"><a href="#cb24-1629" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-1630"><a href="#cb24-1630" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1631"><a href="#cb24-1631" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb24-1632"><a href="#cb24-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1633"><a href="#cb24-1633" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1634"><a href="#cb24-1634" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _process_data(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-1635"><a href="#cb24-1635" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Process and clean the salary data."""</span></span>
<span id="cb24-1636"><a href="#cb24-1636" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove outliers by group</span></span>
<span id="cb24-1637"><a href="#cb24-1637" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> (df.groupby([<span class="va">self</span>.COL_ROLE_TITLE, <span class="va">self</span>.COL_LEVEL])</span>
<span id="cb24-1638"><a href="#cb24-1638" aria-hidden="true" tabindex="-1"></a>              .<span class="bu">apply</span>(<span class="va">self</span>._remove_outliers)</span>
<span id="cb24-1639"><a href="#cb24-1639" aria-hidden="true" tabindex="-1"></a>              .reset_index(drop<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb24-1640"><a href="#cb24-1640" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1641"><a href="#cb24-1641" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add location-adjusted scores</span></span>
<span id="cb24-1642"><a href="#cb24-1642" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="va">self</span>._add_location_adjusted_scores(df)</span>
<span id="cb24-1643"><a href="#cb24-1643" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1644"><a href="#cb24-1644" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean level names</span></span>
<span id="cb24-1645"><a href="#cb24-1645" aria-hidden="true" tabindex="-1"></a>        df[<span class="va">self</span>.COL_LEVEL] <span class="op">=</span> (df[<span class="va">self</span>.COL_LEVEL]</span>
<span id="cb24-1646"><a href="#cb24-1646" aria-hidden="true" tabindex="-1"></a>                             .<span class="bu">str</span>.replace(<span class="st">'-Level / Level'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-1647"><a href="#cb24-1647" aria-hidden="true" tabindex="-1"></a>                             .<span class="bu">str</span>.replace(<span class="st">'-level'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb24-1648"><a href="#cb24-1648" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1649"><a href="#cb24-1649" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb24-1650"><a href="#cb24-1650" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1651"><a href="#cb24-1651" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _train_model(<span class="va">self</span>) <span class="op">-&gt;</span> RandomForestRegressor:</span>
<span id="cb24-1652"><a href="#cb24-1652" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Train and cache RandomForest model."""</span></span>
<span id="cb24-1653"><a href="#cb24-1653" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._model <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb24-1654"><a href="#cb24-1654" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._model <span class="op">=</span> RandomForestRegressor(</span>
<span id="cb24-1655"><a href="#cb24-1655" aria-hidden="true" tabindex="-1"></a>                n_estimators<span class="op">=</span><span class="va">self</span>.config.n_estimators,</span>
<span id="cb24-1656"><a href="#cb24-1656" aria-hidden="true" tabindex="-1"></a>                random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb24-1657"><a href="#cb24-1657" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-1658"><a href="#cb24-1658" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._model</span>
<span id="cb24-1659"><a href="#cb24-1659" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1660"><a href="#cb24-1660" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _add_location_adjusted_scores(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb24-1661"><a href="#cb24-1661" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Add location-adjusted z-scores to the dataframe."""</span></span>
<span id="cb24-1662"><a href="#cb24-1662" aria-hidden="true" tabindex="-1"></a>        location_dummies <span class="op">=</span> pd.get_dummies(df[<span class="va">self</span>.COL_LOCATION], prefix<span class="op">=</span><span class="st">'loc'</span>)</span>
<span id="cb24-1663"><a href="#cb24-1663" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> <span class="va">self</span>._train_model()</span>
<span id="cb24-1664"><a href="#cb24-1664" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1665"><a href="#cb24-1665" aria-hidden="true" tabindex="-1"></a>        score_columns <span class="op">=</span> {</span>
<span id="cb24-1666"><a href="#cb24-1666" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MIN_SALARY: <span class="va">self</span>.COL_MIN_ZSCORE,</span>
<span id="cb24-1667"><a href="#cb24-1667" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MEDIAN_SALARY: <span class="va">self</span>.COL_MID_ZSCORE,</span>
<span id="cb24-1668"><a href="#cb24-1668" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.COL_MAX_SALARY: <span class="va">self</span>.COL_MAX_ZSCORE</span>
<span id="cb24-1669"><a href="#cb24-1669" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-1670"><a href="#cb24-1670" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1671"><a href="#cb24-1671" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> source_col, target_col <span class="kw">in</span> score_columns.items():</span>
<span id="cb24-1672"><a href="#cb24-1672" aria-hidden="true" tabindex="-1"></a>            df[target_col] <span class="op">=</span> <span class="va">self</span>._adjust_salaries(</span>
<span id="cb24-1673"><a href="#cb24-1673" aria-hidden="true" tabindex="-1"></a>                df[source_col], </span>
<span id="cb24-1674"><a href="#cb24-1674" aria-hidden="true" tabindex="-1"></a>                location_dummies,</span>
<span id="cb24-1675"><a href="#cb24-1675" aria-hidden="true" tabindex="-1"></a>                model</span>
<span id="cb24-1676"><a href="#cb24-1676" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-1677"><a href="#cb24-1677" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1678"><a href="#cb24-1678" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb24-1679"><a href="#cb24-1679" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1680"><a href="#cb24-1680" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _adjust_salaries(<span class="va">self</span>, </span>
<span id="cb24-1681"><a href="#cb24-1681" aria-hidden="true" tabindex="-1"></a>                        salary_series: pd.Series,</span>
<span id="cb24-1682"><a href="#cb24-1682" aria-hidden="true" tabindex="-1"></a>                        X: pd.DataFrame,</span>
<span id="cb24-1683"><a href="#cb24-1683" aria-hidden="true" tabindex="-1"></a>                        model: RandomForestRegressor) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb24-1684"><a href="#cb24-1684" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Adjust salaries using RandomForest model."""</span></span>
<span id="cb24-1685"><a href="#cb24-1685" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Evaluate model performance</span></span>
<span id="cb24-1686"><a href="#cb24-1686" aria-hidden="true" tabindex="-1"></a>        scores <span class="op">=</span> cross_val_score(</span>
<span id="cb24-1687"><a href="#cb24-1687" aria-hidden="true" tabindex="-1"></a>            model, X, salary_series, </span>
<span id="cb24-1688"><a href="#cb24-1688" aria-hidden="true" tabindex="-1"></a>            cv<span class="op">=</span><span class="va">self</span>.config.cv_folds</span>
<span id="cb24-1689"><a href="#cb24-1689" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-1690"><a href="#cb24-1690" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.logger.debug(<span class="ss">f"Cross-validation scores: </span><span class="sc">{</span>scores<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss"> ± </span><span class="sc">{</span>scores<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb24-1691"><a href="#cb24-1691" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1692"><a href="#cb24-1692" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fit model and calculate residuals</span></span>
<span id="cb24-1693"><a href="#cb24-1693" aria-hidden="true" tabindex="-1"></a>        model.fit(X, salary_series)</span>
<span id="cb24-1694"><a href="#cb24-1694" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> model.predict(X)</span>
<span id="cb24-1695"><a href="#cb24-1695" aria-hidden="true" tabindex="-1"></a>        residuals <span class="op">=</span> salary_series <span class="op">-</span> expected</span>
<span id="cb24-1696"><a href="#cb24-1696" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1697"><a href="#cb24-1697" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Return standardized residuals</span></span>
<span id="cb24-1698"><a href="#cb24-1698" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (residuals <span class="op">-</span> residuals.mean()) <span class="op">/</span> residuals.std()</span>
<span id="cb24-1699"><a href="#cb24-1699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1700"><a href="#cb24-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1703"><a href="#cb24-1703" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-1704"><a href="#cb24-1704" aria-hidden="true" tabindex="-1"></a>salary_analyzer <span class="op">=</span> SalaryAnalyzer()</span>
<span id="cb24-1705"><a href="#cb24-1705" aria-hidden="true" tabindex="-1"></a>salary_df <span class="op">=</span> salary_analyzer.analyze_role_salaries(df)</span>
<span id="cb24-1706"><a href="#cb24-1706" aria-hidden="true" tabindex="-1"></a>salary_df</span>
<span id="cb24-1707"><a href="#cb24-1707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1708"><a href="#cb24-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1709"><a href="#cb24-1709" aria-hidden="true" tabindex="-1"></a>Looking across all the four GenAI roles (AI Research, Solutions Architecture, ML Engineering, and MLOps), compensation bands are similar. At senior levels (where I have the largest samples), median salaries cluster tightly between ~$195K-$210K USD. Mid-level positions show medians between ~$165K-$180K USD, and entry-level positions generally start between ~$155K-$205K USD, although this entry-level data is limited by small samples.</span>
<span id="cb24-1710"><a href="#cb24-1710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1711"><a href="#cb24-1711" aria-hidden="true" tabindex="-1"></a>This consistency suggests these roles are valued similarly in the market, despite their different focuses.</span>
<span id="cb24-1712"><a href="#cb24-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1713"><a href="#cb24-1713" aria-hidden="true" tabindex="-1"></a><span class="fu"># Job responsibilities</span></span>
<span id="cb24-1714"><a href="#cb24-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1715"><a href="#cb24-1715" aria-hidden="true" tabindex="-1"></a>Next, I'm interested to see what the job responsibilities are for some of these roles, and how they differ. I'll use an LLM to identify the most common responsibilities and skills for a given role. This task will be quite complex, involving a lot of input data. So a model like <span class="in">`o1`</span> will be more appropriate. I don't have access to <span class="in">`o1`</span> via API, so I'll use the web interface to generate completions, and prepare XML files for the inputs to this task -- allowing me to copy-paste the XML into the chat.</span>
<span id="cb24-1716"><a href="#cb24-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1717"><a href="#cb24-1717" aria-hidden="true" tabindex="-1"></a>As we'll see, Research Scientists lean heavily into discovery, theoretical advances, publication, and cutting-edge experimentation, whereas ML Engineers center on production-grade systems, robust architecture, MLOps, and aligning with business needs. Although in many cases, the lines between these roles will be blurred.</span>
<span id="cb24-1718"><a href="#cb24-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1721"><a href="#cb24-1721" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-1722"><a href="#cb24-1722" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb24-1723"><a href="#cb24-1723" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold-show: false</span></span>
<span id="cb24-1724"><a href="#cb24-1724" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Click to view the code for XML generation"</span></span>
<span id="cb24-1725"><a href="#cb24-1725" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb24-1726"><a href="#cb24-1726" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb24-1727"><a href="#cb24-1727" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict</span>
<span id="cb24-1728"><a href="#cb24-1728" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-1729"><a href="#cb24-1729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1730"><a href="#cb24-1730" aria-hidden="true" tabindex="-1"></a>INSTRUCTION_PREFIX <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb24-1731"><a href="#cb24-1731" aria-hidden="true" tabindex="-1"></a><span class="st">Identify the most common Responsibilities and Skills listed in the jobs below, returning a bulleted list in the format</span></span>
<span id="cb24-1732"><a href="#cb24-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1733"><a href="#cb24-1733" aria-hidden="true" tabindex="-1"></a><span class="st"># Responsibilities</span></span>
<span id="cb24-1734"><a href="#cb24-1734" aria-hidden="true" tabindex="-1"></a><span class="st">- [responsibility]: [responsibility description]</span></span>
<span id="cb24-1735"><a href="#cb24-1735" aria-hidden="true" tabindex="-1"></a><span class="st">- [responsibility]: [responsibility description]</span></span>
<span id="cb24-1736"><a href="#cb24-1736" aria-hidden="true" tabindex="-1"></a><span class="st">...</span></span>
<span id="cb24-1737"><a href="#cb24-1737" aria-hidden="true" tabindex="-1"></a><span class="st"># Skills</span></span>
<span id="cb24-1738"><a href="#cb24-1738" aria-hidden="true" tabindex="-1"></a><span class="st">- [skill]: [skill description]</span></span>
<span id="cb24-1739"><a href="#cb24-1739" aria-hidden="true" tabindex="-1"></a><span class="st">- [skill]: [skill description]</span></span>
<span id="cb24-1740"><a href="#cb24-1740" aria-hidden="true" tabindex="-1"></a><span class="st">...</span></span>
<span id="cb24-1741"><a href="#cb24-1741" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb24-1742"><a href="#cb24-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1743"><a href="#cb24-1743" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> XMLGenerator:</span>
<span id="cb24-1744"><a href="#cb24-1744" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Handles generation of XML files from job data"""</span></span>
<span id="cb24-1745"><a href="#cb24-1745" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1746"><a href="#cb24-1746" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'xml_roles'</span>):</span>
<span id="cb24-1747"><a href="#cb24-1747" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_dir <span class="op">=</span> output_dir</span>
<span id="cb24-1748"><a href="#cb24-1748" aria-hidden="true" tabindex="-1"></a>        os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-1749"><a href="#cb24-1749" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1750"><a href="#cb24-1750" aria-hidden="true" tabindex="-1"></a>        logging.basicConfig(</span>
<span id="cb24-1751"><a href="#cb24-1751" aria-hidden="true" tabindex="-1"></a>            level<span class="op">=</span>logging.INFO,</span>
<span id="cb24-1752"><a href="#cb24-1752" aria-hidden="true" tabindex="-1"></a>            <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span></span>
<span id="cb24-1753"><a href="#cb24-1753" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-1754"><a href="#cb24-1754" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1755"><a href="#cb24-1755" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> compile_xml_for_role(<span class="va">self</span>, level: <span class="bu">str</span>, role_title: <span class="bu">str</span>, df: pd.DataFrame) <span class="op">-&gt;</span> Dict:</span>
<span id="cb24-1756"><a href="#cb24-1756" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate XML-formatted string of job details for the given level and role title."""</span></span>
<span id="cb24-1757"><a href="#cb24-1757" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter DataFrame for matching level and role</span></span>
<span id="cb24-1758"><a href="#cb24-1758" aria-hidden="true" tabindex="-1"></a>        filtered_df <span class="op">=</span> df[</span>
<span id="cb24-1759"><a href="#cb24-1759" aria-hidden="true" tabindex="-1"></a>            (df[<span class="st">'level'</span>] <span class="op">==</span> level) <span class="op">&amp;</span> </span>
<span id="cb24-1760"><a href="#cb24-1760" aria-hidden="true" tabindex="-1"></a>            (df[<span class="st">'role_title'</span>] <span class="op">==</span> role_title)</span>
<span id="cb24-1761"><a href="#cb24-1761" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb24-1762"><a href="#cb24-1762" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1763"><a href="#cb24-1763" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(filtered_df) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb24-1764"><a href="#cb24-1764" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {</span>
<span id="cb24-1765"><a href="#cb24-1765" aria-hidden="true" tabindex="-1"></a>                <span class="st">'level'</span>: level,</span>
<span id="cb24-1766"><a href="#cb24-1766" aria-hidden="true" tabindex="-1"></a>                <span class="st">'role_title'</span>: role_title,</span>
<span id="cb24-1767"><a href="#cb24-1767" aria-hidden="true" tabindex="-1"></a>                <span class="st">'xml_output'</span>: <span class="st">''</span>,</span>
<span id="cb24-1768"><a href="#cb24-1768" aria-hidden="true" tabindex="-1"></a>                <span class="st">'error'</span>: <span class="ss">f"No jobs found for </span><span class="sc">{</span>level<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>role_title<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb24-1769"><a href="#cb24-1769" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb24-1770"><a href="#cb24-1770" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1771"><a href="#cb24-1771" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Build XML string</span></span>
<span id="cb24-1772"><a href="#cb24-1772" aria-hidden="true" tabindex="-1"></a>        xml_output <span class="op">=</span> <span class="st">""</span></span>
<span id="cb24-1773"><a href="#cb24-1773" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, job <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb24-1774"><a href="#cb24-1774" aria-hidden="true" tabindex="-1"></a>            xml_output <span class="op">+=</span> <span class="st">"&lt;Job&gt;</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb24-1775"><a href="#cb24-1775" aria-hidden="true" tabindex="-1"></a>            xml_output <span class="op">+=</span> <span class="ss">f"&lt;Responsibilities&gt;</span><span class="sc">{</span>job[<span class="st">'responsibilities'</span>]<span class="sc">}</span><span class="ss">&lt;/Responsibilities&gt;</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb24-1776"><a href="#cb24-1776" aria-hidden="true" tabindex="-1"></a>            xml_output <span class="op">+=</span> <span class="ss">f"&lt;Skills&gt;</span><span class="sc">{</span>job[<span class="st">'skills'</span>]<span class="sc">}</span><span class="ss">&lt;/Skills&gt;</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb24-1777"><a href="#cb24-1777" aria-hidden="true" tabindex="-1"></a>            xml_output <span class="op">+=</span> <span class="st">"&lt;/Job&gt;</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb24-1778"><a href="#cb24-1778" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1779"><a href="#cb24-1779" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb24-1780"><a href="#cb24-1780" aria-hidden="true" tabindex="-1"></a>            <span class="st">'level'</span>: level,</span>
<span id="cb24-1781"><a href="#cb24-1781" aria-hidden="true" tabindex="-1"></a>            <span class="st">'role_title'</span>: role_title,</span>
<span id="cb24-1782"><a href="#cb24-1782" aria-hidden="true" tabindex="-1"></a>            <span class="st">'xml_output'</span>: INSTRUCTION_PREFIX <span class="op">+</span> xml_output</span>
<span id="cb24-1783"><a href="#cb24-1783" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-1784"><a href="#cb24-1784" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1785"><a href="#cb24-1785" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_xml(<span class="va">self</span>, level: <span class="bu">str</span>, role_title: <span class="bu">str</span>, xml_data: Dict) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-1786"><a href="#cb24-1786" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Save XML data to a file"""</span></span>
<span id="cb24-1787"><a href="#cb24-1787" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> xml_data[<span class="st">'xml_output'</span>]:</span>
<span id="cb24-1788"><a href="#cb24-1788" aria-hidden="true" tabindex="-1"></a>            <span class="co">#logging.warning(xml_data.get('error', 'Empty XML output'))</span></span>
<span id="cb24-1789"><a href="#cb24-1789" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb24-1790"><a href="#cb24-1790" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1791"><a href="#cb24-1791" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean and sanitize the filename components</span></span>
<span id="cb24-1792"><a href="#cb24-1792" aria-hidden="true" tabindex="-1"></a>        cleaned_level <span class="op">=</span> level.replace(<span class="st">'-Level / Level'</span>, <span class="st">''</span>).strip()</span>
<span id="cb24-1793"><a href="#cb24-1793" aria-hidden="true" tabindex="-1"></a>        safe_level <span class="op">=</span> cleaned_level.replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb24-1794"><a href="#cb24-1794" aria-hidden="true" tabindex="-1"></a>        safe_role <span class="op">=</span> role_title.replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb24-1795"><a href="#cb24-1795" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> os.path.join(<span class="va">self</span>.output_dir, <span class="ss">f"</span><span class="sc">{</span>safe_level<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_role<span class="sc">}</span><span class="ss">.xml"</span>)</span>
<span id="cb24-1796"><a href="#cb24-1796" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1797"><a href="#cb24-1797" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb24-1798"><a href="#cb24-1798" aria-hidden="true" tabindex="-1"></a>            f.write(xml_data[<span class="st">'xml_output'</span>])</span>
<span id="cb24-1799"><a href="#cb24-1799" aria-hidden="true" tabindex="-1"></a>        logging.debug(<span class="ss">f"Saved XML for </span><span class="sc">{</span>cleaned_level<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>role_title<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1800"><a href="#cb24-1800" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1801"><a href="#cb24-1801" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_all_xml(<span class="va">self</span>, df: pd.DataFrame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-1802"><a href="#cb24-1802" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Generate XML files for all role/level combinations"""</span></span>
<span id="cb24-1803"><a href="#cb24-1803" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df.empty:</span>
<span id="cb24-1804"><a href="#cb24-1804" aria-hidden="true" tabindex="-1"></a>            logging.warning(<span class="st">"No jobs found in DataFrame - check if data was loaded correctly"</span>)</span>
<span id="cb24-1805"><a href="#cb24-1805" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb24-1806"><a href="#cb24-1806" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1807"><a href="#cb24-1807" aria-hidden="true" tabindex="-1"></a>        required_cols <span class="op">=</span> [<span class="st">'level'</span>, <span class="st">'role_title'</span>, <span class="st">'responsibilities'</span>, <span class="st">'skills'</span>]  <span class="co"># Changed here too</span></span>
<span id="cb24-1808"><a href="#cb24-1808" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(col <span class="kw">in</span> df.columns <span class="cf">for</span> col <span class="kw">in</span> required_cols):</span>
<span id="cb24-1809"><a href="#cb24-1809" aria-hidden="true" tabindex="-1"></a>            logging.error(<span class="ss">f"DataFrame missing required columns: </span><span class="sc">{</span>required_cols<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1810"><a href="#cb24-1810" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb24-1811"><a href="#cb24-1811" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1812"><a href="#cb24-1812" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process each unique role/level combination</span></span>
<span id="cb24-1813"><a href="#cb24-1813" aria-hidden="true" tabindex="-1"></a>        role_combinations <span class="op">=</span> df[[<span class="st">'level'</span>, <span class="st">'role_title'</span>]].drop_duplicates()</span>
<span id="cb24-1814"><a href="#cb24-1814" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, combo <span class="kw">in</span> role_combinations.iterrows():</span>
<span id="cb24-1815"><a href="#cb24-1815" aria-hidden="true" tabindex="-1"></a>            xml_data <span class="op">=</span> <span class="va">self</span>.compile_xml_for_role(</span>
<span id="cb24-1816"><a href="#cb24-1816" aria-hidden="true" tabindex="-1"></a>                combo[<span class="st">'level'</span>], </span>
<span id="cb24-1817"><a href="#cb24-1817" aria-hidden="true" tabindex="-1"></a>                combo[<span class="st">'role_title'</span>], </span>
<span id="cb24-1818"><a href="#cb24-1818" aria-hidden="true" tabindex="-1"></a>                df</span>
<span id="cb24-1819"><a href="#cb24-1819" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-1820"><a href="#cb24-1820" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.save_xml(combo[<span class="st">'level'</span>], combo[<span class="st">'role_title'</span>], xml_data)</span>
<span id="cb24-1821"><a href="#cb24-1821" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1822"><a href="#cb24-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1825"><a href="#cb24-1825" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-1826"><a href="#cb24-1826" aria-hidden="true" tabindex="-1"></a>xml_generator <span class="op">=</span> XMLGenerator()</span>
<span id="cb24-1827"><a href="#cb24-1827" aria-hidden="true" tabindex="-1"></a>xml_generator.generate_all_xml(df)</span>
<span id="cb24-1828"><a href="#cb24-1828" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1829"><a href="#cb24-1829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1830"><a href="#cb24-1830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1831"><a href="#cb24-1831" aria-hidden="true" tabindex="-1"></a><span class="fu">## o1-generated Senior AI Research Scientist</span></span>
<span id="cb24-1832"><a href="#cb24-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1833"><a href="#cb24-1833" aria-hidden="true" tabindex="-1"></a>Here's what <span class="in">`o1`</span> said about the Responsibilities and Skills observed in Senior AI Research Scientist roles:</span>
<span id="cb24-1834"><a href="#cb24-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1835"><a href="#cb24-1835" aria-hidden="true" tabindex="-1"></a><span class="fu">### Responsibilities</span></span>
<span id="cb24-1836"><a href="#cb24-1836" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Conduct advanced AI research**  </span>
<span id="cb24-1837"><a href="#cb24-1837" aria-hidden="true" tabindex="-1"></a>  Many roles require pushing the state-of-the-art in Generative AI, LLMs, and related areas (e.g., video/multimodal models, diffusion models) through novel algorithms, architectures, and experimental studies.</span>
<span id="cb24-1838"><a href="#cb24-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1839"><a href="#cb24-1839" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Train and fine-tune large-scale models**  </span>
<span id="cb24-1840"><a href="#cb24-1840" aria-hidden="true" tabindex="-1"></a>  Commonly involves working with massive datasets and distributed training setups (thousands of GPUs, HPC environments) to develop foundation models and advanced AI systems.</span>
<span id="cb24-1841"><a href="#cb24-1841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1842"><a href="#cb24-1842" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Develop and implement new algorithms or architectures**  </span>
<span id="cb24-1843"><a href="#cb24-1843" aria-hidden="true" tabindex="-1"></a>  Spans designing novel model architectures (e.g., diffusion, transformer-based, multimodal fusion) and creating robust data processing or simulation pipelines to support AI solutions.</span>
<span id="cb24-1844"><a href="#cb24-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1845"><a href="#cb24-1845" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Collaborate with cross-functional teams**  </span>
<span id="cb24-1846"><a href="#cb24-1846" aria-hidden="true" tabindex="-1"></a>  Emphasizes close work with engineering, product management, research, and external stakeholders to integrate AI breakthroughs into real-world applications and products.</span>
<span id="cb24-1847"><a href="#cb24-1847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1848"><a href="#cb24-1848" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Evaluate and measure AI performance**  </span>
<span id="cb24-1849"><a href="#cb24-1849" aria-hidden="true" tabindex="-1"></a>  Entails building rigorous evaluation frameworks, designing new metrics, and systematically analyzing model behavior to ensure quality and reliability.</span>
<span id="cb24-1850"><a href="#cb24-1850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1851"><a href="#cb24-1851" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Publish and communicate research findings**  </span>
<span id="cb24-1852"><a href="#cb24-1852" aria-hidden="true" tabindex="-1"></a>  Many positions highlight writing influential papers, presenting at conferences, and sharing innovative results both internally and with the broader AI community.</span>
<span id="cb24-1853"><a href="#cb24-1853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1854"><a href="#cb24-1854" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Build and maintain data pipelines**  </span>
<span id="cb24-1855"><a href="#cb24-1855" aria-hidden="true" tabindex="-1"></a>  Involves constructing high-quality, scalable data pipelines or tooling to support training, fine-tuning, and inference of large models.</span>
<span id="cb24-1856"><a href="#cb24-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1857"><a href="#cb24-1857" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Ensure production-grade implementation**  </span>
<span id="cb24-1858"><a href="#cb24-1858" aria-hidden="true" tabindex="-1"></a>  Requires writing clean, efficient, and maintainable code as well as optimizing models and pipelines to meet performance, reliability, and quality standards.</span>
<span id="cb24-1859"><a href="#cb24-1859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1860"><a href="#cb24-1860" aria-hidden="true" tabindex="-1"></a><span class="fu">### Skills</span></span>
<span id="cb24-1861"><a href="#cb24-1861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1862"><a href="#cb24-1862" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Proficiency in Python and deep learning frameworks**  </span>
<span id="cb24-1863"><a href="#cb24-1863" aria-hidden="true" tabindex="-1"></a>  Strong coding skills in Python and hands-on experience with libraries such as PyTorch, TensorFlow, or JAX appear in nearly every role.</span>
<span id="cb24-1864"><a href="#cb24-1864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1865"><a href="#cb24-1865" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Expertise with LLMs and Generative AI**  </span>
<span id="cb24-1866"><a href="#cb24-1866" aria-hidden="true" tabindex="-1"></a>  Deep understanding of transformer architectures, diffusion models, multimodal systems, prompt engineering, and other advanced AI techniques is frequently mentioned.</span>
<span id="cb24-1867"><a href="#cb24-1867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1868"><a href="#cb24-1868" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Experience with large-scale/distributed training**  </span>
<span id="cb24-1869"><a href="#cb24-1869" aria-hidden="true" tabindex="-1"></a>  Many roles emphasize knowledge of HPC, GPU optimization, model parallelism (e.g., FSDP, DeepSpeed, Megatron-LM), and handling massive datasets.</span>
<span id="cb24-1870"><a href="#cb24-1870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1871"><a href="#cb24-1871" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Strong software engineering practices**  </span>
<span id="cb24-1872"><a href="#cb24-1872" aria-hidden="true" tabindex="-1"></a>  Testing, code review, debugging, version control, and producing clean, modular research or production code are consistently important.</span>
<span id="cb24-1873"><a href="#cb24-1873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1874"><a href="#cb24-1874" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Collaboration and communication skills**  </span>
<span id="cb24-1875"><a href="#cb24-1875" aria-hidden="true" tabindex="-1"></a>  Clear written and verbal communication, along with cross-functional teamwork, is vital for integrating AI solutions into products and relaying complex ideas.</span>
<span id="cb24-1876"><a href="#cb24-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1877"><a href="#cb24-1877" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Research acumen and adaptability**  </span>
<span id="cb24-1878"><a href="#cb24-1878" aria-hidden="true" tabindex="-1"></a>  Ability to read, interpret, and prototype cutting-edge AI literature, publish findings, and rapidly iterate on experiments.</span>
<span id="cb24-1879"><a href="#cb24-1879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1880"><a href="#cb24-1880" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Machine Learning fundamentals**  </span>
<span id="cb24-1881"><a href="#cb24-1881" aria-hidden="true" tabindex="-1"></a>  Solid grounding in ML theory (e.g., optimization, statistics, data structures) and experience with model evaluation, data manipulation, and pipeline design.</span>
<span id="cb24-1882"><a href="#cb24-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1883"><a href="#cb24-1883" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Familiarity with prompt engineering and advanced NLP concepts**  </span>
<span id="cb24-1884"><a href="#cb24-1884" aria-hidden="true" tabindex="-1"></a>  Many roles highlight crafting effective prompts, aligning model outputs with user needs, and leveraging text-generation or conversational AI techniques.</span>
<span id="cb24-1885"><a href="#cb24-1885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1886"><a href="#cb24-1886" aria-hidden="true" tabindex="-1"></a><span class="fu">## o1-generated Senior AI ML Engineer</span></span>
<span id="cb24-1887"><a href="#cb24-1887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1888"><a href="#cb24-1888" aria-hidden="true" tabindex="-1"></a>And here's what <span class="in">`o1`</span> said about the Responsibilities and Skills observed in Senior AI ML Engineer roles:</span>
<span id="cb24-1889"><a href="#cb24-1889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1890"><a href="#cb24-1890" aria-hidden="true" tabindex="-1"></a><span class="fu">### Responsibilities</span></span>
<span id="cb24-1891"><a href="#cb24-1891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1892"><a href="#cb24-1892" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Design, develop, and deploy AI/ML solutions**  </span>
<span id="cb24-1893"><a href="#cb24-1893" aria-hidden="true" tabindex="-1"></a>  End-to-end creation of machine learning systems, from initial prototypes to production-ready deployments.</span>
<span id="cb24-1894"><a href="#cb24-1894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1895"><a href="#cb24-1895" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Collaborate with cross-functional teams**  </span>
<span id="cb24-1896"><a href="#cb24-1896" aria-hidden="true" tabindex="-1"></a>  Work closely with product managers, data scientists, engineers, and other stakeholders to align technical solutions with business goals.</span>
<span id="cb24-1897"><a href="#cb24-1897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1898"><a href="#cb24-1898" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Monitor and optimize model performance**  </span>
<span id="cb24-1899"><a href="#cb24-1899" aria-hidden="true" tabindex="-1"></a>  Track key metrics, fine-tune models, and iterate to ensure continuous improvement and reliability in production.</span>
<span id="cb24-1900"><a href="#cb24-1900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1901"><a href="#cb24-1901" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Stay current with AI research and emerging technologies**  </span>
<span id="cb24-1902"><a href="#cb24-1902" aria-hidden="true" tabindex="-1"></a>  Keep up-to-date with the latest breakthroughs in areas like LLMs, generative AI, and deep learning.</span>
<span id="cb24-1903"><a href="#cb24-1903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1904"><a href="#cb24-1904" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Mentor and coach team members**  </span>
<span id="cb24-1905"><a href="#cb24-1905" aria-hidden="true" tabindex="-1"></a>  Provide guidance on best practices, design patterns, code quality, and career development for junior or peer engineers.</span>
<span id="cb24-1906"><a href="#cb24-1906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1907"><a href="#cb24-1907" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Develop scalable data/ML pipelines**  </span>
<span id="cb24-1908"><a href="#cb24-1908" aria-hidden="true" tabindex="-1"></a>  Build robust infrastructure for data collection, preprocessing, model training, and deployment at scale.</span>
<span id="cb24-1909"><a href="#cb24-1909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1910"><a href="#cb24-1910" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Implement and maintain CI/CD and coding best practices**  </span>
<span id="cb24-1911"><a href="#cb24-1911" aria-hidden="true" tabindex="-1"></a>  Ensure code quality, streamline release processes, and enforce testing discipline for AI/ML components.</span>
<span id="cb24-1912"><a href="#cb24-1912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1913"><a href="#cb24-1913" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Integrate and leverage LLMs/generative AI**  </span>
<span id="cb24-1914"><a href="#cb24-1914" aria-hidden="true" tabindex="-1"></a>  Incorporate large language models or generative methods into products and workflows.</span>
<span id="cb24-1915"><a href="#cb24-1915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1916"><a href="#cb24-1916" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Prototype and experiment**  </span>
<span id="cb24-1917"><a href="#cb24-1917" aria-hidden="true" tabindex="-1"></a>  Conduct R&amp;D, proof-of-concepts, and pilot programs to explore emerging AI techniques and validate new product ideas.</span>
<span id="cb24-1918"><a href="#cb24-1918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1919"><a href="#cb24-1919" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Document and communicate findings**  </span>
<span id="cb24-1920"><a href="#cb24-1920" aria-hidden="true" tabindex="-1"></a>  Produce clear technical documentation, share results with stakeholders, and provide actionable insights for decision-making.</span>
<span id="cb24-1921"><a href="#cb24-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1922"><a href="#cb24-1922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1923"><a href="#cb24-1923" aria-hidden="true" tabindex="-1"></a><span class="fu">### Skills</span></span>
<span id="cb24-1924"><a href="#cb24-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1925"><a href="#cb24-1925" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Proficiency in Python**  </span>
<span id="cb24-1926"><a href="#cb24-1926" aria-hidden="true" tabindex="-1"></a>  Commonly required for AI/ML development, data manipulation, and scripting.</span>
<span id="cb24-1927"><a href="#cb24-1927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1928"><a href="#cb24-1928" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Experience with ML/DL frameworks**  </span>
<span id="cb24-1929"><a href="#cb24-1929" aria-hidden="true" tabindex="-1"></a>  Hands-on expertise in tools like PyTorch, TensorFlow, or JAX for building and training models.</span>
<span id="cb24-1930"><a href="#cb24-1930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1931"><a href="#cb24-1931" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Familiarity with cloud platforms**  </span>
<span id="cb24-1932"><a href="#cb24-1932" aria-hidden="true" tabindex="-1"></a>  Working knowledge of AWS, GCP, or Azure for deploying and scaling AI solutions.</span>
<span id="cb24-1933"><a href="#cb24-1933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1934"><a href="#cb24-1934" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Expertise in LLMs/generative AI**  </span>
<span id="cb24-1935"><a href="#cb24-1935" aria-hidden="true" tabindex="-1"></a>  Understanding of transformer architectures, prompt engineering, retrieval-augmented generation (RAG), and related libraries.</span>
<span id="cb24-1936"><a href="#cb24-1936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1937"><a href="#cb24-1937" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Strong software engineering fundamentals**  </span>
<span id="cb24-1938"><a href="#cb24-1938" aria-hidden="true" tabindex="-1"></a>  Solid grasp of algorithms, data structures, design patterns, and best practices for production code.</span>
<span id="cb24-1939"><a href="#cb24-1939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1940"><a href="#cb24-1940" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Knowledge of MLOps and CI/CD**  </span>
<span id="cb24-1941"><a href="#cb24-1941" aria-hidden="true" tabindex="-1"></a>  Experience with containerization (Docker, Kubernetes), version control (Git), and automated testing/monitoring.</span>
<span id="cb24-1942"><a href="#cb24-1942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1943"><a href="#cb24-1943" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Data processing and SQL**  </span>
<span id="cb24-1944"><a href="#cb24-1944" aria-hidden="true" tabindex="-1"></a>  Skills in handling large datasets, working with Spark or similar frameworks, and writing performant SQL queries.</span>
<span id="cb24-1945"><a href="#cb24-1945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1946"><a href="#cb24-1946" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Effective communication and collaboration**  </span>
<span id="cb24-1947"><a href="#cb24-1947" aria-hidden="true" tabindex="-1"></a>  Ability to translate complex technical concepts for non-technical stakeholders and work well in diverse teams.</span>
<span id="cb24-1948"><a href="#cb24-1948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1949"><a href="#cb24-1949" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Problem-solving and debugging**  </span>
<span id="cb24-1950"><a href="#cb24-1950" aria-hidden="true" tabindex="-1"></a>  Track record of diagnosing issues in production environments and implementing reliable fixes.</span>
<span id="cb24-1951"><a href="#cb24-1951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1952"><a href="#cb24-1952" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Continuous learning mindset**  </span>
<span id="cb24-1953"><a href="#cb24-1953" aria-hidden="true" tabindex="-1"></a>  Eagerness to stay on top of new AI research, frameworks, and technologies to innovate and improve solutions.</span>
<span id="cb24-1954"><a href="#cb24-1954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1955"><a href="#cb24-1955" aria-hidden="true" tabindex="-1"></a><span class="fu"># Job titles</span></span>
<span id="cb24-1956"><a href="#cb24-1956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1957"><a href="#cb24-1957" aria-hidden="true" tabindex="-1"></a>What are the most common job titles for these roles?</span>
<span id="cb24-1958"><a href="#cb24-1958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1959"><a href="#cb24-1959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1962"><a href="#cb24-1962" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-1963"><a href="#cb24-1963" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb24-1964"><a href="#cb24-1964" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold-show: false</span></span>
<span id="cb24-1965"><a href="#cb24-1965" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Click to view the code for aggregating titles"</span></span>
<span id="cb24-1966"><a href="#cb24-1966" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> aggregate_titles_by_role_level(df: pd.DataFrame, output_dir: <span class="bu">str</span> <span class="op">=</span> <span class="st">'role_titles'</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb24-1967"><a href="#cb24-1967" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb24-1968"><a href="#cb24-1968" aria-hidden="true" tabindex="-1"></a><span class="co">    Aggregate job titles for each role_title and level combination and save to JSON.</span></span>
<span id="cb24-1969"><a href="#cb24-1969" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb24-1970"><a href="#cb24-1970" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb24-1971"><a href="#cb24-1971" aria-hidden="true" tabindex="-1"></a><span class="co">        df: DataFrame containing 'role_title', 'level', and 'title' columns</span></span>
<span id="cb24-1972"><a href="#cb24-1972" aria-hidden="true" tabindex="-1"></a><span class="co">        output_dir: Directory to save the JSON output</span></span>
<span id="cb24-1973"><a href="#cb24-1973" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb24-1974"><a href="#cb24-1974" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create output directory if it doesn't exist</span></span>
<span id="cb24-1975"><a href="#cb24-1975" aria-hidden="true" tabindex="-1"></a>    os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-1976"><a href="#cb24-1976" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1977"><a href="#cb24-1977" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by role_title and level</span></span>
<span id="cb24-1978"><a href="#cb24-1978" aria-hidden="true" tabindex="-1"></a>    grouped <span class="op">=</span> df.groupby([<span class="st">'role_title'</span>, <span class="st">'level'</span>])</span>
<span id="cb24-1979"><a href="#cb24-1979" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-1980"><a href="#cb24-1980" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (role, level), group <span class="kw">in</span> grouped:</span>
<span id="cb24-1981"><a href="#cb24-1981" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get unique titles for this combination</span></span>
<span id="cb24-1982"><a href="#cb24-1982" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> {</span>
<span id="cb24-1983"><a href="#cb24-1983" aria-hidden="true" tabindex="-1"></a>            <span class="st">'titles'</span>: group[<span class="st">'title'</span>].unique().tolist()</span>
<span id="cb24-1984"><a href="#cb24-1984" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-1985"><a href="#cb24-1985" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1986"><a href="#cb24-1986" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create safe filename from role and level</span></span>
<span id="cb24-1987"><a href="#cb24-1987" aria-hidden="true" tabindex="-1"></a>        safe_role <span class="op">=</span> role.replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb24-1988"><a href="#cb24-1988" aria-hidden="true" tabindex="-1"></a>        safe_level <span class="op">=</span> level.replace(<span class="st">'/'</span>, <span class="st">'_'</span>).replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb24-1989"><a href="#cb24-1989" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>safe_level<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>safe_role<span class="sc">}</span><span class="ss">.json"</span></span>
<span id="cb24-1990"><a href="#cb24-1990" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-1991"><a href="#cb24-1991" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Save to JSON file</span></span>
<span id="cb24-1992"><a href="#cb24-1992" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(os.path.join(output_dir, filename), <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb24-1993"><a href="#cb24-1993" aria-hidden="true" tabindex="-1"></a>            json.dump(result, f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb24-1994"><a href="#cb24-1994" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-1995"><a href="#cb24-1995" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Saved titles for </span><span class="sc">{</span>level<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>role<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-1996"><a href="#cb24-1996" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-1997"><a href="#cb24-1997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2000"><a href="#cb24-2000" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-2001"><a href="#cb24-2001" aria-hidden="true" tabindex="-1"></a>aggregate_titles_by_role_level(df)</span>
<span id="cb24-2002"><a href="#cb24-2002" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-2003"><a href="#cb24-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2004"><a href="#cb24-2004" aria-hidden="true" tabindex="-1"></a>I'll use <span class="in">`o1`</span> again to generate a summary of the most common titles for each role/level combination. In the prompt, I will omit my own role classification so as not to bias the results. I'll ask it to "identify the most common titles listed below (ignoring slight variations), and then for those titles identify how often they occurred."</span>
<span id="cb24-2005"><a href="#cb24-2005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2006"><a href="#cb24-2006" aria-hidden="true" tabindex="-1"></a>Here's a sample of what it said.</span>
<span id="cb24-2007"><a href="#cb24-2007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2008"><a href="#cb24-2008" aria-hidden="true" tabindex="-1"></a>For Senior AI Research Scientist roles, <span class="in">`o1`</span> observed the following titles to be common to this role:</span>
<span id="cb24-2009"><a href="#cb24-2009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2010"><a href="#cb24-2010" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Research Scientist/Researcher (14 occurrences)</span>
<span id="cb24-2011"><a href="#cb24-2011" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Research Engineer (7 occurrences)</span>
<span id="cb24-2012"><a href="#cb24-2012" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Machine Learning Engineer (3 occurrences)</span>
<span id="cb24-2013"><a href="#cb24-2013" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Generative AI Engineer (2 occurrences)</span>
<span id="cb24-2014"><a href="#cb24-2014" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Software Engineer (Generative AI) (2 occurrences)</span>
<span id="cb24-2015"><a href="#cb24-2015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2016"><a href="#cb24-2016" aria-hidden="true" tabindex="-1"></a>For Senior AI ML Engineer roles, <span class="in">`o1`</span> observed the following titles to be common to this role:</span>
<span id="cb24-2017"><a href="#cb24-2017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2018"><a href="#cb24-2018" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Senior Software Engineer (6 occurrences)</span>
<span id="cb24-2019"><a href="#cb24-2019" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Senior Machine Learning Engineer (5 occurrences)</span>
<span id="cb24-2020"><a href="#cb24-2020" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Staff Software Engineer (5 occurrences)</span>
<span id="cb24-2021"><a href="#cb24-2021" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Senior AI Engineer (4 occurrences)</span>
<span id="cb24-2022"><a href="#cb24-2022" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Machine Learning Researcher (3 occurrences)</span>
<span id="cb24-2023"><a href="#cb24-2023" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Staff Machine Learning Engineer (2 occurrences)</span>
<span id="cb24-2024"><a href="#cb24-2024" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Principal Software Engineer (2 occurrences)</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><a href="https://creativecommons.org/licenses/by/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i></a> 2014–2025 Tyler Burleigh</span></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i>, <a href="https://quarto.org/">Quarto</a>, and the <a href="https://github.com/andrewheiss/ath-quarto">ath-quarto</a> theme</span></p>
</div>
  </div>
</footer>




</body></html>